<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿¡ç”¨è­‰å–®æ“šå¯©æ ¸åŠ©æ‰‹ - èµåŒç§‘æŠ€æ•°å­—å‘˜å·¥</title>
    <script src="/console/style/tailwindcss.3.0.23.js"></script>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+HK:wght@300;400;500;600;700&display=swap" rel="stylesheet"> -->
    <style>
        * {
            font-family: 'Noto Sans HK', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            /* background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #f1f5f9 100%); */
            min-height: 100vh;
        }
        
        .liquid-glass {
            background: rgba(255, 255, 255, 0.85);
            /* backdrop-filter: blur(20px); */
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .liquid-glass-strong {
            /* background: rgba(255, 255, 255, 0.92); */
            /* backdrop-filter: blur(25px); */
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        }
        
        .specular-highlight {
            position: relative;
            overflow: hidden;
        }
        
        .specular-highlight::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s ease;
            pointer-events: none;
        }
        
        .specular-highlight:hover::before {
            left: 100%;
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.12);
        }
        
        .message-bubble {
            max-width: 85%;
            word-wrap: break-word;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            color: white;
            margin-left: auto;
            border-radius: 18px 18px 4px 18px;
        }
        
        .assistant-message {
            background: rgba(255, 255, 255, 0.95);
            color: #374151;
            margin-right: auto;
            border-radius: 18px 18px 18px 4px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 18px 18px 18px 4px;
            margin-right: auto;
            max-width: 85%;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #9ca3af;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-10px); opacity: 1; }
        }
        
        .upload-zone {
            border: 2px dashed rgba(30, 64, 175, 0.3);
            border-radius: 16px;
            padding: 32px 24px;
            text-align: center;
            background: rgba(30, 64, 175, 0.03);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-zone:hover {
            border-color: rgba(30, 64, 175, 0.5);
            background: rgba(30, 64, 175, 0.08);
            transform: translateY(-2px);
        }
        
        .upload-zone.dragover {
            border-color: rgba(16, 185, 129, 0.6);
            background: rgba(16, 185, 129, 0.1);
            transform: scale(1.01);
        }
        
        .upload-zone.has-file {
            border-color: rgba(16, 185, 129, 0.5);
            background: rgba(16, 185, 129, 0.08);
        }
        
        .step-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .step {
            display: flex;
            align-items: center;
            font-size: 13px;
            color: #6b7280;
            transition: all 0.3s ease;
        }
        
        .step.active { color: #1e40af; font-weight: 600; }
        .step.completed { color: #059669; }
        
        .step-circle {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #e5e7eb;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
            transition: all 0.3s ease;
        }
        
        .step.active .step-circle { background: #1e40af; color: white; }
        .step.completed .step-circle { background: #059669; color: white; }
        
        .step-divider {
            width: 32px;
            height: 2px;
            background: #e5e7eb;
            margin: 0 8px;
            transition: all 0.3s ease;
        }
        
        .step.completed + .step-divider { background: #059669; }
        
        .standard-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(226, 232, 240, 0.8);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .standard-card:hover {
            border-color: rgba(30, 64, 175, 0.3);
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-2px);
        }
        
        .standard-card.selected {
            border-color: #1e40af;
            background: rgba(30, 64, 175, 0.05);
        }
        
        .standard-card.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 8px;
            right: 8px;
            width: 20px;
            height: 20px;
            background: #1e40af;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .doc-item {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 12px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }
        
        .doc-item:hover {
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        
        .discrepancy-item {
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid;
        }
        
        .discrepancy-high {
            background: rgba(239, 68, 68, 0.08);
            border-left-color: #ef4444;
        }
        
        .discrepancy-medium {
            background: rgba(245, 158, 11, 0.08);
            border-left-color: #f59e0b;
        }
        
        .discrepancy-low {
            background: rgba(16, 185, 129, 0.08);
            border-left-color: #10b981;
        }
        
        .action-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.9);
            color: #4b5563;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            background: rgba(255, 255, 255, 1);
            border-color: rgba(30, 64, 175, 0.3);
            color: #1e40af;
        }
        
        .action-btn.active {
            background: rgba(30, 64, 175, 0.1);
            border-color: rgba(30, 64, 175, 0.3);
            color: #1e40af;
        }
        
        .action-btn.primary {
            background: #1e40af;
            color: white;
            border-color: #1e40af;
        }
        
        .action-btn.primary:hover {
            background: #1e3a8a;
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            margin: 20px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s ease;
            overflow: hidden;
        }
        
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 16px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
            min-width: 280px;
        }
        
        .toast.show { transform: translateX(0); }
        .toast.success { border-left: 4px solid #10b981; }
        .toast.error { border-left: 4px solid #ef4444; }
        .toast.info { border-left: 4px solid #1e40af; }
        .toast.warning { border-left: 4px solid #f59e0b; }
        
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .badge-success { background: rgba(16, 185, 129, 0.1); color: #059669; }
        .badge-warning { background: rgba(245, 158, 11, 0.1); color: #d97706; }
        .badge-error { background: rgba(239, 68, 68, 0.1); color: #dc2626; }
        .badge-info { background: rgba(30, 64, 175, 0.1); color: #1e40af; }
        
        .chat-input {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 12px;
            padding: 12px 16px;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .chat-input:focus {
            border-color: rgba(30, 64, 175, 0.5);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }
        
        .floating-button {
            transform: translateY(0);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .floating-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(226, 232, 240, 0.6);
        }
    </style>
</head>
<body class="h-screen flex flex-col">
    <!-- ä¸»å®¹å™¨ -->
    <div class="flex-1 flex flex-col w-full  overflow-hidden">
        <!-- é ­éƒ¨ -->
        <div class=" p-4 flex items-center justify-between">
            <div class="flex items-center">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-600 to-blue-800 flex items-center justify-center mr-4 shadow-lg">
                    <span class="text-white text-xl">ğŸ“‹</span>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-gray-800">ä¿¡ç”¨è­‰å–®æ“šå¯©æ ¸åŠ©æ‰‹</h3>
                    <p class="text-sm text-gray-500">LC Document Checker Â· åŸºæ–¼ UCP600 & ISBP æ¨™æº–</p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <!-- <span class="badge badge-success">
                    <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                    AI å°±ç·’
                </span> -->
                <button onclick="resetWizard()" class="liquid-glass floating-button rounded-xl px-4 py-2 text-sm font-medium text-gray-700 specular-highlight">
                    æ–°å»ºå¯©æ ¸
                </button>
            </div>
        </div>
        
        <!-- ä¸»å…§å®¹å€åŸŸ -->
        <div id="messages-container" class="flex-1 liquid-glass-strong p-6 overflow-y-auto">
            <!-- åš®å°ç•Œé¢ -->
            <div id="wizard-interface">
                <!-- æ­¥é©ŸæŒ‡ç¤ºå™¨ -->
                <div class="step-indicator">
                    <div class="step active" id="step-1">
                        <div class="step-circle">1</div>
                        <span>ä¸Šè¼‰ä¿¡ç”¨è­‰</span>
                    </div>
                    <div class="step-divider"></div>
                    <div class="step" id="step-2">
                        <div class="step-circle">2</div>
                        <span>ä¸Šè¼‰ç›¸é—œå–®æ“š</span>
                    </div>
                    <div class="step-divider"></div>
                    <div class="step" id="step-3">
                        <div class="step-circle">3</div>
                        <span>é¸æ“‡å¯©æ ¸æ¨™æº–</span>
                    </div>
                    <div class="step-divider"></div>
                    <div class="step" id="step-4">
                        <div class="step-circle">4</div>
                        <span>AI å¯©æ ¸</span>
                    </div>
                </div>
                
                <!-- åŠ©æ‰‹ä»‹ç´¹ -->
                <div class="message-bubble assistant-message p-6 mb-6">
                    <div class="prose prose-sm max-w-none text-gray-700">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">æ­¡è¿ä½¿ç”¨ä¿¡ç”¨è­‰å–®æ“šå¯©æ ¸åŠ©æ‰‹</h3>
                        <p class="mb-4 text-gray-600">æˆ‘èƒ½å¤ æ ¹æ“šåœ‹éš›æ¨™æº– UCP600ã€ISBP æŒ‡å¼•åŠæœ¬åœ°æ³•è¦ï¼Œæ™ºèƒ½å¯©æ ¸ä¿¡ç”¨è­‰ç›¸é—œå–®æ“šï¼Œå¿«é€Ÿè­˜åˆ¥ä¸ç¬¦é»ä¸¦æä¾›å°ˆæ¥­å»ºè­°ã€‚</p>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4">
                            <div class="flex items-center p-3 bg-blue-50 rounded-xl">
                                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                    <span class="text-blue-600">ğŸ”</span>
                                </div>
                                <div>
                                    <div class="font-medium text-sm text-gray-800">æ™ºèƒ½æ¯”å°</div>
                                    <div class="text-xs text-gray-500">å¤šç¶­åº¦äº¤å‰é©—è­‰</div>
                                </div>
                            </div>
                            <div class="flex items-center p-3 bg-amber-50 rounded-xl">
                                <div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center mr-3">
                                    <span class="text-amber-600">âš ï¸</span>
                                </div>
                                <div>
                                    <div class="font-medium text-sm text-gray-800">ä¸ç¬¦é»è­˜åˆ¥</div>
                                    <div class="text-xs text-gray-500">è‡ªå‹•æ¨™è¨˜é¢¨éšª</div>
                                </div>
                            </div>
                            <div class="flex items-center p-3 bg-green-50 rounded-xl">
                                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                    <span class="text-green-600">ğŸ“Š</span>
                                </div>
                                <div>
                                    <div class="font-medium text-sm text-gray-800">åˆè¦å ±å‘Š</div>
                                    <div class="text-xs text-gray-500">ä¸€éµç”Ÿæˆå ±å‘Š</div>
                                </div>
                            </div>
                            <div class="flex items-center p-3 bg-purple-50 rounded-xl">
                                <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                    <span class="text-purple-600">ğŸ“š</span>
                                </div>
                                <div>
                                    <div class="font-medium text-sm text-gray-800">æ¡ˆä¾‹å­¸ç¿’</div>
                                    <div class="text-xs text-gray-500">æŒçºŒå„ªåŒ–æº–ç¢ºç‡</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ­¥é©Ÿ1: ä¸Šè¼‰ä¿¡ç”¨è­‰ -->
                <div id="step1-content" class="step-content">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">ç¬¬ä¸€æ­¥ï¼šä¸Šè¼‰ä¿¡ç”¨è­‰ (Letter of Credit)</h3>
                    <p class="text-gray-500 text-sm mb-4">è«‹ä¸Šè¼‰éœ€è¦å¯©æ ¸çš„ä¿¡ç”¨è­‰æ–‡ä»¶ï¼Œæ”¯æ´ PDFã€åœ–ç‰‡æ ¼å¼</p>
                    
                    <div class="upload-zone" id="lc-upload-zone" onclick="triggerLCUpload()" ondrop="handleLCDrop(event)" ondragover="handleDragOver(event, 'lc-upload-zone')" ondragleave="handleDragLeave(event, 'lc-upload-zone')">
                        <div id="lc-upload-content">
                            <svg class="w-14 h-14 mx-auto mb-3 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <h4 class="text-lg font-semibold text-gray-700 mb-1">æ‹–æ”¾ä¿¡ç”¨è­‰æ–‡ä»¶åˆ°æ­¤è™•</h4>
                            <p class="text-gray-500 text-sm mb-3">æˆ–é»æ“Šé¸æ“‡æ–‡ä»¶</p>
                            <div class="flex flex-wrap justify-center gap-2 text-xs text-gray-400">
                                <span class="bg-gray-100 px-2 py-1 rounded">PDF</span>
                                <span class="bg-gray-100 px-2 py-1 rounded">JPG/PNG</span>
                                <span class="bg-gray-100 px-2 py-1 rounded">TIFF</span>
                                <span class="bg-gray-100 px-2 py-1 rounded">æœ€å¤§ 20MB</span>
                            </div>
                        </div>
                        <input type="file" id="lc-file-input" style="display: none;" accept=".pdf,.jpg,.jpeg,.png,.tiff" onchange="handleLCUpload(this)">
                    </div>
                    
                    <div id="lc-preview-area" class="mt-4" style="display: none;"></div>
                </div>
                
                <!-- æ­¥é©Ÿ2: ä¸Šè¼‰ç›¸é—œå–®æ“š -->
                <div id="step2-content" class="step-content" style="display: none;">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">ç¬¬äºŒæ­¥ï¼šä¸Šè¼‰ç›¸é—œå–®æ“š</h3>
                    <p class="text-gray-500 text-sm mb-4">è«‹ä¸Šè¼‰éœ€è¦å¯©æ ¸çš„è²¿æ˜“å–®æ“šï¼ŒAI å°‡å°ç…§ä¿¡ç”¨è­‰æ¢æ¬¾é€²è¡Œå¯©æ ¸</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="standard-card card-hover" onclick="selectDocType('invoice')">
                            <div class="flex items-start">
                                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                    <span class="text-blue-600">ğŸ§¾</span>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-800">å•†æ¥­ç™¼ç¥¨</div>
                                    <div class="text-xs text-gray-500 mt-1">Commercial Invoice</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="standard-card card-hover" onclick="selectDocType('bl')">
                            <div class="flex items-start">
                                <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                    <span class="text-indigo-600">ğŸš¢</span>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-800">æå–®</div>
                                    <div class="text-xs text-gray-500 mt-1">Bill of Lading</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="standard-card card-hover" onclick="selectDocType('insurance')">
                            <div class="flex items-start">
                                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                    <span class="text-green-600">ğŸ›¡ï¸</span>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-800">ä¿éšªå–®æ“š</div>
                                    <div class="text-xs text-gray-500 mt-1">Insurance Certificate</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="standard-card card-hover" onclick="selectDocType('origin')">
                            <div class="flex items-start">
                                <div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                    <span class="text-amber-600">ğŸŒ</span>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-800">ç”¢åœ°è­‰æ˜</div>
                                    <div class="text-xs text-gray-500 mt-1">Certificate of Origin</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="standard-card card-hover" onclick="selectDocType('packing')">
                            <div class="flex items-start">
                                <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                    <span class="text-purple-600">ğŸ“¦</span>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-800">è£ç®±å–®</div>
                                    <div class="text-xs text-gray-500 mt-1">Packing List</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="standard-card card-hover" onclick="selectDocType('draft')">
                            <div class="flex items-start">
                                <div class="w-10 h-10 bg-rose-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                    <span class="text-rose-600">ğŸ’µ</span>
                                </div>
                                <div>
                                    <div class="font-medium text-gray-800">åŒ¯ç¥¨</div>
                                    <div class="text-xs text-gray-500 mt-1">Draft / Bill of Exchange</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="upload-zone" id="docs-upload-zone" onclick="triggerDocsUpload()" ondrop="handleDocsDrop(event)" ondragover="handleDragOver(event, 'docs-upload-zone')" ondragleave="handleDragLeave(event, 'docs-upload-zone')">
                        <div id="docs-upload-content">
                            <svg class="w-12 h-12 mx-auto mb-3 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <h4 class="text-base font-semibold text-gray-700 mb-1">æ‹–æ”¾å–®æ“šæ–‡ä»¶åˆ°æ­¤è™•</h4>
                            <p class="text-gray-500 text-sm">æ”¯æ´æ‰¹é‡ä¸Šè¼‰å¤šå€‹æ–‡ä»¶</p>
                        </div>
                        <input type="file" id="docs-file-input" style="display: none;" accept=".pdf,.jpg,.jpeg,.png,.tiff" multiple onchange="handleDocsUpload(this)">
                    </div>
                    
                    <div id="uploaded-docs-list" class="mt-4"></div>
                    
                    <div class="mt-6 flex justify-between">
                        <button onclick="goToStep(1)" class="action-btn">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            ä¸Šä¸€æ­¥
                        </button>
                        <button id="next-to-step3" onclick="goToStep(3)" class="action-btn primary" disabled>
                            ä¸‹ä¸€æ­¥ï¼šé¸æ“‡å¯©æ ¸æ¨™æº–
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                    </div>
                </div>
                
                <!-- æ­¥é©Ÿ3: é¸æ“‡å¯©æ ¸æ¨™æº– -->
                <div id="step3-content" class="step-content" style="display: none;">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">ç¬¬ä¸‰æ­¥ï¼šé¸æ“‡å¯©æ ¸æ¨™æº–</h3>
                    <p class="text-gray-500 text-sm mb-4">è«‹é¸æ“‡é©ç”¨çš„å¯©æ ¸æ¨™æº–å’Œè¦å‰‡ï¼ŒAI å°‡æ“šæ­¤é€²è¡Œå–®æ“šå¯©æ ¸</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="standard-card card-hover selected" id="standard-ucp600" onclick="toggleStandard('ucp600')">
                            <div class="flex items-start">
                                <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                                    <span class="text-blue-600 text-lg">ğŸ“œ</span>
                                </div>
                                <div class="flex-1">
                                    <div class="font-semibold text-gray-800">UCP 600</div>
                                    <div class="text-xs text-gray-500 mt-1">è·Ÿå–®ä¿¡ç”¨è­‰çµ±ä¸€æ…£ä¾‹</div>
                                    <div class="text-xs text-blue-600 mt-2">ICC åœ‹éš›å•†æœƒæ¨™æº–</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="standard-card card-hover selected" id="standard-isbp" onclick="toggleStandard('isbp')">
                            <div class="flex items-start">
                                <div class="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                                    <span class="text-indigo-600 text-lg">ğŸ“‹</span>
                                </div>
                                <div class="flex-1">
                                    <div class="font-semibold text-gray-800">ISBP 745</div>
                                    <div class="text-xs text-gray-500 mt-1">åœ‹éš›æ¨™æº–éŠ€è¡Œå¯¦å‹™</div>
                                    <div class="text-xs text-indigo-600 mt-2">å–®æ“šå¯©æ ¸æŒ‡å¼•</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="standard-card card-hover" id="standard-hkma" onclick="toggleStandard('hkma')">
                            <div class="flex items-start">
                                <div class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                                    <span class="text-red-600 text-lg">ğŸ›ï¸</span>
                                </div>
                                <div class="flex-1">
                                    <div class="font-semibold text-gray-800">é¦™æ¸¯é‡‘ç®¡å±€æŒ‡å¼•</div>
                                    <div class="text-xs text-gray-500 mt-1">HKMA Regulatory Guidelines</div>
                                    <div class="text-xs text-red-600 mt-2">æœ¬åœ°ç›£ç®¡è¦æ±‚</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="standard-card card-hover" id="standard-internal" onclick="toggleStandard('internal')">
                            <div class="flex items-start">
                                <div class="w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                                    <span class="text-emerald-600 text-lg">ğŸ¦</span>
                                </div>
                                <div class="flex-1">
                                    <div class="font-semibold text-gray-800">éŠ€è¡Œå…§éƒ¨æ”¿ç­–</div>
                                    <div class="text-xs text-gray-500 mt-1">Shacom Internal Policy</div>
                                    <div class="text-xs text-emerald-600 mt-2">å…§éƒ¨åˆè¦è¦æ±‚</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-xl p-4 mb-6">
                        <h4 class="font-medium text-gray-800 mb-3">å¯©æ ¸é¸é …</h4>
                        <div class="space-y-3">
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" class="w-4 h-4 text-blue-600 rounded border-gray-300 mr-3" checked>
                                <span class="text-sm text-gray-700">æª¢æŸ¥å–®æ“šæ—¥æœŸä¸€è‡´æ€§</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" class="w-4 h-4 text-blue-600 rounded border-gray-300 mr-3" checked>
                                <span class="text-sm text-gray-700">é©—è­‰é‡‘é¡èˆ‡æ•¸é‡</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" class="w-4 h-4 text-blue-600 rounded border-gray-300 mr-3" checked>
                                <span class="text-sm text-gray-700">æ ¸å°è²¨ç‰©æè¿°</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" class="w-4 h-4 text-blue-600 rounded border-gray-300 mr-3" checked>
                                <span class="text-sm text-gray-700">æª¢æŸ¥é‹è¼¸æ¢æ¬¾åˆè¦</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" class="w-4 h-4 text-blue-600 rounded border-gray-300 mr-3">
                                <span class="text-sm text-gray-700">åŸ·è¡Œ AML ä¿¡æ¯æå–</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="flex justify-between">
                        <button onclick="goToStep(2)" class="action-btn">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            ä¸Šä¸€æ­¥
                        </button>
                        <button onclick="startReview()" class="action-btn primary">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>
                            é–‹å§‹ AI å¯©æ ¸
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="chat-area" style="display: none;"></div>
        </div>
        
        <div id="input-area" class="liquid-glass-strong rounded-b-2xl p-4" style="display: none;">
            <div class="flex items-end space-x-3">
                <div class="flex-1">
                    <input type="text" 
                           id="message-input"
                           placeholder="è¼¸å…¥æ‚¨çš„å•é¡Œï¼Œä¾‹å¦‚ï¼šè«‹è©³ç´°èªªæ˜ç¬¬3é …ä¸ç¬¦é»..."
                           class="w-full chat-input"
                           onkeypress="if(event.key==='Enter') sendMessage()">
                </div>
                <button onclick="sendMessage()" class="action-btn primary px-4 py-3">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- çŸ¥è­˜æº¯æºå½ˆçª— -->
    <div id="source-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between p-6 border-b border-gray-100">
                <h3 class="text-lg font-semibold text-gray-800">å¯©æ ¸ä¾æ“šè©³æƒ…</h3>
                <button onclick="closeSourceModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="p-6 overflow-y-auto max-h-96">
                <div class="mb-5">
                    <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                        <span class="mr-2">ğŸ“œ</span> å¼•ç”¨æ¨™æº–
                    </h4>
                    <div class="bg-blue-50 rounded-xl p-4">
                        <p class="text-sm text-gray-700 mb-1">
                            <span class="font-medium">æ¨™æº–åç¨±ï¼š</span>
                            <span id="source-standard">UCP 600</span>
                        </p>
                        <p class="text-sm text-gray-700 mb-1">
                            <span class="font-medium">æ¢æ¬¾ç·¨è™Ÿï¼š</span>
                            <span id="source-article">Article 14</span>
                        </p>
                        <p class="text-sm text-gray-700">
                            <span class="font-medium">ç« ç¯€ï¼š</span>
                            <span id="source-section">Standard for Examination of Documents</span>
                        </p>
                    </div>
                </div>
                
                <div class="mb-5">
                    <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                        <span class="mr-2">ğŸ“</span> æ¢æ¬¾åŸæ–‡
                    </h4>
                    <div class="bg-gray-50 rounded-xl p-4">
                        <p id="source-content" class="text-sm text-gray-700 leading-relaxed">
                            A nominated bank acting on its nomination, a confirming bank, if any, and the issuing bank must examine a presentation to determine, on the basis of the documents alone, whether or not the documents appear on their face to constitute a complying presentation.
                        </p>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                        <span class="mr-2">ğŸ·ï¸</span> ç›¸é—œæ¨™ç±¤
                    </h4>
                    <div id="source-tags" class="flex flex-wrap gap-2">
                        <span class="badge badge-info">å–®æ“šå¯©æ ¸</span>
                        <span class="badge badge-info">è¡¨é¢ç›¸ç¬¦</span>
                        <span class="badge badge-info">UCP600</span>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center justify-between p-6 border-t border-gray-100">
                <div class="text-sm text-gray-500">
                    é©ç”¨æ€§ï¼š<span class="font-semibold text-green-600">é«˜åº¦ç›¸é—œ</span>
                </div>
                <button onclick="closeSourceModal()" class="action-btn primary">
                    ç¢ºå®š
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let lcFile = null;
        let uploadedDocs = [];
        let selectedStandards = ['ucp600', 'isbp'];
        let isTyping = false;

        const docTypeNames = {
            'invoice': 'å•†æ¥­ç™¼ç¥¨',
            'bl': 'æå–®',
            'insurance': 'ä¿éšªå–®æ“š',
            'origin': 'ç”¢åœ°è­‰æ˜',
            'packing': 'è£ç®±å–®',
            'draft': 'åŒ¯ç¥¨'
        };

        const docTypeIcons = {
            'invoice': 'ğŸ§¾',
            'bl': 'ğŸš¢',
            'insurance': 'ğŸ›¡ï¸',
            'origin': 'ğŸŒ',
            'packing': 'ğŸ“¦',
            'draft': 'ğŸ’µ'
        };

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <div class="mr-3">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}</div>
                    <div class="flex-1"><div class="font-medium text-gray-800">${message}</div></div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-gray-400 hover:text-gray-600">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }, 3000);
        }

        function updateStepStatus(step) {
            for (let i = 1; i <= 4; i++) {
                const stepEl = document.getElementById(`step-${i}`);
                stepEl.classList.remove('active', 'completed');
                if (i < step) stepEl.classList.add('completed');
                else if (i === step) stepEl.classList.add('active');
            }
            currentStep = step;
        }

        function goToStep(step) {
            updateStepStatus(step);
            document.getElementById('step1-content').style.display = step === 1 ? 'block' : 'none';
            document.getElementById('step2-content').style.display = step === 2 ? 'block' : 'none';
            document.getElementById('step3-content').style.display = step === 3 ? 'block' : 'none';
        }

        function handleDragOver(e, zoneId) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById(zoneId).classList.add('dragover');
        }

        function handleDragLeave(e, zoneId) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById(zoneId).classList.remove('dragover');
        }

        function triggerLCUpload() { document.getElementById('lc-file-input').click(); }

        function handleLCDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('lc-upload-zone').classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) processLCFile(e.dataTransfer.files[0]);
        }

        function handleLCUpload(input) { if (input.files.length > 0) processLCFile(input.files[0]); }

        function processLCFile(file) {
            if (file.size > 20 * 1024 * 1024) { showToast('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…é 20MB', 'error'); return; }
            lcFile = file;
            document.getElementById('lc-upload-zone').classList.add('has-file');
            document.getElementById('lc-upload-content').innerHTML = `
                <svg class="w-12 h-12 mx-auto mb-3 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <h4 class="text-lg font-semibold text-green-600 mb-1">ä¿¡ç”¨è­‰å·²ä¸Šè¼‰</h4>
                <p class="text-sm text-gray-500">é»æ“Šå¯é‡æ–°é¸æ“‡æ–‡ä»¶</p>
            `;
            const previewArea = document.getElementById('lc-preview-area');
            previewArea.style.display = 'block';
            previewArea.innerHTML = `
                <div class="doc-item">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3"><span class="text-blue-600">ğŸ“‹</span></div>
                        <div>
                            <div class="font-medium text-gray-800">${file.name}</div>
                            <div class="text-xs text-gray-500">${(file.size / 1024 / 1024).toFixed(2)} MB Â· ä¿¡ç”¨è­‰</div>
                        </div>
                    </div>
                    <button onclick="removeLCFile()" class="text-gray-400 hover:text-red-500 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    </button>
                </div>
                <div class="mt-4 text-center">
                    <button onclick="goToStep(2)" class="action-btn primary">
                        ä¸‹ä¸€æ­¥ï¼šä¸Šè¼‰ç›¸é—œå–®æ“š
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>
            `;
            showToast(`ä¿¡ç”¨è­‰ã€Œ${file.name}ã€å·²ä¸Šè¼‰`, 'success');
        }

        function removeLCFile() {
            lcFile = null;
            document.getElementById('lc-upload-zone').classList.remove('has-file');
            document.getElementById('lc-upload-content').innerHTML = `
                <svg class="w-14 h-14 mx-auto mb-3 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                <h4 class="text-lg font-semibold text-gray-700 mb-1">æ‹–æ”¾ä¿¡ç”¨è­‰æ–‡ä»¶åˆ°æ­¤è™•</h4>
                <p class="text-gray-500 text-sm mb-3">æˆ–é»æ“Šé¸æ“‡æ–‡ä»¶</p>
                <div class="flex flex-wrap justify-center gap-2 text-xs text-gray-400">
                    <span class="bg-gray-100 px-2 py-1 rounded">PDF</span>
                    <span class="bg-gray-100 px-2 py-1 rounded">JPG/PNG</span>
                    <span class="bg-gray-100 px-2 py-1 rounded">TIFF</span>
                    <span class="bg-gray-100 px-2 py-1 rounded">æœ€å¤§ 20MB</span>
                </div>
            `;
            document.getElementById('lc-preview-area').style.display = 'none';
            showToast('ä¿¡ç”¨è­‰å·²ç§»é™¤', 'info');
        }

        let selectedDocType = 'invoice';
        function selectDocType(type) {
            selectedDocType = type;
            document.querySelectorAll('#step2-content .standard-card').forEach(card => card.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
        }

        function triggerDocsUpload() { document.getElementById('docs-file-input').click(); }

        function handleDocsDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('docs-upload-zone').classList.remove('dragover');
            for (let file of e.dataTransfer.files) processDocFile(file);
        }

        function handleDocsUpload(input) {
            for (let file of input.files) processDocFile(file);
            input.value = '';
        }

        function processDocFile(file) {
            if (file.size > 20 * 1024 * 1024) { showToast(`æ–‡ä»¶ ${file.name} è¶…é 20MB é™åˆ¶`, 'error'); return; }
            uploadedDocs.push({ id: Date.now() + Math.random(), file: file, type: selectedDocType, name: file.name });
            updateDocsListUI();
            document.getElementById('next-to-step3').disabled = false;
            showToast(`${docTypeNames[selectedDocType]}ã€Œ${file.name}ã€å·²ä¸Šè¼‰`, 'success');
        }

        function updateDocsListUI() {
            const listEl = document.getElementById('uploaded-docs-list');
            if (uploadedDocs.length === 0) { listEl.innerHTML = ''; return; }
            listEl.innerHTML = `
                <h4 class="font-medium text-gray-700 mb-3">å·²ä¸Šè¼‰å–®æ“š (${uploadedDocs.length})</h4>
                ${uploadedDocs.map(doc => `
                    <div class="doc-item">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-3"><span>${docTypeIcons[doc.type]}</span></div>
                            <div>
                                <div class="font-medium text-gray-800">${doc.name}</div>
                                <div class="text-xs text-gray-500">${(doc.file.size / 1024 / 1024).toFixed(2)} MB Â· ${docTypeNames[doc.type]}</div>
                            </div>
                        </div>
                        <button onclick="removeDoc('${doc.id}')" class="text-gray-400 hover:text-red-500 transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>
                    </div>
                `).join('')}
            `;
        }

        function removeDoc(id) {
            uploadedDocs = uploadedDocs.filter(d => d.id != id);
            updateDocsListUI();
            if (uploadedDocs.length === 0) document.getElementById('next-to-step3').disabled = true;
            showToast('å–®æ“šå·²ç§»é™¤', 'info');
        }

        function toggleStandard(standard) {
            const card = document.getElementById(`standard-${standard}`);
            if (selectedStandards.includes(standard)) {
                selectedStandards = selectedStandards.filter(s => s !== standard);
                card.classList.remove('selected');
            } else {
                selectedStandards.push(standard);
                card.classList.add('selected');
            }
        }

        function startReview() {
            if (!lcFile) { showToast('è«‹å…ˆä¸Šè¼‰ä¿¡ç”¨è­‰', 'error'); return; }
            if (uploadedDocs.length === 0) { showToast('è«‹ä¸Šè¼‰è‡³å°‘ä¸€ä»½ç›¸é—œå–®æ“š', 'error'); return; }
            updateStepStatus(4);
            document.getElementById('wizard-interface').style.display = 'none';
            document.getElementById('chat-area').style.display = 'block';
            document.getElementById('input-area').style.display = 'block';
            const docList = uploadedDocs.map(d => docTypeNames[d.type]).join('ã€');
            addMessage('user', `è«‹å¯©æ ¸ä¿¡ç”¨è­‰ã€Œ${lcFile.name}ã€åŠç›¸é—œå–®æ“šï¼š${docList}`);
            performAnalysis();
        }

        function performAnalysis() {
            showTypingIndicator();
            setTimeout(() => {
                hideTypingIndicator();
                const summaryHtml = `
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ“Š å¯©æ ¸çµæœæ‘˜è¦</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            <div class="stat-card text-center"><div class="text-3xl font-bold text-blue-600 mb-1">${uploadedDocs.length + 1}</div><div class="text-sm text-gray-500">å¯©æ ¸å–®æ“š</div></div>
                            <div class="stat-card text-center"><div class="text-3xl font-bold text-red-500 mb-1">3</div><div class="text-sm text-gray-500">ä¸ç¬¦é»</div></div>
                            <div class="stat-card text-center"><div class="text-3xl font-bold text-amber-500 mb-1">2</div><div class="text-sm text-gray-500">éœ€é—œæ³¨</div></div>
                            <div class="stat-card text-center"><div class="text-3xl font-bold text-green-500 mb-1">87%</div><div class="text-sm text-gray-500">ç¬¦åˆç‡</div></div>
                        </div>
                        <div class="bg-red-50 border border-red-100 rounded-xl p-4 mb-4">
                            <div class="flex items-center mb-2"><span class="badge badge-error mr-2">éœ€è™•ç†</span><span class="font-medium text-gray-800">ç™¼ç¾ 3 é …ä¸ç¬¦é»éœ€è¦å¯©æ ¸äººå“¡ç¢ºèª</span></div>
                            <p class="text-sm text-gray-600">å»ºè­°ï¼šæ ¹æ“š UCP600 ç¬¬ 16 æ¢ï¼Œé–‹è­‰è¡Œæœ‰æ¬Šæ‹’çµ•æ¥å—å­˜åœ¨ä¸ç¬¦é»çš„å–®æ“šã€‚è«‹å¯©æ ¸ä»¥ä¸‹å•é¡Œä¸¦æ±ºå®šæ˜¯å¦è¯ç¹«ç”³è«‹äººã€‚</p>
                        </div>
                    </div>
                `;
                const discrepanciesHtml = `
                    <div class="mb-6">
                        <h4 class="font-semibold text-gray-800 mb-3">âš ï¸ ä¸ç¬¦é»è©³æƒ…</h4>
                        <div class="discrepancy-item discrepancy-high">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex items-center"><span class="badge badge-error mr-2">é«˜</span><span class="font-medium text-gray-800">D01: å–®æ“šé‡‘é¡ä¸ä¸€è‡´</span></div>
                                <button onclick="showSource('ucp600', 'Article 18', 'Commercial Invoice')" class="text-blue-600 text-sm hover:underline">æŸ¥çœ‹ä¾æ“š</button>
                            </div>
                            <p class="text-sm text-gray-700 mb-2">å•†æ¥­ç™¼ç¥¨é‡‘é¡ USD 125,500.00 èˆ‡ä¿¡ç”¨è­‰é‡‘é¡ USD 125,000.00 ä¸ç¬¦ï¼Œè¶…å‡ºå®¹å·®ç¯„åœã€‚</p>
                            <div class="flex items-center gap-2 text-xs text-gray-500"><span class="bg-white px-2 py-1 rounded">ğŸ“‹ å•†æ¥­ç™¼ç¥¨ ç¬¬2é </span><span class="bg-white px-2 py-1 rounded">ğŸ“œ L/C ç¬¬3æ¢</span></div>
                        </div>
                        <div class="discrepancy-item discrepancy-high">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex items-center"><span class="badge badge-error mr-2">é«˜</span><span class="font-medium text-gray-800">D02: è£é‹æ—¥æœŸé€¾æœŸ</span></div>
                                <button onclick="showSource('ucp600', 'Article 14', 'Late Shipment')" class="text-blue-600 text-sm hover:underline">æŸ¥çœ‹ä¾æ“š</button>
                            </div>
                            <p class="text-sm text-gray-700 mb-2">æå–®é¡¯ç¤ºè£é‹æ—¥æœŸç‚º 2025å¹´11æœˆ28æ—¥ï¼Œä¿¡ç”¨è­‰è¦å®šæœ€é²è£é‹æ—¥æœŸç‚º 2025å¹´11æœˆ25æ—¥ï¼Œé€¾æœŸ 3 å¤©ã€‚</p>
                            <div class="flex items-center gap-2 text-xs text-gray-500"><span class="bg-white px-2 py-1 rounded">ğŸš¢ æå–® ç¬¬1é </span><span class="bg-white px-2 py-1 rounded">ğŸ“œ L/C ç¬¬44Cæ¢</span></div>
                        </div>
                        <div class="discrepancy-item discrepancy-medium">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex items-center"><span class="badge badge-warning mr-2">ä¸­</span><span class="font-medium text-gray-800">D03: ä¿éšªé‡‘é¡ä¸è¶³</span></div>
                                <button onclick="showSource('ucp600', 'Article 28', 'Insurance Document')" class="text-blue-600 text-sm hover:underline">æŸ¥çœ‹ä¾æ“š</button>
                            </div>
                            <p class="text-sm text-gray-700 mb-2">ä¿éšªå–®æ“šæŠ•ä¿é‡‘é¡ç‚º USD 125,000.00ï¼Œä¿¡ç”¨è­‰è¦æ±‚æŠ•ä¿é‡‘é¡ä¸ä½æ–¼ç™¼ç¥¨é‡‘é¡ 110%ï¼Œå³ USD 137,500.00ã€‚</p>
                            <div class="flex items-center gap-2 text-xs text-gray-500"><span class="bg-white px-2 py-1 rounded">ğŸ›¡ï¸ ä¿éšªå–®æ“š ç¬¬1é </span><span class="bg-white px-2 py-1 rounded">ğŸ“œ L/C ç¬¬46Aæ¢</span></div>
                        </div>
                    </div>
                `;
                const warningsHtml = `
                    <div class="mb-6">
                        <h4 class="font-semibold text-gray-800 mb-3">ğŸ‘ï¸ éœ€é—œæ³¨é …ç›®</h4>
                        <div class="discrepancy-item discrepancy-low">
                            <div class="flex items-start justify-between mb-2"><div class="flex items-center"><span class="badge badge-success mr-2">ä½</span><span class="font-medium text-gray-800">W01: è²¨ç‰©æè¿°ç•¥æœ‰å·®ç•°</span></div></div>
                            <p class="text-sm text-gray-700">å•†æ¥­ç™¼ç¥¨ä¸­è²¨ç‰©æè¿°ä½¿ç”¨ "Electronic Components" è€Œä¿¡ç”¨è­‰ä½¿ç”¨ "Electronic Parts"ï¼ŒæŒ‰ ISBP 745 ç¬¬A19æ¢å¯æ¥å—ã€‚</p>
                        </div>
                        <div class="discrepancy-item discrepancy-low">
                            <div class="flex items-start justify-between mb-2"><div class="flex items-center"><span class="badge badge-success mr-2">ä½</span><span class="font-medium text-gray-800">W02: äº¤å–®æœŸé™æ¥è¿‘</span></div></div>
                            <p class="text-sm text-gray-700">è·ä¿¡ç”¨è­‰åˆ°æœŸæ—¥åƒ…é¤˜ 5 å€‹å·¥ä½œå¤©ï¼Œå»ºè­°å„˜å¿«å®Œæˆå¯©æ ¸æµç¨‹ã€‚</p>
                        </div>
                    </div>
                `;
                const complianceHtml = `
                    <div class="mb-6">
                        <h4 class="font-semibold text-gray-800 mb-3">âœ… åˆè¦é …ç›®</h4>
                        <div class="bg-green-50 rounded-xl p-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div class="flex items-center text-sm text-gray-700"><span class="text-green-500 mr-2">âœ“</span> å—ç›Šäººåç¨±èˆ‡åœ°å€æ­£ç¢º</div>
                                <div class="flex items-center text-sm text-gray-700"><span class="text-green-500 mr-2">âœ“</span> ç”³è«‹äººåç¨±èˆ‡åœ°å€æ­£ç¢º</div>
                                <div class="flex items-center text-sm text-gray-700"><span class="text-green-500 mr-2">âœ“</span> è£é‹æ¸¯/å¸è²¨æ¸¯ä¸€è‡´</div>
                                <div class="flex items-center text-sm text-gray-700"><span class="text-green-500 mr-2">âœ“</span> è²¿æ˜“è¡“èªç¬¦åˆè¦å®š</div>
                                <div class="flex items-center text-sm text-gray-700"><span class="text-green-500 mr-2">âœ“</span> æå–®å·²æ­£ç¢ºèƒŒæ›¸</div>
                                <div class="flex items-center text-sm text-gray-700"><span class="text-green-500 mr-2">âœ“</span> ç”¢åœ°è­‰æ˜æœ‰æ•ˆ</div>
                                <div class="flex items-center text-sm text-gray-700"><span class="text-green-500 mr-2">âœ“</span> è£ç®±å–®æ•¸é‡ä¸€è‡´</div>
                                <div class="flex items-center text-sm text-gray-700"><span class="text-green-500 mr-2">âœ“</span> åŒ¯ç¥¨æ ¼å¼æ­£ç¢º</div>
                            </div>
                        </div>
                    </div>
                `;
                addMessage('assistant', summaryHtml + discrepanciesHtml + warningsHtml + complianceHtml, true);
                setTimeout(() => {
                    const actionsHtml = `
                        <div class="mb-4">
                            <p class="text-gray-700 mb-4">æ‚¨å¯ä»¥é¸æ“‡ä»¥ä¸‹æ“ä½œï¼š</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <button onclick="askFollowUp('è«‹è©³ç´°è§£é‡‹è£é‹æ—¥æœŸé€¾æœŸçš„å½±éŸ¿')" class="action-btn justify-start"><span>ğŸ’¬</span> è©³ç´°è§£é‡‹ä¸ç¬¦é»</button>
                                <button onclick="askFollowUp('è«‹ç”Ÿæˆä¸ç¬¦é»é€šçŸ¥æ›¸')" class="action-btn justify-start"><span>ğŸ“„</span> ç”Ÿæˆä¸ç¬¦é»é€šçŸ¥æ›¸</button>
                                <button onclick="askFollowUp('è«‹æä¾›å¯èƒ½çš„è§£æ±ºæ–¹æ¡ˆ')" class="action-btn justify-start"><span>ğŸ’¡</span> å»ºè­°è§£æ±ºæ–¹æ¡ˆ</button>
                                <button onclick="askFollowUp('åŒ¯å‡ºå¯©æ ¸å ±å‘Š')" class="action-btn justify-start"><span>ğŸ“Š</span> åŒ¯å‡ºå¯©æ ¸å ±å‘Š</button>
                            </div>
                        </div>
                    `;
                    addMessage('assistant', actionsHtml, false);
                }, 500);
            }, 3000);
        }

        function addMessage(sender, content, hasActions = false) {
            const chatArea = document.getElementById('chat-area');
            const messageDiv = document.createElement('div');
            const messageId = 'msg_' + Date.now();
            messageDiv.className = `message-bubble ${sender}-message p-4 mb-4`;
            messageDiv.id = messageId;
            if (sender === 'assistant') {
                messageDiv.innerHTML = `<div class="prose prose-sm max-w-none">${content}</div>`;
                if (hasActions) {
                    messageDiv.innerHTML += `
                        <div class="mt-4 pt-4 border-t border-gray-100 flex items-center gap-2">
                            <button class="action-btn text-xs" onclick="likeMessage('${messageId}')">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 8.5m7 1.5v10"></path></svg>
                                æœ‰ç”¨
                            </button>
                            <button class="action-btn text-xs" onclick="dislikeMessage('${messageId}')">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018c.163 0 .326.02.485.06L17 4m-7 10v2a2 2 0 002 2h.095c.5 0 .905-.405.905-.905 0-.714.211-1.412.608-2.006L17 15.5m-7-1.5V4"></path></svg>
                                éœ€æ”¹é€²
                            </button>
                        </div>
                    `;
                }
            } else {
                messageDiv.textContent = content;
            }
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTypingIndicator() {
            isTyping = true;
            const chatArea = document.getElementById('chat-area');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'typing-indicator mb-4';
            typingDiv.innerHTML = `<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div><span class="ml-2 text-sm text-gray-500">AI æ­£åœ¨å¯©æ ¸å–®æ“š...</span>`;
            chatArea.appendChild(typingDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function hideTypingIndicator() {
            isTyping = false;
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
        }

        function askFollowUp(question) {
            addMessage('user', question);
            showTypingIndicator();
            setTimeout(() => {
                hideTypingIndicator();
                let response = '';
                if (question.includes('è£é‹æ—¥æœŸ')) {
                    response = `<h4 class="font-semibold text-gray-800 mb-3">ğŸ“‹ è£é‹æ—¥æœŸé€¾æœŸè©³ç´°åˆ†æ</h4>
                        <div class="bg-blue-50 rounded-xl p-4 mb-4">
                            <p class="text-sm text-gray-700 mb-3"><strong>UCP600 ç¬¬ 14 æ¢ (c) æ¬¾è¦å®šï¼š</strong></p>
                            <p class="text-sm text-gray-600 italic">"A presentation including one or more original transport documents subject to articles 19, 20, 21, 22, 23, 24 or 25 must be made by or on behalf of the beneficiary not later than 21 calendar days after the date of shipment..."</p>
                        </div>
                        <p class="text-gray-700 mb-3">æœ¬æ¡ˆä¸­ä¿¡ç”¨è­‰æ˜ç¢ºè¦å®šæœ€é²è£é‹æ—¥æœŸç‚º <strong>2025å¹´11æœˆ25æ—¥</strong>ï¼Œä½†æå–®é¡¯ç¤ºå¯¦éš›è£é‹æ—¥æœŸç‚º <strong>2025å¹´11æœˆ28æ—¥</strong>ï¼Œé€¾æœŸ 3 å¤©ã€‚</p>
                        <h5 class="font-medium text-gray-800 mb-2">å¯èƒ½çš„å½±éŸ¿ï¼š</h5>
                        <ul class="list-disc list-inside text-sm text-gray-700 mb-4 space-y-1">
                            <li>é–‹è­‰è¡Œæœ‰æ¬Šæ‹’çµ•æ¥å—å–®æ“š</li>
                            <li>å—ç›Šäººå¯èƒ½é¢è‡¨ä»˜æ¬¾å»¶é²æˆ–æ‹’ä»˜é¢¨éšª</li>
                            <li>ç”³è«‹äººéœ€æ±ºå®šæ˜¯å¦æ¥å—ä¸ç¬¦é»</li>
                        </ul>
                        <h5 class="font-medium text-gray-800 mb-2">å»ºè­°è™•ç†æ–¹å¼ï¼š</h5>
                        <ol class="list-decimal list-inside text-sm text-gray-700 space-y-1">
                            <li>ç«‹å³è¯ç¹«ç”³è«‹äººç¢ºèªæ˜¯å¦æ¥å—è©²ä¸ç¬¦é»</li>
                            <li>å¦‚ç”³è«‹äººåŒæ„ï¼Œç²å–æ›¸é¢æˆæ¬Š</li>
                            <li>åœ¨ä»˜æ¬¾å‰ç¢ºä¿æ‰€æœ‰ç›¸é—œæ–¹åŒæ„</li>
                        </ol>`;
                } else if (question.includes('ä¸ç¬¦é»é€šçŸ¥æ›¸')) {
                    response = `<h4 class="font-semibold text-gray-800 mb-3">ğŸ“„ ä¸ç¬¦é»é€šçŸ¥æ›¸å·²ç”Ÿæˆ</h4>
                        <div class="bg-gray-50 rounded-xl p-4 mb-4 font-mono text-sm">
                            <p class="mb-2"><strong>è‡´ï¼š</strong>[å—ç›Šäººåç¨±]</p>
                            <p class="mb-2"><strong>ä¿¡ç”¨è­‰è™Ÿç¢¼ï¼š</strong>LC2025112500001</p>
                            <p class="mb-2"><strong>æ—¥æœŸï¼š</strong>${new Date().toLocaleDateString('zh-HK')}</p>
                            <hr class="my-3 border-gray-200">
                            <p class="mb-3">ç¶“å¯©æ ¸è²´æ–¹æ–¼ ${new Date().toLocaleDateString('zh-HK')} æäº¤ä¹‹å–®æ“šï¼Œæœ¬è¡Œç™¼ç¾ä»¥ä¸‹ä¸ç¬¦é»ï¼š</p>
                            <ol class="list-decimal list-inside space-y-2 mb-3">
                                <li>å•†æ¥­ç™¼ç¥¨é‡‘é¡ USD 125,500.00 èˆ‡ä¿¡ç”¨è­‰é‡‘é¡ USD 125,000.00 ä¸ç¬¦</li>
                                <li>æå–®è£é‹æ—¥æœŸ 2025å¹´11æœˆ28æ—¥ é²æ–¼ä¿¡ç”¨è­‰è¦å®šä¹‹æœ€é²è£é‹æ—¥æœŸ 2025å¹´11æœˆ25æ—¥</li>
                                <li>ä¿éšªé‡‘é¡ USD 125,000.00 æœªé”ä¿¡ç”¨è­‰è¦æ±‚ä¹‹ CIF é‡‘é¡ 110%</li>
                            </ol>
                            <p>è«‹æ–¼ 5 å€‹éŠ€è¡Œå·¥ä½œå¤©å…§å›è¦†è™•ç†æ„è¦‹ã€‚</p>
                        </div>
                        <div class="flex gap-2">
                            <button class="action-btn primary text-sm" onclick="showToast('PDF ä¸‹è¼‰ä¸­...', 'info')"><span>ğŸ“¥</span> ä¸‹è¼‰ PDF</button>
                            <button class="action-btn text-sm" onclick="showToast('éƒµä»¶åŠŸèƒ½æº–å‚™ä¸­', 'info')"><span>âœ‰ï¸</span> ç™¼é€éƒµä»¶</button>
                        </div>`;
                } else if (question.includes('è§£æ±ºæ–¹æ¡ˆ')) {
                    response = `<h4 class="font-semibold text-gray-800 mb-3">ğŸ’¡ å»ºè­°è§£æ±ºæ–¹æ¡ˆ</h4>
                        <div class="space-y-4">
                            <div class="bg-blue-50 rounded-xl p-4">
                                <h5 class="font-medium text-gray-800 mb-2">æ–¹æ¡ˆä¸€ï¼šç”³è«‹äººæ¥å—ä¸ç¬¦é»</h5>
                                <p class="text-sm text-gray-700">è¯ç¹«ç”³è«‹äººï¼Œèªªæ˜ä¸ç¬¦é»è©³æƒ…ï¼Œå¦‚ç”³è«‹äººæ›¸é¢åŒæ„æ¥å—ï¼Œå¯ç¹¼çºŒè™•ç†ä»˜æ¬¾ã€‚</p>
                                <p class="text-xs text-gray-500 mt-2">é è¨ˆè™•ç†æ™‚é–“ï¼š1-2 å€‹å·¥ä½œå¤©</p>
                            </div>
                            <div class="bg-amber-50 rounded-xl p-4">
                                <h5 class="font-medium text-gray-800 mb-2">æ–¹æ¡ˆäºŒï¼šä¿®æ”¹ä¿¡ç”¨è­‰</h5>
                                <p class="text-sm text-gray-700">å¦‚ç”³è«‹äººåŒæ„ï¼Œå¯ä¿®æ”¹ä¿¡ç”¨è­‰ä»¥ç¬¦åˆå¯¦éš›æƒ…æ³ï¼ˆå»¶é•·è£é‹æ—¥æœŸã€èª¿æ•´é‡‘é¡ï¼‰ã€‚</p>
                                <p class="text-xs text-gray-500 mt-2">é è¨ˆè™•ç†æ™‚é–“ï¼š3-5 å€‹å·¥ä½œå¤©</p>
                            </div>
                            <div class="bg-green-50 rounded-xl p-4">
                                <h5 class="font-medium text-gray-800 mb-2">æ–¹æ¡ˆä¸‰ï¼šé€€å–®é‡åš</h5>
                                <p class="text-sm text-gray-700">å¦‚æƒ…æ³å…è¨±ï¼Œå—ç›Šäººå¯æ›´æ­£å–®æ“šå¾Œé‡æ–°æäº¤ï¼ˆå¦‚èª¿æ•´ç™¼ç¥¨é‡‘é¡ã€è£œå……ä¿éšªï¼‰ã€‚</p>
                                <p class="text-xs text-gray-500 mt-2">æ³¨æ„ï¼šè£é‹æ—¥æœŸå·²éï¼Œæ­¤é …ç„¡æ³•æ›´æ­£</p>
                            </div>
                        </div>`;
                } else if (question.includes('åŒ¯å‡º') || question.includes('å ±å‘Š')) {
                    response = `<h4 class="font-semibold text-gray-800 mb-3">ğŸ“Š å¯©æ ¸å ±å‘Šå·²æº–å‚™å°±ç·’</h4>
                        <div class="bg-gray-50 rounded-xl p-4 mb-4">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center mr-3"><span class="text-red-600">ğŸ“‘</span></div>
                                    <div>
                                        <div class="font-medium text-gray-800">LC_å¯©æ ¸å ±å‘Š_${new Date().toISOString().slice(0,10)}.pdf</div>
                                        <div class="text-xs text-gray-500">åŒ…å«å®Œæ•´å¯©æ ¸çµæœã€ä¸ç¬¦é»åˆ†æåŠå»ºè­°</div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-sm text-gray-600 mb-3">
                                <p>å ±å‘Šå…§å®¹åŒ…æ‹¬ï¼š</p>
                                <ul class="list-disc list-inside mt-2 space-y-1">
                                    <li>ä¿¡ç”¨è­‰åŠå–®æ“šåŸºæœ¬ä¿¡æ¯</li>
                                    <li>å¯©æ ¸çµæœæ‘˜è¦</li>
                                    <li>ä¸ç¬¦é»è©³ç´°åˆ†æ</li>
                                    <li>åˆè¦æª¢æŸ¥æ¸…å–®</li>
                                    <li>è™•ç†å»ºè­°</li>
                                </ul>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button class="action-btn primary text-sm" onclick="showToast('å ±å‘Šä¸‹è¼‰ä¸­...', 'info')"><span>ğŸ“¥</span> ä¸‹è¼‰ PDF å ±å‘Š</button>
                            <button class="action-btn text-sm" onclick="showToast('å ±å‘Šä¸‹è¼‰ä¸­...', 'info')"><span>ğŸ“Š</span> ä¸‹è¼‰ Excel æ•¸æ“š</button>
                        </div>`;
                } else {
                    response = `<p class="text-gray-700">æ„Ÿè¬æ‚¨çš„æŸ¥è©¢ã€‚æ ¹æ“šå·²å¯©æ ¸çš„å–®æ“šå’Œä¿¡ç”¨è­‰æ¢æ¬¾ï¼Œæˆ‘å·²è¨˜éŒ„æ‚¨çš„å•é¡Œã€‚</p>
                        <p class="text-gray-700 mt-2">å¦‚éœ€é€²ä¸€æ­¥å”åŠ©ï¼Œæ‚¨å¯ä»¥ï¼š</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-2">
                            <li>è©¢å•ç‰¹å®šä¸ç¬¦é»çš„è©³ç´°ä¿¡æ¯</li>
                            <li>è«‹æ±‚ç”Ÿæˆç›¸é—œæ–‡ä»¶</li>
                            <li>æŸ¥è©¢é©ç”¨çš„åœ‹éš›è¦å‰‡æ¢æ¬¾</li>
                        </ul>`;
                }
                addMessage('assistant', response, true);
            }, 1500);
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            if (!message || isTyping) return;
            addMessage('user', message);
            input.value = '';
            askFollowUp(message);
        }

        function showSource(standard, article, topic) {
            const standardNames = { 'ucp600': 'UCP 600 - è·Ÿå–®ä¿¡ç”¨è­‰çµ±ä¸€æ…£ä¾‹', 'isbp': 'ISBP 745 - åœ‹éš›æ¨™æº–éŠ€è¡Œå¯¦å‹™' };
            const contents = {
                'Article 18': 'The description of the goods, services or performance in a commercial invoice must correspond with that appearing in the credit.',
                'Article 14': 'A nominated bank acting on its nomination, a confirming bank, if any, and the issuing bank must examine a presentation to determine, on the basis of the documents alone, whether or not the documents appear on their face to constitute a complying presentation.',
                'Article 28': 'An insurance document must appear to be issued and signed by an insurance company, an underwriter or their agents or their proxies. The amount of insurance coverage must be at least 110% of the CIF or CIP value of the goods.'
            };
            document.getElementById('source-standard').textContent = standardNames[standard] || standard;
            document.getElementById('source-article').textContent = article;
            document.getElementById('source-section').textContent = topic;
            document.getElementById('source-content').textContent = contents[article] || 'æ¢æ¬¾å…§å®¹è¼‰å…¥ä¸­...';
            document.getElementById('source-modal').classList.add('show');
        }

        function closeSourceModal() { document.getElementById('source-modal').classList.remove('show'); }

        function likeMessage(id) { showToast('æ„Ÿè¬æ‚¨çš„åé¥‹ï¼é€™å°‡å¹«åŠ©æˆ‘å€‘æ”¹é€²å¯©æ ¸æº–ç¢ºåº¦', 'success'); }
        function dislikeMessage(id) { showToast('å·²è¨˜éŒ„æ‚¨çš„åé¥‹ï¼Œæˆ‘å€‘æœƒæŒçºŒå„ªåŒ–å¯©æ ¸é‚è¼¯', 'info'); }

        function resetWizard() {
            lcFile = null;
            uploadedDocs = [];
            selectedStandards = ['ucp600', 'isbp'];
            currentStep = 1;
            document.getElementById('wizard-interface').style.display = 'block';
            document.getElementById('chat-area').style.display = 'none';
            document.getElementById('chat-area').innerHTML = '';
            document.getElementById('input-area').style.display = 'none';
            updateStepStatus(1);
            goToStep(1);
            removeLCFile();
            document.getElementById('uploaded-docs-list').innerHTML = '';
            document.getElementById('next-to-step3').disabled = true;
            document.querySelectorAll('#step3-content .standard-card').forEach(card => card.classList.remove('selected'));
            document.getElementById('standard-ucp600').classList.add('selected');
            document.getElementById('standard-isbp').classList.add('selected');
            showToast('å·²é‡ç½®ï¼Œå¯é–‹å§‹æ–°çš„å¯©æ ¸', 'info');
        }

        document.addEventListener('DOMContentLoaded', function() {
            updateStepStatus(1);
            document.getElementById('source-modal').addEventListener('click', function(e) { if (e.target === this) closeSourceModal(); });
        });
    </script>
</body>
</html>