<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¶æ„æ™ºèƒ½åŠ©æ‰‹ - AIèµ‹èƒ½æ¶æ„ç®¡æ§å¹³å°</title>
    <script src="/console/style/tailwindcss.3.0.23.js"></script>
    <script src="/scripts/mermaid.min.js"></script>
    <style>
        body {
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .liquid-glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .liquid-glass-strong {
            
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        }
        
        .specular-highlight {
            position: relative;
            overflow: hidden;
        }
        
        .specular-highlight::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s ease;
            pointer-events: none;
        }
        
        .specular-highlight:hover::before {
            left: 100%;
        }
        
        .question-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            padding: 16px;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
        }
        
        .question-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.1);
            border-color: rgba(102, 126, 234, 0.3);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .message-bubble {
            max-width: 85%;
            word-wrap: break-word;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .user-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-left: auto;
            border-radius: 18px 18px 4px 18px;
        }
        
        .assistant-message {
            background: rgba(255, 255, 255, 0.95);
            color: #374151;
            margin-right: auto;
            border-radius: 18px 18px 18px 4px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 18px 18px 18px 4px;
            margin-right: auto;
            max-width: 85%;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #9ca3af;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }
        
        .source-reference {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .source-reference:hover {
            background: rgba(102, 126, 234, 0.15);
            transform: translateY(-1px);
        }
        
        .floating-button {
            transform: translateY(0);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .floating-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .chat-input {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            padding: 12px 16px;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .chat-input:focus {
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            max-width: 600px;
            max-height: 80vh;
            margin: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s ease;
            overflow: hidden;
        }
        
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }
        
        .highlight {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .reference-tag {
            display: inline-block;
            background: rgba(102, 126, 234, 0.1);
            color: #5b21b6;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin: 2px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }
        
        .message-actions {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.8);
            color: #6b7280;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            background: rgba(255, 255, 255, 0.95);
            border-color: rgba(102, 126, 234, 0.3);
            color: #374151;
        }
        
        .action-btn.active {
            background: rgba(102, 126, 234, 0.1);
            border-color: rgba(102, 126, 234, 0.3);
            color: #5b21b6;
        }
        
        .action-btn.like.active {
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.3);
            color: #059669;
        }
        
        .action-btn.dislike.active {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: #dc2626;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 16px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
            min-width: 300px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            border-left: 4px solid #10b981;
        }
        
        .toast.error {
            border-left: 4px solid #ef4444;
        }
        
        .toast.info {
            border-left: 4px solid #667eea;
        }
        
        .architecture-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin: 2px;
        }
        
        .badge-business {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .badge-application {
            background: rgba(102, 126, 234, 0.1);
            color: #5b21b6;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }
        
        .badge-data {
            background: rgba(34, 197, 94, 0.1);
            color: #059669;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }
        
        .badge-technology {
            background: rgba(251, 146, 60, 0.1);
            color: #ea580c;
            border: 1px solid rgba(251, 146, 60, 0.2);
        }
        
        .mermaid-container {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            overflow-x: auto;
        }
        
        .mermaid {
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body class="h-screen flex flex-col">
    <!-- ä¸»å®¹å™¨ -->
    <div class="flex-1 flex flex-col overflow-hidden">
        <!-- èŠå¤©ç•Œé¢ -->
        <div class="flex-1 flex flex-col overflow-hidden liquid-glass-strong rounded-lg">
            <!-- èŠå¤©å¤´éƒ¨ -->
            <div class="liquid-glass-strong rounded-t-lg p-4 flex items-center justify-between border-b border-white/20">
                <div class="flex items-center">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center mr-4">
                        <span class="text-white text-xl">ğŸ—ï¸</span>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">æ¶æ„æ™ºèƒ½åŠ©æ‰‹ AIA</h3>
                        <p class="text-sm text-gray-500">AIèµ‹èƒ½æ¶æ„ç®¡æ§ Â· æ™ºèƒ½åˆ†æ Â· ç²¾å‡†å†³ç­–</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="showArchitectureView()" class="liquid-glass floating-button rounded-lg px-4 py-2 text-sm font-medium text-gray-700 specular-highlight">
                        æ¶æ„å…¨æ™¯
                    </button>
                    <button onclick="clearChat()" class="liquid-glass floating-button rounded-lg px-4 py-2 text-sm font-medium text-gray-700 specular-highlight">
                        æ–°å»ºä¼šè¯
                    </button>
                </div>
            </div>
            
            <!-- æ¶ˆæ¯åŒºåŸŸ -->
            <div id="messages-container" class="flex-1 p-6 overflow-y-auto">
                <!-- åŠ©æ‰‹ä»‹ç»æ¶ˆæ¯ -->
                <div class="message-bubble assistant-message p-4 mb-4">
                    <div class="prose prose-sm max-w-none text-gray-700 mb-4">
                        <p class="mb-3">ğŸ‘‹ æ‚¨å¥½ï¼Œæˆ‘æ˜¯æ¶æ„æ™ºèƒ½åŠ©æ‰‹AIAï¼Œä¸“æ³¨äºä¼ä¸šæ¶æ„ç®¡æ§å’Œä¼˜åŒ–ã€‚</p>
                        <p class="mb-3">æˆ‘èƒ½å¤Ÿå¸®åŠ©æ‚¨ï¼š</p>
                        <ul class="list-disc pl-5 space-y-1 text-sm">
                            <li><strong>æ¶æ„è®¾è®¡å’¨è¯¢</strong>ï¼šæä¾›æ¶æ„è®¾è®¡å»ºè®®å’Œæœ€ä½³å®è·µ</li>
                            <li><strong>ä¾èµ–å…³ç³»åˆ†æ</strong>ï¼šè¯†åˆ«ç³»ç»Ÿé—´çš„ä¾èµ–å’Œå½±å“</li>
                            <li><strong>æ¶æ„è¯„ä¼°è¯Šæ–­</strong>ï¼šè‡ªåŠ¨è¯„ä¼°æ¶æ„å¥åº·åº¦</li>
                            <li><strong>æŠ€æœ¯å€ºåŠ¡è¯†åˆ«</strong>ï¼šå‘ç°æ½œåœ¨çš„æŠ€æœ¯é£é™©</li>
                            <li><strong>æ¶æ„åŸåˆ™æ£€æŸ¥</strong>ï¼šéªŒè¯æ˜¯å¦ç¬¦åˆæ¶æ„è§„èŒƒ</li>
                        </ul>
                        <div class="mt-3 flex flex-wrap gap-2">
                            <span class="architecture-badge badge-business">ä¸šåŠ¡æ¶æ„</span>
                            <span class="architecture-badge badge-application">åº”ç”¨æ¶æ„</span>
                            <span class="architecture-badge badge-data">æ•°æ®æ¶æ„</span>
                            <span class="architecture-badge badge-technology">æŠ€æœ¯æ¶æ„</span>
                        </div>
                    </div>
                    <p class="text-gray-700 font-medium">ğŸ¤” æ‚¨å¯ä»¥è¿™æ ·é—®æˆ‘ï¼š</p>
                </div>
                
                <!-- é¢„è®¾é—®é¢˜å¡ç‰‡ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="question-card specular-highlight" onclick="askQuestion('æŸ¥æ‰¾æ‰€æœ‰ä½¿ç”¨MySQLæ•°æ®åº“çš„ç³»ç»ŸåŠå…¶ä¾èµ–å…³ç³»')">
                        <div class="flex items-start">
                            <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-indigo-600 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                <span class="text-white text-sm">ğŸ”</span>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800 mb-1">ç³»ç»Ÿä¾èµ–æŸ¥è¯¢</h4>
                                <p class="text-sm text-gray-600">æŸ¥æ‰¾æ‰€æœ‰ä½¿ç”¨MySQLæ•°æ®åº“çš„ç³»ç»ŸåŠå…¶ä¾èµ–å…³ç³»</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="question-card specular-highlight" onclick="askQuestion('è¯„ä¼°è®¢å•ç³»ç»Ÿçš„æ¶æ„å¥åº·åº¦ï¼Œè¯†åˆ«æ½œåœ¨æŠ€æœ¯å€ºåŠ¡')">
                        <div class="flex items-start">
                            <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-emerald-600 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                <span class="text-white text-sm">ğŸ“Š</span>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800 mb-1">æ¶æ„å¥åº·è¯„ä¼°</h4>
                                <p class="text-sm text-gray-600">è¯„ä¼°è®¢å•ç³»ç»Ÿçš„æ¶æ„å¥åº·åº¦ï¼Œè¯†åˆ«æ½œåœ¨æŠ€æœ¯å€ºåŠ¡</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="question-card specular-highlight" onclick="askQuestion('å¾®æœåŠ¡æ¶æ„è½¬å‹çš„æœ€ä½³å®è·µå’Œè·¯çº¿å›¾å»ºè®®')">
                        <div class="flex items-start">
                            <div class="w-8 h-8 bg-gradient-to-br from-purple-400 to-pink-600 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                <span class="text-white text-sm">ğŸ’¡</span>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800 mb-1">æ¶æ„è®¾è®¡æŒ‡å¯¼</h4>
                                <p class="text-sm text-gray-600">å¾®æœåŠ¡æ¶æ„è½¬å‹çš„æœ€ä½³å®è·µå’Œè·¯çº¿å›¾å»ºè®®</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="question-card specular-highlight" onclick="askQuestion('åˆ†ææ”¯ä»˜ç³»ç»Ÿå˜æ›´å¯¹å…¶ä»–ç³»ç»Ÿçš„å½±å“èŒƒå›´')">
                        <div class="flex items-start">
                            <div class="w-8 h-8 bg-gradient-to-br from-orange-400 to-red-600 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                <span class="text-white text-sm">ğŸ¯</span>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800 mb-1">å½±å“åˆ†æ</h4>
                                <p class="text-sm text-gray-600">åˆ†ææ”¯ä»˜ç³»ç»Ÿå˜æ›´å¯¹å…¶ä»–ç³»ç»Ÿçš„å½±å“èŒƒå›´</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="p-4 border-t border-white/20">
                <div class="flex items-end space-x-3">
                    <div class="flex-1">
                        <input type="text" 
                               id="message-input"
                               placeholder="è¯·æè¿°æ‚¨çš„æ¶æ„é—®é¢˜æˆ–éœ€æ±‚..."
                               class="w-full chat-input"
                               onkeypress="if(event.key==='Enter') sendMessage()">
                    </div>
                    <button onclick="sendMessage()" 
                            class="liquid-glass floating-button rounded-lg p-3 specular-highlight bg-gradient-to-r from-purple-500 to-indigo-600 text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                    </button>
                    <button onclick="uploadArchitecture()" 
                            class="liquid-glass floating-button rounded-lg p-3 specular-highlight text-gray-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¶æ„è¯¦æƒ…å¼¹çª— -->
    <div id="source-modal" class="modal-overlay">
        <div class="modal-content">
            <!-- å¼¹çª—å¤´éƒ¨ -->
            <div class="flex items-center justify-between p-6 border-b border-gray-200/50">
                <h3 class="text-lg font-semibold text-gray-800">æ¶æ„èµ„æºè¯¦æƒ…</h3>
                <button onclick="closeSourceModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- å¼¹çª—å†…å®¹ -->
            <div class="p-6 overflow-y-auto max-h-96">
                <!-- æ¶æ„ä¿¡æ¯ -->
                <div class="mb-6">
                    <h4 class="font-semibold text-gray-800 mb-2">ğŸ—ï¸ æ¶æ„ä¿¡æ¯</h4>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <p class="text-sm text-gray-600 mb-2">
                            <span class="font-medium">æ¶æ„åŸŸï¼š</span>
                            <span id="doc-title">-</span>
                        </p>
                        <p class="text-sm text-gray-600 mb-2">
                            <span class="font-medium">ç³»ç»Ÿ/ç»„ä»¶ï¼š</span>
                            <span id="doc-section">-</span>
                        </p>
                        <p class="text-sm text-gray-600">
                            <span class="font-medium">èµ„æºé“¾æ¥ï¼š</span>
                            <span id="doc-url" class="text-blue-600">-</span>
                        </p>
                    </div>
                </div>
                
                <!-- è¯¦ç»†å†…å®¹ -->
                <div class="mb-6">
                    <h4 class="font-semibold text-gray-800 mb-2">ğŸ“‹ è¯¦ç»†è¯´æ˜</h4>
                    <div class="bg-blue-50 rounded-lg p-4">
                        <div id="slice-content" class="text-sm text-gray-700 leading-relaxed">
                            -
                        </div>
                    </div>
                </div>
                
                <!-- ç›¸å…³æ ‡ç­¾ -->
                <div>
                    <h4 class="font-semibold text-gray-800 mb-2">ğŸ·ï¸ æ¶æ„æ ‡ç­¾</h4>
                    <div id="reference-tags" class="flex flex-wrap gap-2">
                        <!-- æ ‡ç­¾å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <!-- å¼¹çª—åº•éƒ¨ -->
            <div class="flex items-center justify-between p-6 border-t border-gray-200/50">
                <div class="text-sm text-gray-500">
                    ç½®ä¿¡åº¦ï¼š<span class="font-semibold text-green-600" id="accuracy-rate">-</span>
                </div>
                <div class="flex space-x-3">
                    <button onclick="viewDependencies()" class="liquid-glass floating-button rounded-lg px-4 py-2 text-sm font-medium text-gray-700 specular-highlight">
                        æŸ¥çœ‹ä¾èµ–
                    </button>
                    <button onclick="closeSourceModal()" class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-lg px-4 py-2 text-sm font-medium hover:opacity-90 transition-opacity">
                        ç¡®å®š
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toastå®¹å™¨ -->
    <div id="toast-container"></div>

    <script>
        // åˆå§‹åŒ– Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#1f2937',
                primaryBorderColor: '#e5e7eb',
                lineColor: '#6b7280',
                secondaryColor: '#f3f4f6',
                tertiaryColor: '#ffffff'
            }
        });

        let conversationHistory = [];
        let isTyping = false;
        let currentContext = [];

        // æ¶æ„çŸ¥è¯†åº“
        const architectureKnowledge = {
            'mysqlç³»ç»Ÿ': {
                content: `æ ¹æ®æ¶æ„èµ„äº§åˆ†æï¼Œä»¥ä¸‹ç³»ç»Ÿä½¿ç”¨MySQLæ•°æ®åº“ï¼š

**æ ¸å¿ƒç³»ç»Ÿï¼š**
1. **è®¢å•ç®¡ç†ç³»ç»Ÿ (OMS)**
   - ç‰ˆæœ¬ï¼šMySQL 5.7
   - å®ä¾‹æ•°ï¼šä¸»ä»æ¶æ„ï¼Œ3ä¸ªå®ä¾‹
   - ä¾èµ–ç³»ç»Ÿï¼šæ”¯ä»˜ç³»ç»Ÿã€åº“å­˜ç³»ç»Ÿã€ç‰©æµç³»ç»Ÿ

2. **ç”¨æˆ·ä¸­å¿ƒç³»ç»Ÿ (UCS)**
   - ç‰ˆæœ¬ï¼šMySQL 8.0
   - å®ä¾‹æ•°ï¼šåˆ†åº“åˆ†è¡¨ï¼Œ8ä¸ªå®ä¾‹
   - ä¾èµ–ç³»ç»Ÿï¼šè®¤è¯ç³»ç»Ÿã€æƒé™ç³»ç»Ÿã€å®¡è®¡ç³»ç»Ÿ

3. **äº§å“ç®¡ç†ç³»ç»Ÿ (PMS)**
   - ç‰ˆæœ¬ï¼šMySQL 5.7
   - å®ä¾‹æ•°ï¼šä¸»å¤‡æ¶æ„ï¼Œ2ä¸ªå®ä¾‹
   - ä¾èµ–ç³»ç»Ÿï¼šå®šä»·ç³»ç»Ÿã€ä¿ƒé”€ç³»ç»Ÿ

**æŠ€æœ¯å€ºåŠ¡è¯†åˆ«ï¼š**
- âš ï¸ OMSç³»ç»Ÿä½¿ç”¨MySQL 5.7ç‰ˆæœ¬ï¼Œå»ºè®®å‡çº§åˆ°8.0
- âš ï¸ å­˜åœ¨å•ç‚¹æ•…éšœé£é™©çš„ç³»ç»Ÿï¼šäº§å“ç®¡ç†ç³»ç»Ÿ
- âœ… ç”¨æˆ·ä¸­å¿ƒç³»ç»Ÿæ¶æ„è®¾è®¡åˆç†ï¼Œé«˜å¯ç”¨æ€§è‰¯å¥½`,
                mermaid: `graph TD
    OMS[è®¢å•ç®¡ç†ç³»ç»Ÿ<br/>MySQL 5.7] --> PAY[æ”¯ä»˜ç³»ç»Ÿ]
    OMS --> INV[åº“å­˜ç³»ç»Ÿ]
    OMS --> LOG[ç‰©æµç³»ç»Ÿ]
    
    UCS[ç”¨æˆ·ä¸­å¿ƒç³»ç»Ÿ<br/>MySQL 8.0] --> AUTH[è®¤è¯ç³»ç»Ÿ]
    UCS --> PERM[æƒé™ç³»ç»Ÿ]
    UCS --> AUDIT[å®¡è®¡ç³»ç»Ÿ]
    
    PMS[äº§å“ç®¡ç†ç³»ç»Ÿ<br/>MySQL 5.7] --> PRICE[å®šä»·ç³»ç»Ÿ]
    PMS --> PROMO[ä¿ƒé”€ç³»ç»Ÿ]
    
    style OMS fill:#fff4e6
    style PMS fill:#fff4e6
    style UCS fill:#e6f7ff`,
                source: {
                    title: 'åº”ç”¨æ¶æ„èµ„äº§',
                    section: 'æ•°æ®å­˜å‚¨å±‚ - MySQLé›†ç¾¤',
                    url: 'http://architecture.platform/assets/database/mysql',
                    slice: 'ç³»ç»Ÿæ•°æ®å­˜å‚¨æ¶æ„é‡‡ç”¨<span class="highlight">MySQLæ•°æ®åº“é›†ç¾¤</span>ï¼Œå…¶ä¸­è®¢å•ç®¡ç†ç³»ç»Ÿé‡‡ç”¨<span class="highlight">ä¸»ä»æ¶æ„</span>ä¿è¯é«˜å¯ç”¨ï¼Œç”¨æˆ·ä¸­å¿ƒç³»ç»Ÿé‡‡ç”¨<span class="highlight">åˆ†åº“åˆ†è¡¨ç­–ç•¥</span>åº”å¯¹é«˜å¹¶å‘ï¼Œäº§å“ç®¡ç†ç³»ç»Ÿéœ€è¦ä¼˜åŒ–ä¸ºé«˜å¯ç”¨æ¶æ„ã€‚',
                    tags: ['MySQL', 'æ•°æ®æ¶æ„', 'ç³»ç»Ÿä¾èµ–', 'æ•°æ®åº“é›†ç¾¤'],
                    accuracy: 95
                }
            },
            'æ¶æ„å¥åº·åº¦': {
                content: `è®¢å•ç³»ç»Ÿæ¶æ„å¥åº·åº¦è¯„ä¼°æŠ¥å‘Šï¼š

**æ•´ä½“è¯„åˆ†ï¼š78/100** ğŸŸ¡

**æ¶æ„ç»´åº¦åˆ†æï¼š**

ğŸ“Š **æ€§èƒ½æŒ‡æ ‡ï¼ˆ85åˆ†ï¼‰**
- å“åº”æ—¶é—´ï¼šP99 < 200ms âœ…
- ååé‡ï¼š10000 TPS âœ…
- èµ„æºåˆ©ç”¨ç‡ï¼šCPU 65%, å†…å­˜ 70%

ğŸ”§ **å¯ç»´æŠ¤æ€§ï¼ˆ72åˆ†ï¼‰**
- ä»£ç å¤æ‚åº¦ï¼šåé«˜ï¼Œå¾ªç¯å¤æ‚åº¦è¶…æ ‡
- æ¨¡å—è€¦åˆåº¦ï¼šä¸­ç­‰ï¼Œå­˜åœ¨å¾ªç¯ä¾èµ–
- æ–‡æ¡£å®Œæ•´åº¦ï¼š70%

ğŸ›¡ï¸ **å¯é æ€§ï¼ˆ80åˆ†ï¼‰**
- å¯ç”¨æ€§ï¼š99.95% SLA
- æ•…éšœæ¢å¤ï¼šRTO 5åˆ†é’Ÿï¼ŒRPO 1åˆ†é’Ÿ
- å®¹ç¾èƒ½åŠ›ï¼šåŒæ´»æ¶æ„

**æŠ€æœ¯å€ºåŠ¡æ¸…å•ï¼š**
1. ğŸ”´ **é«˜ä¼˜å…ˆçº§**ï¼šæ•°æ®åº“ç‰ˆæœ¬è¿‡æ—§ï¼ˆMySQL 5.6ï¼‰
2. ğŸŸ¡ **ä¸­ä¼˜å…ˆçº§**ï¼šç¼ºå°‘æœåŠ¡ç†”æ–­æœºåˆ¶
3. ğŸŸ¢ **ä½ä¼˜å…ˆçº§**ï¼šä»£ç æ³¨é‡Šè¦†ç›–ç‡ä½

**æ”¹è¿›å»ºè®®ï¼š**
- çŸ­æœŸï¼šå‡çº§æ•°æ®åº“ç‰ˆæœ¬ï¼Œå¼•å…¥ç†”æ–­å™¨
- ä¸­æœŸï¼šé‡æ„æ ¸å¿ƒæ¨¡å—ï¼Œé™ä½è€¦åˆåº¦
- é•¿æœŸï¼šå‘å¾®æœåŠ¡æ¶æ„æ¼”è¿›`,
                mermaid: `graph LR
    A[è®¢å•ç³»ç»Ÿ] --> B{å¥åº·åº¦è¯„ä¼°}
    B --> C[æ€§èƒ½ 85åˆ†]
    B --> D[å¯ç»´æŠ¤æ€§ 72åˆ†]
    B --> E[å¯é æ€§ 80åˆ†]
    
    D --> F[ä»£ç å¤æ‚åº¦é«˜]
    D --> G[æ¨¡å—è€¦åˆåº¦ä¸­]
    D --> H[æ–‡æ¡£è¦†ç›–70%]
    
    F --> I[éœ€è¦é‡æ„]
    G --> I
    
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style B fill:#bbf,stroke:#333,stroke-width:2px
    style I fill:#fbb,stroke:#333,stroke-width:2px`,
                source: {
                    title: 'æ¶æ„è¯„ä¼°æŠ¥å‘Š',
                    section: 'è®¢å•ç³»ç»Ÿ - 2024Q4è¯„ä¼°',
                    url: 'http://architecture.platform/assessment/oms-2024q4',
                    slice: 'è®¢å•ç³»ç»Ÿæ¶æ„è¯„ä¼°æ˜¾ç¤º<span class="highlight">æ•´ä½“å¥åº·åº¦78åˆ†</span>ï¼Œä¸»è¦é—®é¢˜é›†ä¸­åœ¨<span class="highlight">å¯ç»´æŠ¤æ€§æ–¹é¢</span>ã€‚å»ºè®®ä¼˜å…ˆå¤„ç†æ•°æ®åº“ç‰ˆæœ¬å‡çº§å’Œå¼•å…¥æœåŠ¡ç†”æ–­æœºåˆ¶ï¼Œä¸­æœŸè¿›è¡Œæ¨¡å—è§£è€¦é‡æ„ã€‚',
                    tags: ['æ¶æ„è¯„ä¼°', 'å¥åº·åº¦', 'æŠ€æœ¯å€ºåŠ¡', 'è®¢å•ç³»ç»Ÿ'],
                    accuracy: 92
                }
            },
            'å¾®æœåŠ¡è½¬å‹': {
                content: `å¾®æœåŠ¡æ¶æ„è½¬å‹æœ€ä½³å®è·µä¸è·¯çº¿å›¾ï¼š

**ğŸ¯ è½¬å‹ç›®æ ‡ï¼š**
å°†å•ä½“åº”ç”¨æ‹†åˆ†ä¸ºæ¾è€¦åˆã€é«˜å†…èšçš„å¾®æœåŠ¡é›†ç¾¤

**ğŸ“‹ æœ€ä½³å®è·µï¼š**

1. **æœåŠ¡æ‹†åˆ†åŸåˆ™**
   - DDDé¢†åŸŸé©±åŠ¨è®¾è®¡
   - å•ä¸€èŒè´£åŸåˆ™
   - æ•°æ®åº“ç‹¬ç«‹åŸåˆ™
   - æ¥å£æ ‡å‡†åŒ–

2. **æŠ€æœ¯æ ˆé€‰å‹**
   - æœåŠ¡æ¡†æ¶ï¼šSpring Cloud / Dubbo
   - æ³¨å†Œä¸­å¿ƒï¼šNacos / Consul
   - é…ç½®ä¸­å¿ƒï¼šApollo / Nacos Config
   - ç½‘å…³ï¼šSpring Cloud Gateway / Kong
   - æœåŠ¡ç½‘æ ¼ï¼šIstioï¼ˆå¯é€‰ï¼‰

3. **è½¬å‹è·¯çº¿å›¾**

**Phase 1ï¼šå‡†å¤‡é˜¶æ®µï¼ˆ1-2æœˆï¼‰**
- å›¢é˜ŸåŸ¹è®­ä¸æŠ€èƒ½å‚¨å¤‡
- æŠ€æœ¯æ ˆé€‰å‹ä¸POCéªŒè¯
- åˆ¶å®šæ‹†åˆ†ç­–ç•¥

**Phase 2ï¼šè¯•ç‚¹é˜¶æ®µï¼ˆ3-4æœˆï¼‰**
- é€‰æ‹©è¾¹ç¼˜æœåŠ¡è¯•ç‚¹
- å»ºç«‹CI/CDæµæ°´çº¿
- ç›‘æ§ä½“ç³»å»ºè®¾

**Phase 3ï¼šæ¨å¹¿é˜¶æ®µï¼ˆ5-8æœˆï¼‰**
- æ ¸å¿ƒæœåŠ¡é€æ­¥æ‹†åˆ†
- æœåŠ¡æ²»ç†ä½“ç³»å®Œå–„
- æ€§èƒ½ä¼˜åŒ–ä¸è°ƒä¼˜

**Phase 4ï¼šä¼˜åŒ–é˜¶æ®µï¼ˆ9-12æœˆï¼‰**
- å…¨é¢å¾®æœåŠ¡åŒ–
- å¼•å…¥æœåŠ¡ç½‘æ ¼ï¼ˆå¯é€‰ï¼‰
- æŒç»­ä¼˜åŒ–è¿­ä»£`,
                mermaid: `timeline
    title å¾®æœåŠ¡è½¬å‹è·¯çº¿å›¾
    
    Q1 2024 : å‡†å¤‡é˜¶æ®µ
            : å›¢é˜ŸåŸ¹è®­
            : æŠ€æœ¯é€‰å‹
            : POCéªŒè¯
    
    Q2 2024 : è¯•ç‚¹é˜¶æ®µ
            : è¾¹ç¼˜æœåŠ¡æ‹†åˆ†
            : CI/CDå»ºè®¾
            : ç›‘æ§ä½“ç³»
    
    Q3 2024 : æ¨å¹¿é˜¶æ®µ
            : æ ¸å¿ƒæœåŠ¡æ‹†åˆ†
            : æœåŠ¡æ²»ç†
            : æ€§èƒ½ä¼˜åŒ–
    
    Q4 2024 : ä¼˜åŒ–é˜¶æ®µ
            : å…¨é¢å¾®æœåŠ¡åŒ–
            : æœåŠ¡ç½‘æ ¼
            : æŒç»­è¿­ä»£`,
                source: {
                    title: 'æ¶æ„è½¬å‹æŒ‡å—',
                    section: 'å¾®æœåŠ¡æ¶æ„è½¬å‹å®è·µ',
                    url: 'http://architecture.platform/guides/microservice-transformation',
                    slice: 'å¾®æœåŠ¡è½¬å‹éœ€è¦éµå¾ª<span class="highlight">æ¸è¿›å¼æ¼”è¿›åŸåˆ™</span>ï¼Œä»è¾¹ç¼˜æœåŠ¡å¼€å§‹è¯•ç‚¹ï¼Œé€æ­¥æ¨å¹¿åˆ°æ ¸å¿ƒæœåŠ¡ã€‚å…³é”®æˆåŠŸè¦ç´ åŒ…æ‹¬<span class="highlight">å›¢é˜ŸæŠ€èƒ½å‚¨å¤‡</span>ã€<span class="highlight">è‡ªåŠ¨åŒ–èƒ½åŠ›å»ºè®¾</span>å’Œ<span class="highlight">æœåŠ¡æ²»ç†ä½“ç³»</span>ã€‚',
                    tags: ['å¾®æœåŠ¡', 'æ¶æ„è½¬å‹', 'æœ€ä½³å®è·µ', 'è·¯çº¿å›¾'],
                    accuracy: 96
                }
            }
        };

        // é¢„è®¾é—®é¢˜ç‚¹å‡»å¤„ç†
        function askQuestion(question) {
            const questionCards = document.querySelectorAll('.question-card');
            questionCards.forEach(card => {
                card.style.display = 'none';
            });
            
            addMessage('user', question);
            currentContext.push({
                role: 'user',
                content: question
            });
            
            setTimeout(() => {
                handleAssistantResponse(question);
            }, 1000);
        }

        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            
            if (!message || isTyping) return;
            
            addMessage('user', message);
            input.value = '';
            
            currentContext.push({
                role: 'user',
                content: message
            });
            
            setTimeout(() => {
                handleAssistantResponse(message);
            }, 1000);
        }

        // å¤„ç†åŠ©æ‰‹å›å¤
        function handleAssistantResponse(userMessage) {
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                
                let response = '';
                let sourceInfo = null;
                let mermaidCode = null;
                
                const keywords = extractKeywords(userMessage);
                
                if (keywords.includes('mysql') || keywords.includes('æ•°æ®åº“') || keywords.includes('ä¾èµ–')) {
                    const kb = architectureKnowledge['mysqlç³»ç»Ÿ'];
                    response = kb.content;
                    sourceInfo = kb.source;
                    mermaidCode = kb.mermaid;
                } else if (keywords.includes('å¥åº·') || keywords.includes('è¯„ä¼°') || keywords.includes('å€ºåŠ¡')) {
                    const kb = architectureKnowledge['æ¶æ„å¥åº·åº¦'];
                    response = kb.content;
                    sourceInfo = kb.source;
                    mermaidCode = kb.mermaid;
                } else if (keywords.includes('å¾®æœåŠ¡') || keywords.includes('è½¬å‹') || keywords.includes('å®è·µ')) {
                    const kb = architectureKnowledge['å¾®æœåŠ¡è½¬å‹'];
                    response = kb.content;
                    sourceInfo = kb.source;
                    mermaidCode = kb.mermaid;
                } else if (keywords.includes('å½±å“') || keywords.includes('æ”¯ä»˜')) {
                    response = `æ”¯ä»˜ç³»ç»Ÿå˜æ›´å½±å“åˆ†æï¼š

**ç›´æ¥å½±å“ç³»ç»Ÿï¼ˆå¼ºä¾èµ–ï¼‰ï¼š**
- è®¢å•ç³»ç»Ÿï¼šæ”¯ä»˜çŠ¶æ€åŒæ­¥
- è´¦åŠ¡ç³»ç»Ÿï¼šèµ„é‡‘æ¸…ç®—
- é£æ§ç³»ç»Ÿï¼šäº¤æ˜“ç›‘æ§

**é—´æ¥å½±å“ç³»ç»Ÿï¼ˆå¼±ä¾èµ–ï¼‰ï¼š**
- è¥é”€ç³»ç»Ÿï¼šä¼˜æƒ åˆ¸æ ¸é”€
- æŠ¥è¡¨ç³»ç»Ÿï¼šäº¤æ˜“ç»Ÿè®¡
- å®¢æœç³»ç»Ÿï¼šæ”¯ä»˜æŸ¥è¯¢

**é£é™©è¯„ä¼°ï¼š**
- å½±å“èŒƒå›´ï¼š12ä¸ªç³»ç»Ÿ
- é£é™©ç­‰çº§ï¼šé«˜
- å»ºè®®æªæ–½ï¼šç°åº¦å‘å¸ƒã€æµé‡æ§åˆ¶`;
                    sourceInfo = {
                        title: 'ç³»ç»Ÿä¾èµ–åˆ†æ',
                        section: 'æ”¯ä»˜ç³»ç»Ÿ - å½±å“åˆ†æ',
                        url: 'http://architecture.platform/analysis/payment-impact',
                        slice: 'æ”¯ä»˜ç³»ç»Ÿä½œä¸º<span class="highlight">æ ¸å¿ƒäº¤æ˜“é“¾è·¯</span>çš„å…³é”®èŠ‚ç‚¹ï¼Œå…¶å˜æ›´ä¼šå½±å“<span class="highlight">12ä¸ªå…³è”ç³»ç»Ÿ</span>ï¼Œå»ºè®®é‡‡ç”¨ç°åº¦å‘å¸ƒç­–ç•¥é™ä½é£é™©ã€‚',
                        tags: ['å½±å“åˆ†æ', 'æ”¯ä»˜ç³»ç»Ÿ', 'ä¾èµ–ç®¡ç†', 'é£é™©è¯„ä¼°'],
                        accuracy: 88
                    };
                } else {
                    response = `æˆ‘æ­£åœ¨åˆ†ææ‚¨çš„é—®é¢˜ï¼Œè¯·ç¨å€™...

å¦‚æœæ‚¨éœ€è¦æ›´å…·ä½“çš„æ¶æ„æŒ‡å¯¼ï¼Œå¯ä»¥ï¼š
1. æä¾›ç³»ç»Ÿåç§°æˆ–æ¶æ„åŸŸ
2. è¯´æ˜å…·ä½“çš„æŠ€æœ¯æ ˆæˆ–åœºæ™¯
3. æè¿°æœŸæœ›çš„ç›®æ ‡çŠ¶æ€

æˆ‘ä¼šåŸºäºæ¶æ„çŸ¥è¯†åº“ä¸ºæ‚¨æä¾›ä¸“ä¸šå»ºè®®ã€‚`;
                }
                
                addMessage('assistant', response, sourceInfo, mermaidCode);
                
                currentContext.push({
                    role: 'assistant',
                    content: response
                });
            }, 2000);
        }

        // æå–å…³é”®è¯
        function extractKeywords(message) {
            const keywords = [];
            const lowerMessage = message.toLowerCase();
            
            const keywordMap = {
                'mysql': ['mysql', 'æ•°æ®åº“', 'database'],
                'ä¾èµ–': ['ä¾èµ–', 'å…³ç³»', 'å…³è”'],
                'å¥åº·': ['å¥åº·', 'è¯„ä¼°', 'è¯„åˆ†', 'è¯Šæ–­'],
                'å€ºåŠ¡': ['å€ºåŠ¡', 'æŠ€æœ¯å€º', 'debt'],
                'å¾®æœåŠ¡': ['å¾®æœåŠ¡', 'microservice'],
                'è½¬å‹': ['è½¬å‹', 'è¿ç§»', 'æ¼”è¿›'],
                'å®è·µ': ['å®è·µ', 'å»ºè®®', 'è·¯çº¿å›¾'],
                'å½±å“': ['å½±å“', 'å˜æ›´', 'impact'],
                'æ”¯ä»˜': ['æ”¯ä»˜', 'payment']
            };
            
            for (const [key, variations] of Object.entries(keywordMap)) {
                if (variations.some(keyword => lowerMessage.includes(keyword))) {
                    keywords.push(key);
                }
            }
            
            return keywords;
        }

        // æ¸²æŸ“Markdown
        function renderMarkdown(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/^### (.*$)/gim, '<h3 class="text-lg font-semibold text-gray-800 mt-4 mb-2">$1</h3>')
                .replace(/^## (.*$)/gim, '<h2 class="text-xl font-semibold text-gray-800 mt-4 mb-3">$1</h2>')
                .replace(/^# (.*$)/gim, '<h1 class="text-2xl font-bold text-gray-800 mt-4 mb-3">$1</h1>')
                .replace(/^- (.*$)/gim, '<li class="ml-4">â€¢ $1</li>')
                .replace(/^(\d+)\. (.*$)/gim, '<li class="ml-4">$1. $2</li>')
                .replace(/\n/g, '<br>');
        }

        // Toastæç¤º
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <div class="mr-3">
                        ${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}
                    </div>
                    <div>
                        <div class="font-medium text-gray-800">${message}</div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-gray-500 hover:text-gray-700">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `;
            
            document.getElementById('toast-container').appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // æ·»åŠ æ¶ˆæ¯
        function addMessage(sender, content, source = null, mermaidCode = null) {
            const container = document.getElementById('messages-container');
            const messageDiv = document.createElement('div');
            const messageId = 'msg_' + Date.now();
            messageDiv.className = `message-bubble ${sender}-message p-4 mb-4`;
            messageDiv.id = messageId;
            
            if (sender === 'assistant') {
                let messageHTML = `<div class="prose prose-sm max-w-none">${renderMarkdown(content)}</div>`;
                
                if (mermaidCode) {
                    const mermaidId = 'mermaid_' + Date.now();
                    messageHTML += `
                        <div class="mermaid-container mt-4">
                            <div class="text-sm font-medium text-gray-700 mb-3">ğŸ“Š æ¶æ„å›¾ï¼š</div>
                            <div class="mermaid" id="${mermaidId}">${mermaidCode}</div>
                        </div>`;
                }
                
                if (source) {
                    messageHTML += `
                        <div class="source-reference mt-3" onclick="showSourceDetail('${messageId}')">
                            <div class="flex items-center text-sm">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="text-purple-700">æŸ¥çœ‹èµ„æºï¼š${source.section}</span>
                            </div>
                        </div>`;
                }
                
                messageHTML += `
                    <div class="message-actions">
                        <button class="action-btn like" onclick="likeMessage('${messageId}')">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L9 9m5 1v10M4 12v8a2 2 0 002 2h2m-6-10V9a2 2 0 012-2h2m2 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                            </svg>
                            <span>æœ‰å¸®åŠ©</span>
                        </button>
                        <button class="action-btn" onclick="shareInsight('${messageId}')">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m9.032 4.026a9.001 9.001 0 01-7.432 0m9.032-4.026A9.001 9.001 0 0112 3c-4.474 0-8.268 3.12-9.032 7.326m0 0A9.001 9.001 0 0012 21c4.474 0 8.268-3.12 9.032-7.326"></path>
                            </svg>
                            <span>åˆ†äº«</span>
                        </button>
                        <button class="action-btn" onclick="exportReport('${messageId}')">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <span>å¯¼å‡º</span>
                        </button>
                    </div>`;
                
                messageDiv.innerHTML = messageHTML;
                
                if (source) {
                    messageDiv.setAttribute('data-source', JSON.stringify(source));
                }
            } else {
                messageDiv.textContent = content;
            }
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
            
            if (mermaidCode) {
                setTimeout(() => {
                    mermaid.init();
                }, 100);
            }
        }

        // æ˜¾ç¤ºæ‰“å­—æŒ‡ç¤ºå™¨
        function showTypingIndicator() {
            isTyping = true;
            const container = document.getElementById('messages-container');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'typing-indicator mb-4';
            typingDiv.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <span class="ml-2 text-sm text-gray-500">æ­£åœ¨åˆ†ææ¶æ„æ•°æ®...</span>
            `;
            container.appendChild(typingDiv);
            container.scrollTop = container.scrollHeight;
        }

        // éšè—æ‰“å­—æŒ‡ç¤ºå™¨
        function hideTypingIndicator() {
            isTyping = false;
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // æ˜¾ç¤ºæ¶æ„è¯¦æƒ…
        function showSourceDetail(messageId) {
            const messageElement = document.getElementById(messageId);
            if (!messageElement) return;
            
            const sourceDataStr = messageElement.getAttribute('data-source');
            if (!sourceDataStr) return;
            
            try {
                const sourceData = JSON.parse(sourceDataStr);
                
                document.getElementById('doc-title').textContent = sourceData.title;
                document.getElementById('doc-section').textContent = sourceData.section;
                document.getElementById('doc-url').textContent = sourceData.url;
                document.getElementById('slice-content').innerHTML = sourceData.slice;
                document.getElementById('accuracy-rate').textContent = sourceData.accuracy + '%';
                
                const tagsContainer = document.getElementById('reference-tags');
                tagsContainer.innerHTML = '';
                sourceData.tags.forEach(tag => {
                    const tagElement = document.createElement('span');
                    tagElement.className = 'reference-tag';
                    tagElement.textContent = tag;
                    tagsContainer.appendChild(tagElement);
                });
                
                document.getElementById('source-modal').classList.add('show');
            } catch (error) {
                console.error('è§£ææ¶æ„æ•°æ®å¤±è´¥:', error);
            }
        }

        // ç‚¹èµæ¶ˆæ¯
        function likeMessage(messageId) {
            const btn = document.querySelector(`#${messageId} .action-btn.like`);
            btn.classList.toggle('active');
            
            if (btn.classList.contains('active')) {
                showToast('æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼è¿™å°†å¸®åŠ©ä¼˜åŒ–æ¶æ„å»ºè®®', 'success');
            }
        }

        // åˆ†äº«æ´å¯Ÿ
        function shareInsight(messageId) {
            showToast('æ¶æ„æ´å¯Ÿå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            // å®é™…å®ç°å¯ä»¥å¤åˆ¶å†…å®¹åˆ°å‰ªè´´æ¿
        }

        // å¯¼å‡ºæŠ¥å‘Š
        function exportReport(messageId) {
            showToast('æ­£åœ¨ç”Ÿæˆæ¶æ„åˆ†ææŠ¥å‘Š...', 'info');
            setTimeout(() => {
                showToast('æŠ¥å‘Šå·²ç”Ÿæˆå¹¶ä¸‹è½½', 'success');
            }, 2000);
        }

        // æŸ¥çœ‹ä¾èµ–å…³ç³»
        function viewDependencies() {
            showToast('æ­£åœ¨åŠ è½½ä¾èµ–å…³ç³»å›¾...', 'info');
            closeSourceModal();
        }

        // å…³é—­å¼¹çª—
        function closeSourceModal() {
            document.getElementById('source-modal').classList.remove('show');
        }

        // æ¸…ç©ºèŠå¤©
        function clearChat() {
            location.reload();
        }

        // æ˜¾ç¤ºæ¶æ„å…¨æ™¯
        function showArchitectureView() {
            showToast('æ­£åœ¨åŠ è½½æ¶æ„å…¨æ™¯è§†å›¾...', 'info');
        }

        // ä¸Šä¼ æ¶æ„æ–‡æ¡£
        function uploadArchitecture() {
            showToast('æ¶æ„æ–‡æ¡£ä¸Šä¼ åŠŸèƒ½å³å°†å¼€æ”¾', 'info');
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æ¶æ„æ™ºèƒ½åŠ©æ‰‹AIAå·²å°±ç»ª');
            
            document.getElementById('source-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeSourceModal();
                }
            });
        });
    </script>
</body>
</html>