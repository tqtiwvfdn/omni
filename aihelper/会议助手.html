<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>会议助手 - 赞同科技数字员工</title>
    <script src="/console/style/tailwindcss.3.0.23.js"></script>
    <script src="/scripts/mermaid.min.js"></script>
    <style>
        body {
            /* background: linear-gradient(135deg, #f0f2f5 0%, #e8ecf0 50%, #f5f7fa 100%); */
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .liquid-glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .liquid-glass-strong {
            /* background: rgba(255, 255, 255, 0.9); */
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        }
        
        .specular-highlight {
            position: relative;
            overflow: hidden;
        }
        
        .specular-highlight::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s ease;
            pointer-events: none;
        }
        
        .specular-highlight:hover::before {
            left: 100%;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            padding: 16px;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
        }
        
        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.1);
            border-color: rgba(34, 197, 94, 0.3);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .message-bubble {
            max-width: 85%;
            word-wrap: break-word;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .user-message {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            margin-left: auto;
            border-radius: 18px 18px 4px 18px;
        }
        
        .assistant-message {
            background: rgba(255, 255, 255, 0.95);
            color: #374151;
            margin-right: auto;
            border-radius: 18px 18px 18px 4px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 18px 18px 18px 4px;
            margin-right: auto;
            max-width: 85%;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #9ca3af;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }
        
        .source-reference {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .source-reference:hover {
            background: rgba(34, 197, 94, 0.15);
            transform: translateY(-1px);
        }
        
        .floating-button {
            transform: translateY(0);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .floating-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .chat-input {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            padding: 12px 16px;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .chat-input:focus {
            border-color: rgba(34, 197, 94, 0.5);
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
        }
        
        /* Toast 提示样式 */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 16px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
            min-width: 300px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            border-left: 4px solid #10b981;
        }
        
        .toast.error {
            border-left: 4px solid #ef4444;
        }
        
        .toast.info {
            border-left: 4px solid #10b981;
        }
        
        /* 弹窗样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            max-width: 600px;
            max-height: 80vh;
            margin: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s ease;
            overflow: hidden;
        }
        
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }
        
        /* 消息交互按钮 */
        .message-actions {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.8);
            color: #6b7280;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            background: rgba(255, 255, 255, 0.95);
            border-color: rgba(34, 197, 94, 0.3);
            color: #374151;
        }
        
        .action-btn.active {
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.3);
            color: #059669;
        }
        
        .action-btn.like.active {
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.3);
            color: #059669;
        }
        
        .action-btn.dislike.active {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: #dc2626;
        }
        
        /* 文件上传区域 */
        .upload-area {
            border: 2px dashed rgba(34, 197, 94, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            background: rgba(34, 197, 94, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: rgba(34, 197, 94, 0.5);
            background: rgba(34, 197, 94, 0.1);
        }
        
        .upload-area.dragover {
            border-color: rgba(34, 197, 94, 0.7);
            background: rgba(34, 197, 94, 0.15);
        }
        
        /* 音频播放器 */
        .audio-player {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin: 12px 0;
        }
        
        .audio-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .play-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
        }
        
        .play-btn:hover {
            transform: scale(1.05);
        }
        
        .progress-bar {
            flex: 1;
            height: 4px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 2px;
            cursor: pointer;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 2px;
            width: 0%;
            transition: width 0.1s ease;
        }
        
        /* 转录文本 */
        .transcript-item {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .transcript-item:hover {
            background: rgba(34, 197, 94, 0.05);
            border-color: rgba(34, 197, 94, 0.3);
        }
        
        .speaker-tag {
            display: inline-block;
            background: rgba(34, 197, 94, 0.1);
            color: #059669;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
        }
        
        .timestamp {
            color: #6b7280;
            font-size: 12px;
            margin-left: 8px;
        }
        
        /* 会议纪要样式 */
        .meeting-summary {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
        }
        
        .highlight {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 600;
        }
    </style>
</head>
<body class="h-screen flex flex-col">
    <!-- 页面容器 -->
    <div class="flex-1 flex flex-col w-full overflow-hidden">
        <!-- 聊天头部 -->
        <div class="liquid-glass-strong rounded-t-lg p-4 flex items-center justify-between">
            <div class="flex items-center">
                <img src="/asset/avatar2.png" 
                     alt="会议助手" class="w-12 h-12 rounded-full mr-4 object-cover">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800">您好，我是AI会议助手</h3>
                    <p class="text-sm text-gray-500">工号A0002 · 有什么可以帮到您</p>
                </div>
            </div>
            <button onclick="clearChat()" class="liquid-glass floating-button rounded-lg px-4 py-2 text-sm font-medium text-gray-700 specular-highlight">
                新建会话
            </button>
        </div>
        
        <!-- 消息区域 -->
        <div id="messages-container" class="flex-1 liquid-glass-strong p-6 overflow-y-auto">
            <!-- 助手介绍消息 -->
            <div class="message-bubble assistant-message p-4 mb-4">
                <div class="prose prose-sm max-w-none text-gray-700 mb-4">
                    <p class="mb-3">我能够将您的会议录音转为文字记录，自动生成会议纪要，让您专注于会议内容，告别手工记录的烦恼。</p>
                    <p class="mb-3">我支持<span class="font-semibold text-green-600">语音识别转写</span>、<span class="font-semibold text-green-600">说话人识别</span>和<span class="font-semibold text-green-600">智能纪要生成</span>。</p>
                    <p class="text-sm text-gray-600">🎯 <strong>核心功能：</strong>语音转文字（不强答机制）、自动分角色、会议纪要生成、关键信息提取</p>
                </div>
                <p class="text-gray-700 font-medium">请先上传您的会议录音文件：</p>
            </div>
            
            <!-- 音频上传区域 -->
            <div id="upload-section" class="mb-6">
                <div class="upload-area" id="upload-area" onclick="triggerFileUpload()">
                    <div class="text-center py-8">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">上传会议录音文件</h3>
                        <p class="text-gray-600 mb-4">支持 MP3、WAV、M4A 格式，最大支持 200MB</p>
                        <div class="flex items-center justify-center space-x-4 text-sm text-gray-500">
                            <span class="flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                </svg>
                                安全加密
                            </span>
                            <span class="flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                                快速处理
                            </span>
                            <span class="flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                98%准确率
                            </span>
                        </div>
                        <button class="mt-4 bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">
                            选择文件
                        </button>
                        <p class="text-xs text-gray-400 mt-2">或直接拖拽文件到此区域</p>
                    </div>
                </div>
                <input type="file" id="audio-file-input" accept="audio/*" style="display: none;" onchange="handleFileUpload(event)">
            </div>
            
            <!-- 示例文件 -->
            <div id="sample-section" class="mb-6">
                <p class="text-sm font-medium text-gray-700 mb-3">📁 或者试试我们的示例文件：</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div class="feature-card specular-highlight" onclick="loadSampleAudio('董事会例会')">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                <span class="text-blue-600 text-sm">🏢</span>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800">董事会例会</h4>
                                <p class="text-xs text-gray-600">4人参会 • 45分钟</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="feature-card specular-highlight" onclick="loadSampleAudio('项目评审会')">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                <span class="text-purple-600 text-sm">💼</span>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800">项目评审会</h4>
                                <p class="text-xs text-gray-600">6人参会 • 62分钟</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 输入区域 -->
        <div class="liquid-glass-strong rounded-b-lg p-4">
            <div class="flex items-end space-x-3">
                <div class="flex-1">
                    <input type="text" 
                           id="message-input"
                           placeholder="上传音频后可在此搜索会议内容或提问..."
                           class="w-full chat-input"
                           onkeypress="if(event.key==='Enter') sendMessage()">
                </div>
                <button onclick="sendMessage()" 
                        class="liquid-glass floating-button rounded-lg p-3 specular-highlight bg-green-500 text-white">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- 音频来源弹窗 -->
    <div id="source-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex items-center justify-between p-6 border-b border-gray-200/50">
                <h3 class="text-lg font-semibold text-gray-800">音频来源详情</h3>
                <button onclick="closeSourceModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="p-6 overflow-y-auto max-h-96">
                <div class="mb-6">
                    <h4 class="font-semibold text-gray-800 mb-2">🎵 音频信息</h4>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <p class="text-sm text-gray-600 mb-2">
                            <span class="font-medium">文件名称：</span>
                            <span id="audio-filename">-</span>
                        </p>
                        <p class="text-sm text-gray-600 mb-2">
                            <span class="font-medium">时间位置：</span>
                            <span id="audio-timestamp">-</span>
                        </p>
                        <p class="text-sm text-gray-600">
                            <span class="font-medium">识别准确率：</span>
                            <span id="audio-accuracy" class="text-green-600">-</span>
                        </p>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h4 class="font-semibold text-gray-800 mb-2">📝 转录文本</h4>
                    <div class="bg-blue-50 rounded-lg p-4">
                        <div id="transcript-content" class="text-sm text-gray-700 leading-relaxed">
                            -
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-semibold text-gray-800 mb-2">👥 说话人信息</h4>
                    <div id="speaker-info" class="flex flex-wrap gap-2">
                        <!-- 说话人标签将动态生成 -->
                    </div>
                </div>
            </div>
            
            <div class="flex items-center justify-between p-6 border-t border-gray-200/50">
                <div class="text-sm text-gray-500">
                    语音识别引擎：DeepSpeech v3.2
                </div>
                <button onclick="closeSourceModal()" class="bg-green-500 text-white rounded-lg px-4 py-2 text-sm font-medium hover:bg-green-600 transition-colors">
                    确定
                </button>
            </div>
        </div>
    </div>

    <script>
        let conversationHistory = [];
        let isTyping = false;
        let currentContext = [];
        let currentAudioData = null;

        // 模拟会议数据
        const meetingData = {
            audioFile: "董事会季度例会_20241215.mp3",
            duration: "45:23",
            participants: ["张总", "李主任", "王经理", "刘助理"],
            transcript: [
                {
                    speaker: "张总",
                    time: "00:02:15",
                    text: "各位好，今天主要讨论Q4的业绩情况和明年的预算规划。请李主任先汇报一下财务数据。",
                    accuracy: 98
                },
                {
                    speaker: "李主任", 
                    time: "00:02:45",
                    text: "好的张总。根据最新统计，Q4营收同比增长15.2%，净利润增长12.8%，整体表现良好。",
                    accuracy: 96
                },
                {
                    speaker: "王经理",
                    time: "00:03:20", 
                    text: "市场部这边，新客户获取率提升了23%，客户满意度达到了94.5%。",
                    accuracy: 97
                },
                {
                    speaker: "刘助理",
                    time: "00:04:10",
                    text: "需要注意的是，明年Q1有几个重要的合规检查节点，建议提前准备相关材料。",
                    accuracy: 95
                }
            ],
            summary: {
                topic: "Q4业绩总结及明年预算规划会议",
                keyPoints: [
                    "Q4营收同比增长15.2%，净利润增长12.8%",
                    "新客户获取率提升23%，客户满意度94.5%", 
                    "明年Q1面临重要合规检查"
                ],
                actionItems: [
                    "李主任：完善Q4财务报告，12月20日前提交",
                    "王经理：制定明年客户拓展计划，12月25日前完成",
                    "刘助理：准备Q1合规检查材料，1月10日前完成"
                ],
                nextMeeting: "2024年1月5日 下午2:00"
            }
        };

        // Toast提示函数
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <div class="mr-3">
                        ${type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️'}
                    </div>
                    <div>
                        <div class="font-medium text-gray-800">${message}</div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-gray-500 hover:text-gray-700">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `;
            
            document.body.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // 简单的Markdown渲染器
        function renderMarkdown(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/^### (.*$)/gim, '<h3 class="text-lg font-semibold text-gray-800 mt-4 mb-2">$1</h3>')
                .replace(/^## (.*$)/gim, '<h2 class="text-xl font-semibold text-gray-800 mt-4 mb-3">$1</h2>')
                .replace(/^# (.*$)/gim, '<h1 class="text-2xl font-bold text-gray-800 mt-4 mb-3">$1</h1>')
                .replace(/^- (.*$)/gim, '<li class="ml-4">$1</li>')
                .replace(/^(\d+)\. (.*$)/gim, '<li class="ml-4 list-decimal">$2</li>')
                .replace(/\n/g, '<br>');
        }

        // 添加消息
        function addMessage(sender, content, source = null, mermaidCode = null, audioData = null) {
            const container = document.getElementById('messages-container');
            const messageDiv = document.createElement('div');
            const messageId = 'msg_' + Date.now();
            messageDiv.className = `message-bubble ${sender}-message p-4 mb-4`;
            messageDiv.id = messageId;
            
            if (sender === 'assistant') {
                let messageHTML = `<div class="prose prose-sm max-w-none">${renderMarkdown(content)}</div>`;
                
                // 添加音频播放器
                audioData=audioData||meetingData;
                if (audioData) {
                    messageHTML += `
                        <div class="audio-player">
                            <div class="audio-controls">
                                <button class="play-btn" onclick="toggleAudio()">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M8 5v14l11-7z"/>
                                    </svg>
                                </button>
                                <div class="progress-bar" onclick="seekAudio(event)">
                                    <div class="progress-fill" id="progress-${messageId}"></div>
                                </div>
                                <span class="text-sm text-gray-600">${audioData.duration}</span>
                            </div>
                            <div class="mt-2 text-sm text-gray-600">
                                <span class="font-medium">${audioData.filename}</span>
                                <span class="ml-2">参与人员：${audioData.participants.join('、')}</span>
                            </div>
                        </div>`;
                }
                
                // 添加转录文本
                if (audioData && audioData.transcript) {
                    messageHTML += `<div class="mt-4">`;
                    audioData.transcript.forEach(item => {
                        messageHTML += `
                            <div class="transcript-item" onclick="jumpToAudio('${item.time}')">
                                <span class="speaker-tag">${item.speaker}</span>
                                <span class="timestamp">${item.time}</span>
                                <div class="mt-1 text-sm">${item.text}</div>
                            </div>`;
                    });
                    messageHTML += `</div>`;
                }
                
                // 添加Mermaid流程图
                // if (mermaidCode) {
                //     const mermaidId = 'mermaid_' + Date.now();
                //     messageHTML += `
                //         <div class="mermaid-container mt-4">
                //             <div class="text-sm font-medium text-gray-700 mb-3">📊 处理流程：</div>
                //             <div class="mermaid" id="${mermaidId}">${mermaidCode}</div>
                //         </div>`;
                // }
                
                if (source) {
                    messageHTML += `
                        <div class="source-reference mt-3" onclick="showSourceDetail('${messageId}')">
                            <div class="flex items-center text-sm">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 11.293l-2.829 2.829a1 1 0 01-1.414 0L8.464 11.293M12 4v12m0 0l-3-3m3 3l3-3"></path>
                                </svg>
                                <span class="text-green-700">查看音频来源：${source.position}</span>
                            </div>
                        </div>`;
                }
                
                // 添加交互按钮
                messageHTML += `
                    <div class="message-actions">
                        <button class="action-btn like" onclick="likeMessage('${messageId}')">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L9 9m5 1v10M4 12v8a2 2 0 002 2h2m-6-10V9a2 2 0 012-2h2m2 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                            </svg>
                            <span>赞</span>
                        </button>
                        <button class="action-btn dislike" onclick="dislikeMessage('${messageId}')">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018c.163 0 .326.02.485.06L17 4m-7 10v2a2 2 0 002 2h.095c.5 0 .905-.405.905-.905 0-.714.211-1.412.608-2.006L15 15M10 14l-2-2m6-6v8a2 2 0 01-2 2h-2m6-10V4a2 2 0 00-2-2h-2m-6 5a2 2 0 00-2-2H4a2 2 0 00-2 2m10 9l-2-2-4 4"></path>
                            </svg>
                            <span>踩</span>
                        </button>
                        <button class="action-btn" onclick="editAnswer('${messageId}')">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                            <span>编辑</span>
                        </button>
                        <button class="action-btn" onclick="getAssistance('${messageId}')">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span>辅助</span>
                        </button>
                    </div>`;
                
                messageDiv.innerHTML = messageHTML;
                
                // 存储source和audioData到元素上
                if (source) {
                    messageDiv.setAttribute('data-source', JSON.stringify(source));
                }
                if (audioData) {
                    messageDiv.setAttribute('data-audio', JSON.stringify(audioData));
                }
            } else {
                messageDiv.textContent = content;
            }
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
            
            // 如果有Mermaid图表，重新渲染
            if (mermaidCode) {
                setTimeout(() => {
                    mermaid.init();
                }, 100);
            }
        }

        // 触发文件上传
        function triggerFileUpload() {
            document.getElementById('audio-file-input').click();
        }

        // 处理文件上传
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                processAudioFile(file);
            }
        }

        // 加载示例音频
        function loadSampleAudio(sampleName) {
            showToast(`正在加载示例文件：${sampleName}`, 'info');
            
            // 模拟不同的示例数据
            let sampleData = meetingData;
            if (sampleName === '项目评审会') {
                sampleData = {
                    ...meetingData,
                    audioFile: "产品评审会议_20241210.mp3",
                    duration: "62:18",
                    participants: ["产品总监", "技术负责人", "UI设计师", "测试经理", "项目经理", "业务代表"]
                };
            }
            
            setTimeout(() => {
                processAudioFile(null, sampleData);
            }, 1500);
        }

        // 处理音频文件
        function processAudioFile(file, sampleData = null) {
            // 隐藏上传区域和示例区域
            document.getElementById('upload-section').style.display = 'none';
            document.getElementById('sample-section').style.display = 'none';
            
            const fileName = file ? file.name : (sampleData ? sampleData.audioFile : '示例文件.mp3');
            
            // 显示处理进度
            addMessage('user', `已上传文件：${fileName}`);
            
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                
                const response = `🎉 **音频文件处理完成！**

**📊 处理结果：**
- **文件名称**：${fileName}
- **处理时长**：${sampleData ? sampleData.duration : '计算中...'}
- **参与人员**：${sampleData ? sampleData.participants.length : '识别中...'}人
- **识别准确率**：97.3%

音频文件已成功处理，现在您可以选择要执行的操作：`;

                const audioSource = {
                    filename: fileName,
                    position: "完整会议转录",
                    accuracy: "97.3%",
                    transcript: sampleData ? sampleData.transcript[0].text : "转录文本预览...",
                    speakers: sampleData ? sampleData.participants : ["说话人1", "说话人2"]
                };

                addMessage('assistant', response, audioSource, sampleData || meetingData);
                
                // 显示"猜你想做"选项
                showActionOptions();
            }, 3000);
        }

        // 显示操作选项
        function showActionOptions() {
            const container = document.getElementById('messages-container');
            
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'mb-6';
            optionsDiv.innerHTML = `
                <div class="message-bubble assistant-message p-4 mb-4">
                    <p class="text-gray-700 font-medium mb-4">💡 猜您想要：</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div class="feature-card specular-highlight" onclick="performAction('transcript')">
                            <div class="flex items-start">
                                <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                    <span class="text-green-600 text-sm">📝</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-800 mb-1">查看完整转录文本</h4>
                                    <p class="text-sm text-gray-600">逐字逐句的会议记录，支持说话人识别</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="feature-card specular-highlight" onclick="performAction('minutes')">
                            <div class="flex items-start">
                                <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                    <span class="text-blue-600 text-sm">📄</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-800 mb-1">生成会议纪要</h4>
                                    <p class="text-sm text-gray-600">智能提取关键信息，生成标准纪要</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="feature-card specular-highlight" onclick="performAction('summary')">
                            <div class="flex items-start">
                                <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                    <span class="text-purple-600 text-sm">📋</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-800 mb-1">提取关键信息</h4>
                                    <p class="text-sm text-gray-600">自动识别重点、决议和待办事项</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="feature-card specular-highlight" onclick="performAction('search')">
                            <div class="flex items-start">
                                <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                    <span class="text-orange-600 text-sm">🔍</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-800 mb-1">搜索会议内容</h4>
                                    <p class="text-sm text-gray-600">快速定位特定话题或发言人内容</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(optionsDiv);
            container.scrollTop = container.scrollHeight;
        }

        // 执行选定的操作
        function performAction(action) {
            // 隐藏操作选项
            const optionsDiv = document.querySelector('.message-bubble:last-child').parentElement;
            if (optionsDiv) optionsDiv.style.display = 'none';
            
            let userAction = '';
            
            switch (action) {
                case 'transcript':
                    userAction = '请显示完整的会议转录文本';
                    break;
                case 'minutes':
                    userAction = '请生成会议纪要';
                    break;
                case 'summary':
                    userAction = '请提取关键信息和决议事项';
                    break;
                case 'search':
                    userAction = '我想搜索会议中的特定内容';
                    break;
            }
            
            addMessage('user', userAction);
            
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    handleActionResponse(action);

                    // 显示"猜你想做"选项
                showActionOptions();
                }, 2000);
            }, 500);
        }

        // 处理操作响应
        function handleActionResponse(action) {
            switch (action) {
                case 'transcript':
                    showCompleteTranscript();
                    break;
                case 'minutes':
                    generateMeetingMinutes();
                    break;
                case 'summary':
                    extractKeyInformation();
                    break;
                case 'search':
                    enableSearchMode();
                    break;
            }
        }

        // 显示完整转录文本
        function showCompleteTranscript() {
            const transcriptContent = `**📝 完整会议转录文本**

以下是完整的会议录音转录，已自动识别说话人并标注时间：

**会议基本信息：**
- 会议名称：董事会季度例会
- 录音时长：45分23秒
- 参会人员：4人
- 转录准确率：97.3%`;

            addMessage('assistant', transcriptContent, null, meetingData);
            showToast('转录文本已生成，点击任意段落可跳转到对应音频位置', 'success');
        }

        // 生成会议纪要
        function generateMeetingMinutes() {
            const minutesContent = `**赞同科技董事会季度例会纪要**

**📅 会议基本信息**
- **会议时间**：2024年12月15日 14:00-14:45
- **会议地点**：总部会议室A
- **主持人**：张总
- **参会人员**：张总、李主任、王经理、刘助理
- **记录人**：AI会议助手

**📋 会议主要内容**

**一、Q4业绩汇报**
李主任汇报了第四季度财务数据：
- Q4营收同比增长**15.2%**
- 净利润增长**12.8%** 
- 整体业绩表现良好，超预期完成年度目标

**二、市场拓展情况**
王经理汇报市场部工作成果：
- 新客户获取率提升**23%**
- 客户满意度达到**94.5%**
- 品牌影响力持续提升

**三、合规风险提醒**
刘助理提醒明年合规要点：
- 明年Q1将面临重要合规检查
- 需提前准备相关合规材料
- 建议加强内控体系建设

**✅ 会议决议事项**
1. 批准Q4财务报告，同意提交董事会审议
2. 通过明年客户拓展战略规划
3. 加强合规风险防控体系建设

**📝 待办事项及责任人**
1. **李主任**：完善Q4财务报告，截止时间：12月20日
2. **王经理**：制定明年客户拓展计划，截止时间：12月25日  
3. **刘助理**：准备Q1合规检查材料，截止时间：1月10日

**📅 下次会议安排**
时间：2024年1月5日 下午2:00
议题：年度总结及新年规划

---
*本纪要由AI会议助手自动生成，关键信息丢失率：2.1%*`;

            addMessage('assistant', minutesContent);
            showToast('会议纪要已生成完成！可下载Word或PDF格式', 'success');
        }

        // 提取关键信息
        function extractKeyInformation() {
            const summaryContent = `**🎯 会议关键信息提取**

**📊 重要数据指标：**
- Q4营收增长：**+15.2%**
- 净利润增长：**+12.8%**
- 新客户获取率：**+23%**
- 客户满意度：**94.5%**

**🔑 关键决议：**
1. **财务报告批准** - 提交董事会审议
2. **战略规划通过** - 明年客户拓展计划
3. **风控体系加强** - 应对合规检查

**📅 重要时间节点：**
- **12月20日**：财务报告完善（李主任负责）
- **12月25日**：拓展计划制定（王经理负责）
- **1月10日**：合规材料准备（刘助理负责）
- **1月5日**：下次会议安排

**⚠️ 风险提醒：**
- 明年Q1合规检查需要重点关注
- 建议提前1个月开始准备相关材料
- 加强内控体系建设迫在眉睫

**💼 部门行动要求：**
- **财务部**：强化数据准确性和及时性
- **市场部**：继续保持客户拓展优势
- **合规部**：全面梳理风险控制点`;

            addMessage('assistant', summaryContent);
            showToast('关键信息已提取完成！', 'success');
        }

        // 启用搜索模式
        function enableSearchMode() {
            const searchContent = `**🔍 会议内容搜索功能已启用**

现在您可以搜索会议中的任何内容：

**搜索示例：**
- 搜索特定数字："15.2%" 或 "营收"
- 搜索发言人："张总说了什么"
- 搜索话题："客户满意度相关内容"
- 搜索时间段："前10分钟讨论了什么"

**高级搜索：**
- 支持模糊匹配和语义搜索
- 自动高亮搜索结果
- 提供音频时间点跳转
- 显示上下文相关内容

请在下方输入框中输入您要搜索的内容，我会为您精确定位！`;

            addMessage('assistant', searchContent);
            showToast('搜索模式已启用，请在输入框中输入搜索关键词', 'info');
        }

        // 开始会议演示（保留原有功能以防调用）
        function startMeetingDemo() {
            loadSampleAudio('董事会例会');
        }

        // 生成会议纪要演示（保留原有功能以防调用）
        function generateMinutesDemo() {
            performAction('minutes');
        }

        // 处理用户问题
        function askQuestion(question) {
            // 隐藏功能卡片
            const featureCards = document.querySelectorAll('.feature-card');
            featureCards.forEach(card => {
                card.style.display = 'none';
            });
            
            addMessage('user', question);
            
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    
                    let response = '';
                    if (question.includes('准确率')) {
                        response = `**🎯 会议助手准确率说明**

**语音转文字准确率：**
- **中文普通话**：98.5%
- **英文**：97.2%  
- **方言识别**：85-92%
- **嘈杂环境**：78-85%

**说话人识别准确率：**
- **2-4人会议**：99.1%
- **5-8人会议**：96.8%
- **8人以上**：92.3%

**关键信息提取准确率：**
- **会议主题识别**：95.7%
- **决议事项提取**：94.2%
- **任务中心识别**：93.8%
- **时间节点提取**：97.1%

**🔧 技术优势：**
- 采用最新的DeepSpeech 3.2引擎
- 支持实时噪音抑制
- 智能标点和断句
- 上下文语义理解`;
                    } else if (question.includes('溯源')) {
                        response = `**🔍 语音溯源功能说明**

**功能特点：**
- **精确定位**：支持秒级时间点跳转
- **双向关联**：文字↔音频无缝切换
- **智能标记**：自动标注重要段落
- **多格式支持**：MP3、WAV、M4A等

**使用方法：**
1. 点击转录文本中的任意段落
2. 自动跳转到对应音频时间点
3. 支持播放、暂停、快进快退
4. 可调节播放速度（0.5x-2x）

**应用场景：**
- **会议回顾**：快速定位关键讨论
- **内容验证**：核实转录文本准确性
- **重点标记**：标注重要决议内容
- **培训学习**：反复学习重要片段

**技术实现：**
- 基于时间戳精确同步
- 智能音频分段技术
- 支持音频可视化波形图
- 实时进度条显示`;
                    } else {
                        response = `感谢您的咨询！我是专业的AI会议助手，可以为您提供：

**🎙️ 核心服务：**
- 高精度语音转文字（98%+准确率）
- 智能说话人识别与分离
- 自动生成结构化会议纪要
- 支持音频文字双向溯源

**📝 支持格式：**
- 音频：MP3、WAV、M4A、AAC
- 时长：最长支持8小时连续录音
- 语言：中文、英文及主要方言

**🚀 处理速度：**
- 1小时录音约需3-5分钟处理
- 支持实时转录和离线处理
- 自动保存和云端同步

如需了解更多功能，请随时询问！`;
                    }
                    
                    addMessage('assistant', response);
                }, 1500);
            }, 1000);
        }

        // 发送消息
        function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            
            if (!message || isTyping) return;
            
            addMessage('user', message);
            input.value = '';
            
            // 如果还没有上传音频，提示用户先上传
            if (!currentAudioData) {
                setTimeout(() => {
                    const response = '请先上传会议录音文件，我就可以为您提供转录、纪要生成等服务了！您可以直接拖拽音频文件到上方的上传区域。';
                    addMessage('assistant', response);
                }, 500);
                return;
            }
            
            // 简单的搜索功能（如果已上传音频）
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    const response = `正在会议内容中搜索"${message}"...

🔍 **搜索结果：**
- 在 **03:20** 时刻找到相关内容
- 说话人：王经理
- 匹配度：95%

您可以点击时间戳跳转到对应的音频位置，或询问我其他问题。`;
                    addMessage('assistant', response);
                }, 1500);
            }, 500);
        }

        // 显示/隐藏打字指示器
        function showTypingIndicator() {
            isTyping = true;
            const container = document.getElementById('messages-container');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'typing-indicator mb-4';
            typingDiv.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <span class="ml-2 text-sm text-gray-500">会议助手正在处理音频...</span>
            `;
            container.appendChild(typingDiv);
            container.scrollTop = container.scrollHeight;
        }

        function hideTypingIndicator() {
            isTyping = false;
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // 音频控制功能
        function toggleAudio() {
            showToast('音频播放功能已集成，支持播放控制和进度调节', 'info');
        }

        function seekAudio(event) {
            showToast('支持点击进度条跳转到指定时间点', 'info');
        }

        function jumpToAudio(time) {
            showToast(`正在跳转到 ${time} 时间点`, 'info');
            
            // 显示音频来源详情
            const sourceData = {
                filename: meetingData.audioFile,
                timestamp: time,
                accuracy: "97%",
                transcript: meetingData.transcript.find(t => t.time === time)?.text || "音频片段内容",
                speakers: meetingData.participants
            };
            
            // 填充弹窗数据
            document.getElementById('audio-filename').textContent = sourceData.filename;
            document.getElementById('audio-timestamp').textContent = sourceData.timestamp;
            document.getElementById('audio-accuracy').textContent = sourceData.accuracy;
            document.getElementById('transcript-content').textContent = sourceData.transcript;
            
            // 生成说话人标签
            const speakerContainer = document.getElementById('speaker-info');
            speakerContainer.innerHTML = '';
            sourceData.speakers.forEach(speaker => {
                const tag = document.createElement('span');
                tag.className = 'speaker-tag';
                tag.textContent = speaker;
                speakerContainer.appendChild(tag);
            });
            
            document.getElementById('source-modal').classList.add('show');
        }

        // 显示来源详情
        function showSourceDetail(messageId) {
            const messageElement = document.getElementById(messageId);
            const audioDataStr = messageElement.getAttribute('data-audio');
            
            if (audioDataStr) {
                const audioData = JSON.parse(audioDataStr);
                
                document.getElementById('audio-filename').textContent = audioData.filename;
                document.getElementById('audio-timestamp').textContent = "完整会议";
                document.getElementById('audio-accuracy').textContent = "97.3%";
                document.getElementById('transcript-content').textContent = audioData.transcript[0].text;
                
                const speakerContainer = document.getElementById('speaker-info');
                speakerContainer.innerHTML = '';
                audioData.participants.forEach(speaker => {
                    const tag = document.createElement('span');
                    tag.className = 'speaker-tag';
                    tag.textContent = speaker;
                    speakerContainer.appendChild(tag);
                });
                
                document.getElementById('source-modal').classList.add('show');
            }
        }

        function closeSourceModal() {
            document.getElementById('source-modal').classList.remove('show');
        }

        // 交互按钮功能（复用制度助手的逻辑）
        function likeMessage(messageId) {
            const btn = document.querySelector(`#${messageId} .action-btn.like`);
            const dislikeBtn = document.querySelector(`#${messageId} .action-btn.dislike`);
            
            btn.classList.toggle('active');
            dislikeBtn.classList.remove('active');
            
            if (btn.classList.contains('active')) {
                showToast('感谢您的反馈！这将帮助我们改进语音识别质量', 'success');
            } else {
                showToast('已取消点赞', 'info');
            }
        }

        function dislikeMessage(messageId) {
            const btn = document.querySelector(`#${messageId} .action-btn.dislike`);
            const likeBtn = document.querySelector(`#${messageId} .action-btn.like`);
            
            btn.classList.toggle('active');
            likeBtn.classList.remove('active');
            
            if (btn.classList.contains('active')) {
                showToast('我们已记录您的反馈，会持续优化转录准确性', 'info');
            }
        }

        function editAnswer(messageId) {
            showToast('编辑功能已启用，您可以修正转录文本或纪要内容', 'info');
        }

        function getAssistance(messageId) {
            showToast('辅助功能已启用，可以请求音频处理、格式转换等帮助', 'info');
        }

        // 清空聊天
        function clearChat() {
            document.getElementById('messages-container').innerHTML = `
                <!-- 助手介绍消息 -->
                <div class="message-bubble assistant-message p-4 mb-4">
                    <div class="prose prose-sm max-w-none text-gray-700 mb-4">
                        <p class="mb-3">我能够将您的会议录音转为文字记录，自动生成会议纪要，让您专注于会议内容，告别手工记录的烦恼。</p>
                        <p class="mb-3">我支持<span class="font-semibold text-green-600">语音识别转写</span>、<span class="font-semibold text-green-600">说话人识别</span>和<span class="font-semibold text-green-600">智能纪要生成</span>。</p>
                        <p class="text-sm text-gray-600">🎯 <strong>核心功能：</strong>语音转文字（不强答机制）、自动分角色、会议纪要生成、关键信息提取</p>
                    </div>
                    <p class="text-gray-700 font-medium">请先上传您的会议录音文件：</p>
                </div>
                
                <!-- 音频上传区域 -->
                <div id="upload-section" class="mb-6">
                    <div class="upload-area" id="upload-area" onclick="triggerFileUpload()">
                        <div class="text-center py-8">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">上传会议录音文件</h3>
                            <p class="text-gray-600 mb-4">支持 MP3、WAV、M4A 格式，最大支持 200MB</p>
                            <div class="flex items-center justify-center space-x-4 text-sm text-gray-500">
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                    </svg>
                                    安全加密
                                </span>
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                    快速处理
                                </span>
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    98%准确率
                                </span>
                            </div>
                            <button class="mt-4 bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">
                                选择文件
                            </button>
                            <p class="text-xs text-gray-400 mt-2">或直接拖拽文件到此区域</p>
                        </div>
                    </div>
                    <input type="file" id="audio-file-input" accept="audio/*" style="display: none;" onchange="handleFileUpload(event)">
                </div>
                
                <!-- 示例文件 -->
                <div id="sample-section" class="mb-6">
                    <p class="text-sm font-medium text-gray-700 mb-3">📁 或者试试我们的示例文件：</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div class="feature-card specular-highlight" onclick="loadSampleAudio('董事会例会')">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                    <span class="text-blue-600 text-sm">🏢</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-800">董事会例会</h4>
                                    <p class="text-xs text-gray-600">4人参会 • 45分钟</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="feature-card specular-highlight" onclick="loadSampleAudio('项目评审会')">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                    <span class="text-purple-600 text-sm">💼</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-800">项目评审会</h4>
                                    <p class="text-xs text-gray-600">6人参会 • 62分钟</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            conversationHistory = [];
            currentContext = [];
            currentAudioData = null;
            
            // 重新绑定拖拽事件
            setupDragAndDrop();
        }

        // 设置拖拽上传功能
        function setupDragAndDrop() {
            const uploadArea = document.getElementById('upload-area');
            if (!uploadArea) return;

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });

            function highlight(e) {
                uploadArea.classList.add('dragover');
            }

            function unhighlight(e) {
                uploadArea.classList.remove('dragover');
            }

            uploadArea.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;

                if (files.length > 0) {
                    const file = files[0];
                    if (file.type.startsWith('audio/')) {
                        processAudioFile(file);
                    } else {
                        showToast('请上传音频文件（MP3、WAV、M4A格式）', 'error');
                    }
                }
            }
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('会议助手聊天界面已加载完成');
            
            // 设置拖拽上传
            setupDragAndDrop();
            
            document.getElementById('source-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeSourceModal();
                }
            });
        });
    </script>
</body>
</html>