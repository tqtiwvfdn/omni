<!DOCTYPE html>
<html lang="zh-CN" style="overflow: hidden;">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>应用工作台 - 运营侧</title>
    <script src="/console/style/tailwindcss.3.0.23.js"></script>
    <script src="/console/style/echarts.min.js"></script>
    <style>
        :root {
            --omni-primary: #1e3a8a;
            --omni-primary-light: #3730a3;
            --omni-primary-dark: #581c87;
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-strong: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            --text-primary: rgba(255, 255, 255, 0.95);
            --text-secondary: rgba(255, 255, 255, 0.8);
            --text-tertiary: rgba(255, 255, 255, 0.6);
            --sidebar-bg: rgba(255, 255, 255, 0.1);
            --menu-hover: rgba(255, 255, 255, 0.1);
            --menu-active: rgba(255, 255, 255, 0.2);
        }

        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
            min-height: 100vh;
            color: var(--text-primary);
            transition: background 0.6s ease;
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            overflow: hidden;
        }

        /* Glass Effects */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }

        .glass-strong {
            background: var(--glass-strong);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Specular highlight effect */
        .specular-highlight {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .specular-highlight::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
            z-index: 1;
        }

        .specular-highlight:hover::before {
            left: 100%;
        }

        .specular-highlight>* {
            position: relative;
            z-index: 2;
        }

        /* Sidebar */
        .omni-sidebar {
            background: var(--sidebar-bg);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }

        /* Menu styles */
        .menu-item {
            border-radius: 12px;
            margin: 4px 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .menu-item:hover {
            background-color: var(--menu-hover);
            color: var(--text-primary);
            transform: translateX(4px);
        }

        .menu-item.active {
            background-color: var(--menu-active);
            color: var(--text-primary);
            font-weight: 600;
            box-shadow: 0 4px 16px rgba(255, 255, 255, 0.1);
        }

        .menu-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #fff, rgba(255, 255, 255, 0.8));
            border-radius: 0 4px 4px 0;
        }

        /* Submenu styles */
        .ml-4 .menu-item {
            font-size: 14px;
            color: var(--text-tertiary);
            font-weight: 400;
            margin: 2px 8px;
            padding: 8px 12px;
        }

        .ml-4 .menu-item:hover {
            color: var(--text-secondary);
            background-color: rgba(255, 255, 255, 0.08);
            transform: translateX(2px);
        }

        .ml-4 .menu-item.active {
            color: var(--text-primary);
            background-color: rgba(255, 255, 255, 0.15);
            font-weight: 500;
        }

        .ml-4 .menu-item.active::before {
            width: 2px;
            height: 16px;
        }

        /* Dropdown styles */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background: var(--glass-strong);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            min-width: 280px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            z-index: 1000;
            top: 100%;
            margin-top: 8px;
            animation: dropdownFadeIn 0.2s ease-out;
        }

        .dropdown-content.show {
            display: block;
        }

        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .dropdown-item {
            padding: 14px 18px;
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dropdown-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .dropdown-item:first-child {
            border-radius: 12px 12px 0 0;
        }

        .dropdown-item:last-child {
            border-radius: 0 0 12px 12px;
            border-bottom: none;
        }

        /* Button styles */
        .omni-btn {
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .omni-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .omni-btn:active {
            transform: translateY(-1px);
        }

        /* Status indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.025em;
        }

        .status-online {
            /* background: rgba(34, 197, 94, 0.2); */
            color: rgb(34, 197, 94);
            /* border: 1px solid rgba(34, 197, 94, 0.3); */
        }

        .status-warning {
            /* background: rgba(245, 158, 11, 0.2); */
            color: rgb(245, 158, 11);
            /* border: 1px solid rgba(245, 158, 11, 0.3); */
        }

        .status-error {
            /* background: rgba(239, 68, 68, 0.2); */
            color: rgb(239, 68, 68);
            /* border: 1px solid rgba(239, 68, 68, 0.3); */
        }

        /* Metric cards */
        .metric-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            transition: all 0.3s ease;
            border-radius: 16px;
            padding: 20px;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            line-height: 1;
        }

        .metric-trend {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 500;
        }

        .trend-up {
            color: rgb(34, 197, 94);
            background: rgba(34, 197, 94, 0.1);
        }

        .trend-down {
            color: rgb(239, 68, 68);
            background: rgba(239, 68, 68, 0.1);
        }

        /* Chart containers */
        .chart-container {
            background: var(--glass-bg);
            border-radius: 12px;
            padding: 16px;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--glass-border);
            width: 100%;
        }
        
        .chart-container > div {
            width: 90%;
            margin: auto;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .menu-item {
                margin: 2px 8px;
                padding: 8px 12px;
            }
        }

        /* Scrollbar styles */
        .omni-sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .omni-sidebar::-webkit-scrollbar-track {
            background: transparent;
        }

        .omni-sidebar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
        }

        .omni-sidebar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>

<body class="from-blue-800 via-purple-700 to-purple-800 font-sans">
    <div class="flex flex-col h-screen overflow-hidden">
        <!-- Top Navigation Bar -->
        <div class="glass border-b border-white/20" style="z-index: 1;">
            <div class="flex items-center justify-between h-16 px-6">
                <!-- Left: App Logo and Status -->
                <div class="flex items-center">
                    <div class="flex-shrink-0 mr-6">
                        <div
                            class="w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-500 rounded-lg flex items-center justify-center text-white font-bold text-lg">
                            🤖
                        </div>
                    </div>
                    <div class="hidden md:block">
                        <h1 class="text-xl font-bold text-white cursor-default" id="app-title">
                            智能助手 - 应用运维运营工作台
                        </h1>
                        <div class="flex items-center mt-1">
                            <div class="status-online mr-3">🟢 运行中</div>
                            <small class="text-white/60 text-sm" id="app-id">
                                App ID: qa-assistant-prod-001
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Right: Controls and Tools -->
                <div class="flex items-center space-x-4">
                    <!-- Help Documentation -->
                    <div class="relative">
                        <button
                            class="omni-btn px-4 py-2 glass text-white text-sm font-semibold specular-highlight focus:outline-none flex items-center"
                            onclick="openHelp()">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                </path>
                            </svg>
                            帮助文档
                        </button>
                    </div>


                    <!-- Back to Production Portal -->
                    <div class="relative">
                        <button
                            class="omni-btn px-4 py-2 glass text-white text-sm font-semibold specular-highlight focus:outline-none flex items-center"
                            onclick="goToProductionPortal()">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                            </svg>
                            生产门户
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex flex-1 overflow-hidden">
            <!-- Left Sidebar -->
            <div class="omni-sidebar w-72 flex-shrink-0 mt-4 ml-4 mb-4 rounded-xl">
                <div class="menu-container h-full overflow-y-auto">
                    <nav class="mt-4">
                        <div class="px-6 py-4 border-b border-white/10">
                            <h2 class="text-lg font-bold text-white">运营监控</h2>
                            <p class="text-sm text-white/60 mt-1">单应用运维运营侧</p>
                        </div>

                        <!-- 工作台 -->
                        <div class="menu-item flex items-center px-6 py-4 specular-highlight" onclick="showDashboard()">
                            <span class="mr-3">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z">
                                    </path>
                                </svg>
                            </span>
                            <span>工作台</span>
                        </div>

                        <!-- 知识库 RAG -->
                        <div class="menu-item flex items-center justify-between px-6 py-4 specular-highlight active"
                            onclick="toggleKnowledgeSubmenu()">
                            <div class="flex items-center">
                                <span class="mr-3">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253">
                                        </path>
                                    </svg>
                                </span>
                                <span>知识库 RAG</span>
                            </div>
                            <svg id="knowledge-submenu-arrow" class="w-4 h-4 transition-transform duration-300"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>

                        <!-- 知识库 RAG 子菜单 -->
                        <div id="knowledge-submenu" class="ml-4 space-y-1">
                            <div class="menu-item flex items-center px-6 py-3 specular-highlight"
                                onclick="loadPage('/development/data-process/knowledge.html')">
                                <span class="mr-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
                                        </path>
                                    </svg>
                                </span>
                                <span>运营侧知识库管理</span>
                            </div>
                            <div class="menu-item flex items-center px-6 py-3 specular-highlight"
                                onclick="loadPage('/development/data-process/qa-feedback.html')">
                                <span class="mr-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z">
                                        </path>
                                    </svg>
                                </span>
                                <span>问答对质量监控</span>
                            </div>
                        </div>

                        <!-- 意图参数配置 -->
                        <div class="menu-item flex items-center px-6 py-4 specular-highlight"
                            onclick="loadPage('/operations/business-operations/intent-params.html')">
                            <span class="mr-3">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4">
                                    </path>
                                </svg>
                            </span>
                            <span>意图参数配置</span>
                        </div>

                        <!-- 用户价值分析 -->
                        <div class="menu-item flex items-center justify-between px-6 py-4 specular-highlight"
                            onclick="toggleUserAnalysisSubmenu()">
                            <div class="flex items-center">
                                <span class="mr-3">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z">
                                        </path>
                                    </svg>
                                </span>
                                <span>用户价值分析</span>
                            </div>
                            <svg id="user-analysis-submenu-arrow" class="w-4 h-4 transition-transform duration-300"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>

                        <!-- 用户价值分析子菜单 -->
                        <div id="user-analysis-submenu" class="hidden ml-4 space-y-1">
                            <div class="menu-item flex items-center px-6 py-3 specular-highlight"
                                onclick="loadPage('/operations/user-experience/qa-analysis.html')">
                                <span class="mr-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
                                        </path>
                                    </svg>
                                </span>
                                <span>问答分析</span>
                            </div>
                            <div class="menu-item flex items-center px-6 py-3 specular-highlight"
                                onclick="loadPage('/operations/user-experience/user-feedback-v2.html')">
                                <span class="mr-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z">
                                        </path>
                                    </svg>
                                </span>
                                <span>用户反馈</span>
                            </div>
                            <div class="menu-item flex items-center px-6 py-3 specular-highlight"
                                onclick="loadPage('/operations/user-experience/user-satisfy-v2.html')">
                                <span class="mr-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                        </path>
                                    </svg>
                                </span>
                                <span>满意度分析</span>
                            </div>
                        </div>

                        <!-- 业务运营 -->
                        <div class="menu-item flex items-center justify-between px-6 py-4 specular-highlight"
                            onclick="toggleBusinessOpsSubmenu()">
                            <div class="flex items-center">
                                <span class="mr-3">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                                        </path>
                                    </svg>
                                </span>
                                <span>业务运营</span>
                            </div>
                            <svg id="business-ops-submenu-arrow" class="w-4 h-4 transition-transform duration-300"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>

                        <!-- 业务运营子菜单 -->
                        <div id="business-ops-submenu" class="hidden ml-4 space-y-1">
                            <div class="menu-item flex items-center px-6 py-3 specular-highlight"
                                onclick="loadPage('/operations/business-operations/usage-metrics.html')">
                                <span class="mr-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                        </path>
                                    </svg>
                                </span>
                                <span>使用指标</span>
                            </div>
                            <div class="menu-item flex items-center px-6 py-3 specular-highlight"
                                onclick="loadPage('/operations/business-operations/qa-performance.html')">
                                <span class="mr-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                </span>
                                <span>问答效能</span>
                            </div>
                            <div class="menu-item flex items-center px-6 py-3 specular-highlight"
                                onclick="loadPage('/operations/business-operations/operation-logs.html')">
                                <span class="mr-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                        </path>
                                    </svg>
                                </span>
                                <span>操作记录</span>
                            </div>
                            <div class="menu-item flex items-center px-6 py-3 specular-highlight"
                                onclick="loadPage('/operations/business-operations/ai-performance.html')">
                                <span class="mr-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z">
                                        </path>
                                    </svg>
                                </span>
                                <span>AI表现</span>
                            </div>
                            <div class="menu-item flex items-center px-6 py-3 specular-highlight"
                                onclick="loadPage('/operations/business-operations/roi-analysis.html')">
                                <span class="mr-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                        </path>
                                    </svg>
                                </span>
                                <span>ROI分析</span>
                            </div>
                        </div>

                        <!-- 决策洞察 -->
                        <div class="menu-item flex items-center justify-between px-6 py-4 specular-highlight"
                            onclick="toggleDecisionInsightsSubmenu()">
                            <div class="flex items-center">
                                <span class="mr-3">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                                        </path>
                                    </svg>
                                </span>
                                <span>决策洞察</span>
                            </div>
                            <svg id="decision-insights-submenu-arrow" class="w-4 h-4 transition-transform duration-300"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>

                        <!-- 决策洞察子菜单 -->
                        <div id="decision-insights-submenu" class="hidden ml-4 space-y-1">
                            <div class="menu-item flex items-center px-6 py-3 specular-highlight"
                                onclick="loadPage('/operations/decision-insights/trend-analysis.html')">
                                <span class="mr-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z">
                                        </path>
                                    </svg>
                                </span>
                                <span>趋势分析</span>
                            </div>
                            <div class="menu-item flex items-center px-6 py-3 specular-highlight"
                                onclick="loadPage('/operations/decision-insights/market-insight.html')">
                                <span class="mr-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9-9a9 9 0 00-9 9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9">
                                        </path>
                                    </svg>
                                </span>
                                <span>市场洞察</span>
                            </div>
                            <div class="menu-item flex items-center px-6 py-3 specular-highlight"
                                onclick="loadPage('/operations/decision-insights/prediction-model.html')">
                                <span class="mr-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z">
                                        </path>
                                    </svg>
                                </span>
                                <span>预测模型</span>
                            </div>
                        </div>

                        <!-- 权限设置 -->
                        <div class="menu-item flex items-center justify-between px-6 py-4 specular-highlight"
                            onclick="togglePermissionsSubmenu()">
                            <div class="flex items-center">
                                <span class="mr-3">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z">
                                        </path>
                                    </svg>
                                </span>
                                <span>权限设置</span>
                            </div>
                            <svg id="permissions-submenu-arrow" class="w-4 h-4 transition-transform duration-300"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>

                        <!-- 权限设置子菜单 -->
                        <div id="permissions-submenu" class="hidden ml-4 space-y-1">
                            <div class="menu-item flex items-center px-6 py-3 specular-highlight"
                                onclick="loadPage('/maintenance/basic-permissions/api-permissions.html')">
                                <span class="mr-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z">
                                        </path>
                                    </svg>
                                </span>
                                <span>用户访问控制</span>
                            </div>
                            <div class="menu-item flex items-center px-6 py-3 specular-highlight"
                                onclick="loadPage('/maintenance/basic-permissions/resource-permissions.html')">
                                <span class="mr-3">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z">
                                        </path>
                                    </svg>
                                </span>
                                <span>数据访问权限</span>
                            </div>
                        </div>
                    </nav>
                </div>
            </div>

            <!-- Main Content -->
            <div class="flex-1 flex flex-col overflow-hidden">
                <div class="flex-1 overflow-auto p-4">
                    <!-- IFRAME Content Container -->
                    <div id="iframe-container" class="w-full h-full hidden">
                        <iframe id="content-iframe" src="" class="w-full h-full border-0 rounded-xl glass"
                            frameborder="0"></iframe>
                    </div>

                    <!-- Default Dashboard Content -->
                    <div id="dashboard-content">
                        <!-- 新的工作台卡片 -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <!-- 界面支持查询 -->
                            <div class="metric-card cursor-pointer" onclick="showMonitoringDashboard()">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-white/90 font-bold text-lg">界面支持查询</h3>
                                    <span class="text-blue-400 text-3xl">📊</span>
                                </div>
                                <p class="text-white/70 text-sm mb-4">通过埋点监控分析展示AI行员助手使用情况，追踪应用热点和效能</p>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="metric-value text-blue-400 text-2xl">2,854</div>
                                        <div class="text-white/60 text-sm">今日查询次数</div>
                                    </div>
                                    <div class="metric-trend trend-up">↗ +15.2%</div>
                                </div>
                            </div>

                            <!-- 助手热度监控 -->
                            <div class="metric-card cursor-pointer" onclick="showHotKeywords()">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-white/90 font-bold text-lg">助手热度监控</h3>
                                    <span class="text-orange-400 text-3xl">🔥</span>
                                </div>
                                <p class="text-white/70 text-sm mb-4">按机构维度日、月、季、年统计TOP10高频检索关键词，发现业务瓶颈</p>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="metric-value text-orange-400 text-2xl">156</div>
                                        <div class="text-white/60 text-sm">热点关键词</div>
                                    </div>
                                    <div class="metric-trend trend-up">↗ +8.6%</div>
                                </div>
                            </div>

                            <!-- 知识质量评估 -->
                            <div class="metric-card cursor-pointer" onclick="showQualityAssessment()">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-white/90 font-bold text-lg">知识质量评估</h3>
                                    <span class="text-red-400 text-3xl">📈</span>
                                </div>
                                <p class="text-white/70 text-sm mb-4">统计不准确、未解决问题数量，并根据内容关键词聚类形成清单</p>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="metric-value text-red-400 text-2xl">32</div>
                                        <div class="text-white/60 text-sm">待改进问题</div>
                                    </div>
                                    <div class="metric-trend trend-down">↘ -5.2%</div>
                                </div>
                            </div>

                            <!-- 知识效能追踪 -->
                            <div class="metric-card cursor-pointer" onclick="showEfficiencyTracking()">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-white/90 font-bold text-lg">知识效能追踪</h3>
                                    <span class="text-green-400 text-3xl">⚡</span>
                                </div>
                                <p class="text-white/70 text-sm mb-4">统计AI行员助手使用情况及解决问题数量，以及平均问题解决时长</p>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="metric-value text-green-400 text-2xl">1.8s</div>
                                        <div class="text-white/60 text-sm">平均解决时长</div>
                                    </div>
                                    <div class="metric-trend trend-down">↘ -0.2s</div>
                                </div>
                            </div>
                        </div>
                        <!-- Recent Activities and Alerts -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Recent User Feedback -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-lg font-bold text-white mb-4">最新用户反馈</h3>
                                <div class="space-y-4">
                                    <div class="border-l-4 border-green-400 pl-4">
                                        <p class="text-white/80 text-sm">回答很准确，帮助很大！</p>
                                        <p class="text-white/50 text-xs mt-1">用户ID: u_1234 · 2分钟前</p>
                                    </div>
                                    <div class="border-l-4 border-yellow-400 pl-4">
                                        <p class="text-white/80 text-sm">响应速度可以再快一些</p>
                                        <p class="text-white/50 text-xs mt-1">用户ID: u_5678 · 15分钟前</p>
                                    </div>
                                    <div class="border-l-4 border-green-400 pl-4">
                                        <p class="text-white/80 text-sm">界面很友好，体验不错</p>
                                        <p class="text-white/50 text-xs mt-1">用户ID: u_9012 · 1小时前</p>
                                    </div>
                                </div>
                                <button class="w-full mt-4 omni-btn py-2 glass text-white text-sm hover:bg-white/20"
                                    onclick="loadPage('/operations/user-experience/user-feedback-v2.html')">
                                    查看全部反馈
                                </button>
                            </div>

                            <!-- System Alerts -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-lg font-bold text-white mb-4">系统告警</h3>
                                <div class="space-y-4">
                                    <div class="flex items-start space-x-3">
                                        <div class="w-2 h-2 bg-yellow-400 rounded-full mt-2"></div>
                                        <div>
                                            <p class="text-white/80 text-sm">知识库命中率下降</p>
                                            <p class="text-white/50 text-xs">建议更新知识库内容</p>
                                            <p class="text-white/40 text-xs mt-1">30分钟前</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start space-x-3">
                                        <div class="w-2 h-2 bg-green-400 rounded-full mt-2"></div>
                                        <div>
                                            <p class="text-white/80 text-sm">性能优化完成</p>
                                            <p class="text-white/50 text-xs">响应时间提升15%</p>
                                            <p class="text-white/40 text-xs mt-1">2小时前</p>
                                        </div>
                                    </div>
                                </div>
                                <button class="w-full mt-4 omni-btn py-2 glass text-white text-sm hover:bg-white/20">
                                    查看所有告警
                                </button>
                            </div>

                            <!-- Quick Actions -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-lg font-bold text-white mb-4">快速操作</h3>
                                <div class="space-y-3">
                                    <button
                                        class="w-full omni-btn py-3 bg-blue-600/80 hover:bg-blue-600 text-white text-sm"
                                        onclick="loadPage('/operations/business-operations/usage-metrics.html')">
                                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                            </path>
                                        </svg>
                                        使用指标分析
                                    </button>
                                    <button
                                        class="w-full omni-btn py-3 bg-green-600/80 hover:bg-green-600 text-white text-sm"
                                        onclick="loadPage('/operations/user-experience/qa-analysis.html')">
                                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
                                            </path>
                                        </svg>
                                        问答质量分析
                                    </button>
                                    <button
                                        class="w-full omni-btn py-3 bg-purple-600/80 hover:bg-purple-600 text-white text-sm"
                                        onclick="generateReport()">
                                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                            </path>
                                        </svg>
                                        生成运营报告
                                    </button>
                                    <button
                                        class="w-full omni-btn py-3 bg-orange-600/80 hover:bg-orange-600 text-white text-sm"
                                        onclick="optimizeSettings()">
                                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                                            </path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                        智能优化建议
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- 详细分析区域 -->
                    <div id="detailed-analysis" class="hidden">
                        <!-- 界面支持查询详情 -->
                        <div id="monitoring-detail" class="hidden">
                            <div class="glass rounded-xl p-6 mb-6">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-xl font-bold text-white">埋点监控分析 - AI行员助手使用情况</h3>
                                    <div class="flex space-x-2">
                                        <select id="monitoring-time-range"
                                            class="bg-white/10 text-white border border-white/20 rounded px-3 py-1 text-sm">
                                            <option value="today">今日</option>
                                            <option value="week">近一周</option>
                                            <option value="month">近一月</option>
                                            <option value="quarter">近三月</option>
                                        </select>
                                        <button onclick="refreshMonitoringData()"
                                            class="omni-btn px-3 py-1 glass text-white text-sm">刷新</button>
                                        <button onclick="exportMonitoringData()"
                                            class="omni-btn px-3 py-1 glass text-white text-sm">导出</button>
                                        <button onclick="backToDashboard()"
                                            class="omni-btn px-4 py-2 glass text-white text-sm">返回工作台</button>
                                    </div>
                                </div>

                                <!-- 关键指标仪表板 -->
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">总查询次数</h4>
                                        <div class="metric-value text-blue-400 text-2xl">28,547</div>
                                        <div class="flex items-center mt-2">
                                            <div class="metric-trend trend-up text-xs">↗ +15.2%</div>
                                            <span class="text-white/50 text-xs ml-2">较昨日</span>
                                        </div>
                                    </div>
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">成功查询率</h4>
                                        <div class="metric-value text-green-400 text-2xl">94.7%</div>
                                        <div class="flex items-center mt-2">
                                            <div class="metric-trend trend-up text-xs">↗ +2.1%</div>
                                            <span class="text-white/50 text-xs ml-2">较上周</span>
                                        </div>
                                    </div>
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">平均响应时间</h4>
                                        <div class="metric-value text-yellow-400 text-2xl">1.2s</div>
                                        <div class="flex items-center mt-2">
                                            <div class="metric-trend trend-down text-xs">↘ -0.3s</div>
                                            <span class="text-white/50 text-xs ml-2">性能优化</span>
                                        </div>
                                    </div>
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">活跃机构数</h4>
                                        <div class="metric-value text-purple-400 text-2xl">126</div>
                                        <div class="flex items-center mt-2">
                                            <div class="metric-trend trend-up text-xs">↗ +8</div>
                                            <span class="text-white/50 text-xs ml-2">新增机构</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- 图表区域 -->
                                <div class="flex flex-cols mb-6">
                                    <div class="chart-container mr-3 p-4">
                                        <div id="usage-trend-chart" style="height: 300px;"></div>
                                    </div>
                                    <div class="chart-container ml-3 p-4">
                                        <div id="hotspot-analysis-chart" style="height: 300px;"></div>
                                    </div>
                                </div>

                                <!-- 业务指引分析 -->
                                <div class="glass-strong rounded-xl p-6">
                                    <h4 class="text-lg font-bold text-white mb-4">业务支持及优化指引</h4>
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <!-- 热点业务分析 -->
                                        <div>
                                            <h5 class="text-white font-semibold mb-3">🔥 热点业务领域 TOP5</h5>
                                            <div class="space-y-2">
                                                <div class="flex justify-between items-center p-2 bg-white/5 rounded">
                                                    <span class="text-white/80">信贷业务查询</span>
                                                    <div class="flex items-center">
                                                        <span class="text-blue-400 font-bold mr-2">8,543</span>
                                                        <span class="text-green-400 text-sm">↗ +12.5%</span>
                                                    </div>
                                                </div>
                                                <div class="flex justify-between items-center p-2 bg-white/5 rounded">
                                                    <span class="text-white/80">存款业务咨询</span>
                                                    <div class="flex items-center">
                                                        <span class="text-blue-400 font-bold mr-2">6,821</span>
                                                        <span class="text-green-400 text-sm">↗ +8.3%</span>
                                                    </div>
                                                </div>
                                                <div class="flex justify-between items-center p-2 bg-white/5 rounded">
                                                    <span class="text-white/80">理财产品咨询</span>
                                                    <div class="flex items-center">
                                                        <span class="text-blue-400 font-bold mr-2">5,267</span>
                                                        <span class="text-green-400 text-sm">↗ +15.7%</span>
                                                    </div>
                                                </div>
                                                <div class="flex justify-between items-center p-2 bg-white/5 rounded">
                                                    <span class="text-white/80">信用卡业务</span>
                                                    <div class="flex items-center">
                                                        <span class="text-blue-400 font-bold mr-2">4,156</span>
                                                        <span class="text-red-400 text-sm">↘ -3.2%</span>
                                                    </div>
                                                </div>
                                                <div class="flex justify-between items-center p-2 bg-white/5 rounded">
                                                    <span class="text-white/80">转账汇款</span>
                                                    <div class="flex items-center">
                                                        <span class="text-blue-400 font-bold mr-2">3,924</span>
                                                        <span class="text-green-400 text-sm">↗ +5.1%</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 优化建议 -->
                                        <div>
                                            <h5 class="text-white font-semibold mb-3">💡 优化建议</h5>
                                            <div class="space-y-3">
                                                <div class="p-3 bg-blue-500/20 border-l-4 border-blue-400 rounded">
                                                    <p class="text-white font-semibold text-sm">信贷业务效能提升</p>
                                                    <p class="text-white/70 text-xs mt-1">建议增强信贷业务知识库，优化常见问题回答模板</p>
                                                </div>
                                                <div class="p-3 bg-yellow-500/20 border-l-4 border-yellow-400 rounded">
                                                    <p class="text-white font-semibold text-sm">理财产品热度上升</p>
                                                    <p class="text-white/70 text-xs mt-1">关注理财产品查询量增长，建议加强相关专业培训</p>
                                                </div>
                                                <div class="p-3 bg-red-500/20 border-l-4 border-red-400 rounded">
                                                    <p class="text-white font-semibold text-sm">信用卡业务下降</p>
                                                    <p class="text-white/70 text-xs mt-1">需要关注信用卡业务查询量下降原因，及时调整策略</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 助手热度监控详情 -->
                        <div id="keywords-detail" class="hidden">
                            <div class="glass rounded-xl p-6 mb-6">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-xl font-bold text-white">助手热度监控 - 业务瓶颈识别分析</h3>
                                    <div class="flex space-x-2">
                                        <select id="dept-filter"
                                            class="bg-white/10 text-white border border-white/20 rounded px-3 py-1 text-sm">
                                            <option value="all">全行</option>
                                            <option value="branch1">分行一</option>
                                            <option value="branch2">分行二</option>
                                            <option value="branch3">分行三</option>
                                            <option value="headquarters">总行</option>
                                        </select>
                                        <select id="time-period"
                                            class="bg-white/10 text-white border border-white/20 rounded px-3 py-1 text-sm">
                                            <option value="day">日</option>
                                            <option value="week">周</option>
                                            <option value="month">月</option>
                                            <option value="quarter">季</option>
                                            <option value="year">年</option>
                                        </select>
                                        <button onclick="generateBottleneckReport()"
                                            class="omni-btn px-3 py-1 glass text-white text-sm">瓶颈报告</button>
                                        <button onclick="exportKeywordsData()"
                                            class="omni-btn px-3 py-1 glass text-white text-sm">导出</button>
                                        <button onclick="backToDashboard()"
                                            class="omni-btn px-4 py-2 glass text-white text-sm">返回工作台</button>
                                    </div>
                                </div>

                                <!-- 热度指标概览 -->
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">热门关键词</h4>
                                        <div class="metric-value text-orange-400 text-2xl">247</div>
                                        <div class="text-white/60 text-xs mt-1">较上期 +23</div>
                                    </div>
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">最高检索频次</h4>
                                        <div class="metric-value text-red-400 text-2xl">1,247</div>
                                        <div class="text-white/60 text-xs mt-1">关键词: 贷款</div>
                                    </div>
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">瓶颈机构数</h4>
                                        <div class="metric-value text-yellow-400 text-2xl">12</div>
                                        <div class="text-white/60 text-xs mt-1">需重点关注</div>
                                    </div>
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">均值检索量</h4>
                                        <div class="metric-value text-blue-400 text-2xl">186</div>
                                        <div class="text-white/60 text-xs mt-1">每关键词/日</div>
                                    </div>
                                </div>

                                <!-- 图表分析 -->
                                <div class="flex flex-cols mb-6">
                                    <div class="chart-container mr-3 p-4">
                                        <div id="keywords-ranking-chart" style="height: 300px;"></div>
                                    </div>
                                    <div class="chart-container ml-3 p-4">
                                        <div id="department-comparison-chart" style="height: 300px;"></div>
                                    </div>
                                </div>

                                <!-- 业务瓶颈识别 -->
                                <div class="glass-strong rounded-xl p-6">
                                    <h4 class="text-lg font-bold text-white mb-4">🔴 业务瓶颈识别与分析</h4>
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <!-- 高频瓶颈问题 -->
                                        <div>
                                            <h5 class="text-white font-semibold mb-3">⚠️ 高频瓶颈问题 TOP5</h5>
                                            <div class="space-y-3">
                                                <div class="p-3 bg-red-500/20 border-l-4 border-red-400 rounded">
                                                    <div class="flex justify-between items-start">
                                                        <div>
                                                            <p class="text-white font-semibold text-sm">贷款审批流程复杂</p>
                                                            <p class="text-white/70 text-xs mt-1">关键词: 贷款审批、流程、资料</p>
                                                            <p class="text-red-300 text-xs mt-1">检索频次: 1,247/日</p>
                                                        </div>
                                                        <span class="text-red-400 font-bold text-xs">High</span>
                                                    </div>
                                                </div>
                                                <div class="p-3 bg-orange-500/20 border-l-4 border-orange-400 rounded">
                                                    <div class="flex justify-between items-start">
                                                        <div>
                                                            <p class="text-white font-semibold text-sm">理财产品信息不全</p>
                                                            <p class="text-white/70 text-xs mt-1">关键词: 理财、收益率、风险</p>
                                                            <p class="text-orange-300 text-xs mt-1">检索频次: 892/日</p>
                                                        </div>
                                                        <span class="text-orange-400 font-bold text-xs">Medium</span>
                                                    </div>
                                                </div>
                                                <div class="p-3 bg-yellow-500/20 border-l-4 border-yellow-400 rounded">
                                                    <div class="flex justify-between items-start">
                                                        <div>
                                                            <p class="text-white font-semibold text-sm">信用卡分期政策</p>
                                                            <p class="text-white/70 text-xs mt-1">关键词: 信用卡、分期、手续费</p>
                                                            <p class="text-yellow-300 text-xs mt-1">检索频次: 678/日</p>
                                                        </div>
                                                        <span class="text-yellow-400 font-bold text-xs">Medium</span>
                                                    </div>
                                                </div>
                                                <div class="p-3 bg-blue-500/20 border-l-4 border-blue-400 rounded">
                                                    <div class="flex justify-between items-start">
                                                        <div>
                                                            <p class="text-white font-semibold text-sm">网上银行操作</p>
                                                            <p class="text-white/70 text-xs mt-1">关键词: 网银、转账、安全</p>
                                                            <p class="text-blue-300 text-xs mt-1">检索频次: 543/日</p>
                                                        </div>
                                                        <span class="text-blue-400 font-bold text-xs">Low</span>
                                                    </div>
                                                </div>
                                                <div class="p-3 bg-purple-500/20 border-l-4 border-purple-400 rounded">
                                                    <div class="flex justify-between items-start">
                                                        <div>
                                                            <p class="text-white font-semibold text-sm">保险产品条款</p>
                                                            <p class="text-white/70 text-xs mt-1">关键词: 保险、理赔、条款</p>
                                                            <p class="text-purple-300 text-xs mt-1">检索频次: 421/日</p>
                                                        </div>
                                                        <span class="text-purple-400 font-bold text-xs">Low</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 机构对比分析 -->
                                        <div>
                                            <h5 class="text-white font-semibold mb-3">🏢 机构对比分析</h5>
                                            <div class="space-y-3">
                                                <!-- 总行数据 -->
                                                <div class="p-3 bg-white/5 rounded">
                                                    <div class="flex justify-between items-center mb-2">
                                                        <span class="text-white font-semibold">💼 总行本部</span>
                                                        <span class="text-green-400 text-sm">优秀</span>
                                                    </div>
                                                    <div class="grid grid-cols-3 gap-2 text-xs">
                                                        <div class="text-center">
                                                            <div class="text-blue-400 font-bold">156</div>
                                                            <div class="text-white/60">关键词数</div>
                                                        </div>
                                                        <div class="text-center">
                                                            <div class="text-green-400 font-bold">92.3%</div>
                                                            <div class="text-white/60">解决率</div>
                                                        </div>
                                                        <div class="text-center">
                                                            <div class="text-yellow-400 font-bold">1.1s</div>
                                                            <div class="text-white/60">平均时间</div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 分行数据 -->
                                                <div class="p-3 bg-white/5 rounded">
                                                    <div class="flex justify-between items-center mb-2">
                                                        <span class="text-white font-semibold">🏦 分行一</span>
                                                        <span class="text-yellow-400 text-sm">待改善</span>
                                                    </div>
                                                    <div class="grid grid-cols-3 gap-2 text-xs">
                                                        <div class="text-center">
                                                            <div class="text-blue-400 font-bold">234</div>
                                                            <div class="text-white/60">关键词数</div>
                                                        </div>
                                                        <div class="text-center">
                                                            <div class="text-red-400 font-bold">78.5%</div>
                                                            <div class="text-white/60">解决率</div>
                                                        </div>
                                                        <div class="text-center">
                                                            <div class="text-red-400 font-bold">2.3s</div>
                                                            <div class="text-white/60">平均时间</div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="p-3 bg-white/5 rounded">
                                                    <div class="flex justify-between items-center mb-2">
                                                        <span class="text-white font-semibold">🏦 分行二</span>
                                                        <span class="text-green-400 text-sm">良好</span>
                                                    </div>
                                                    <div class="grid grid-cols-3 gap-2 text-xs">
                                                        <div class="text-center">
                                                            <div class="text-blue-400 font-bold">189</div>
                                                            <div class="text-white/60">关键词数</div>
                                                        </div>
                                                        <div class="text-center">
                                                            <div class="text-green-400 font-bold">85.7%</div>
                                                            <div class="text-white/60">解决率</div>
                                                        </div>
                                                        <div class="text-center">
                                                            <div class="text-yellow-400 font-bold">1.6s</div>
                                                            <div class="text-white/60">平均时间</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 知识质量评估详情 -->
                        <div id="quality-detail" class="hidden">
                            <div class="glass rounded-xl p-6 mb-6">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-xl font-bold text-white">知识质量评估 - 业务流程优化分析</h3>
                                    <div class="flex space-x-2">
                                        <select id="quality-category"
                                            class="bg-white/10 text-white border border-white/20 rounded px-3 py-1 text-sm">
                                            <option value="all">全部问题</option>
                                            <option value="process">业务流程</option>
                                            <option value="policy">制度政策</option>
                                            <option value="technical">技术操作</option>
                                            <option value="product">产品服务</option>
                                        </select>
                                        <select id="priority-filter"
                                            class="bg-white/10 text-white border border-white/20 rounded px-3 py-1 text-sm">
                                            <option value="all">全部优先级</option>
                                            <option value="high">高优先级</option>
                                            <option value="medium">中优先级</option>
                                            <option value="low">低优先级</option>
                                        </select>
                                        <button onclick="generateQualityReport()"
                                            class="omni-btn px-3 py-1 glass text-white text-sm">质量报告</button>
                                        <button onclick="exportQualityData()"
                                            class="omni-btn px-3 py-1 glass text-white text-sm">导出</button>
                                        <button onclick="backToDashboard()"
                                            class="omni-btn px-4 py-2 glass text-white text-sm">返回工作台</button>
                                    </div>
                                </div>

                                <!-- 质量指标概览 -->
                                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">不准确问题</h4>
                                        <div class="metric-value text-red-400 text-2xl">32</div>
                                        <div class="text-white/60 text-xs mt-1">待解决</div>
                                    </div>
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">未解决问题</h4>
                                        <div class="metric-value text-orange-400 text-2xl">18</div>
                                        <div class="text-white/60 text-xs mt-1">需关注</div>
                                    </div>
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">聚类类别</h4>
                                        <div class="metric-value text-blue-400 text-2xl">8</div>
                                        <div class="text-white/60 text-xs mt-1">主要问题类型</div>
                                    </div>
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">待修订条款</h4>
                                        <div class="metric-value text-purple-400 text-2xl">12</div>
                                        <div class="text-white/60 text-xs mt-1">制度空白</div>
                                    </div>
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">修订进度</h4>
                                        <div class="metric-value text-green-400 text-2xl">76%</div>
                                        <div class="text-white/60 text-xs mt-1">完成率</div>
                                    </div>
                                </div>

                                <!-- 图表分析 -->
                                <div class="flex flex-cols mb-6">
                                    <div class="chart-container mr-3 p-4">
                                        <div id="problem-category-chart" style="height: 300px;"></div>
                                    </div>
                                    <div class="chart-container ml-3 p-4">
                                        <div id="resolution-trend-chart" style="height: 300px;"></div>
                                    </div>
                                </div>

                                <!-- 问题聚类分析与修订建议 -->
                                <div class="glass-strong rounded-xl p-6">
                                    <h4 class="text-lg font-bold text-white mb-4">🔍 问题聚类分析与修订建议</h4>
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <!-- 业务流程问题 -->
                                        <div>
                                            <h5 class="text-white font-semibold mb-3">💼 业务流程不准确问题 (15个)</h5>
                                            <div class="space-y-3">
                                                <div class="p-3 bg-red-500/20 border-l-4 border-red-400 rounded">
                                                    <div class="flex justify-between items-start mb-2">
                                                        <p class="text-white font-semibold text-sm">贷款审批流程不清晰</p>
                                                        <span class="text-red-400 font-bold text-xs">High</span>
                                                    </div>
                                                    <p class="text-white/70 text-xs mb-2">关键词: 贷款审批、资料清单、审批时间、流程图</p>
                                                    <p class="text-red-300 text-xs mb-2">问题数量: 8个 | 频次: 234/周</p>
                                                    <div class="mt-2 p-2 bg-black/20 rounded text-xs">
                                                        <p class="text-green-300 font-semibold">修订建议:</p>
                                                        <p class="text-white/80 mt-1">• 更新贷款审批流程图，明确各环节时间节点</p>
                                                        <p class="text-white/80">• 完善资料清单，区分不同贷款类型需求</p>
                                                        <p class="text-white/80">• 增加审批时间预估和进度查询功能</p>
                                                    </div>
                                                </div>

                                                <div class="p-3 bg-orange-500/20 border-l-4 border-orange-400 rounded">
                                                    <div class="flex justify-between items-start mb-2">
                                                        <p class="text-white font-semibold text-sm">理财产品购买流程</p>
                                                        <span class="text-orange-400 font-bold text-xs">Medium</span>
                                                    </div>
                                                    <p class="text-white/70 text-xs mb-2">关键词: 理财购买、风险评估、购买条件、手续费</p>
                                                    <p class="text-orange-300 text-xs mb-2">问题数量: 4个 | 频次: 156/周</p>
                                                    <div class="mt-2 p-2 bg-black/20 rounded text-xs">
                                                        <p class="text-green-300 font-semibold">修订建议:</p>
                                                        <p class="text-white/80 mt-1">• 简化理财产品购买流程说明</p>
                                                        <p class="text-white/80">• 完善风险评估问卷和结果解读</p>
                                                    </div>
                                                </div>

                                                <div class="p-3 bg-yellow-500/20 border-l-4 border-yellow-400 rounded">
                                                    <div class="flex justify-between items-start mb-2">
                                                        <p class="text-white font-semibold text-sm">网银转账操作</p>
                                                        <span class="text-yellow-400 font-bold text-xs">Medium</span>
                                                    </div>
                                                    <p class="text-white/70 text-xs mb-2">关键词: 转账步骤、安全验证、限额设置、到账时间</p>
                                                    <p class="text-yellow-300 text-xs mb-2">问题数量: 3个 | 频次: 89/周</p>
                                                    <div class="mt-2 p-2 bg-black/20 rounded text-xs">
                                                        <p class="text-green-300 font-semibold">修订建议:</p>
                                                        <p class="text-white/80 mt-1">• 更新网银转账操作指南和截图</p>
                                                        <p class="text-white/80">• 明确不同转账类型的到账时间</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 制度政策问题 -->
                                        <div>
                                            <h5 class="text-white font-semibold mb-3">📜 制度政策缺失问题 (12个)</h5>
                                            <div class="space-y-3">
                                                <div class="p-3 bg-purple-500/20 border-l-4 border-purple-400 rounded">
                                                    <div class="flex justify-between items-start mb-2">
                                                        <p class="text-white font-semibold text-sm">信用卡分期政策不明</p>
                                                        <span class="text-purple-400 font-bold text-xs">High</span>
                                                    </div>
                                                    <p class="text-white/70 text-xs mb-2">关键词: 信用卡分期、手续费率、提前还款、逆息计算</p>
                                                    <p class="text-purple-300 text-xs mb-2">问题数量: 6个 | 频次: 178/周</p>
                                                    <div class="mt-2 p-2 bg-black/20 rounded text-xs">
                                                        <p class="text-green-300 font-semibold">修订建议:</p>
                                                        <p class="text-white/80 mt-1">• 制定详细的信用卡分期政策说明</p>
                                                        <p class="text-white/80">• 增加手续费计算器和示例</p>
                                                        <p class="text-white/80">• 明确提前还款的优惠政策</p>
                                                    </div>
                                                </div>

                                                <div class="p-3 bg-blue-500/20 border-l-4 border-blue-400 rounded">
                                                    <div class="flex justify-between items-start mb-2">
                                                        <p class="text-white font-semibold text-sm">保险产品条款解释</p>
                                                        <span class="text-blue-400 font-bold text-xs">Medium</span>
                                                    </div>
                                                    <p class="text-white/70 text-xs mb-2">关键词: 保险条款、理赔范围、免赔条款、续保政策</p>
                                                    <p class="text-blue-300 text-xs mb-2">问题数量: 4个 | 频次: 92/周</p>
                                                    <div class="mt-2 p-2 bg-black/20 rounded text-xs">
                                                        <p class="text-green-300 font-semibold">修订建议:</p>
                                                        <p class="text-white/80 mt-1">• 编制保险条款通俗解读手册</p>
                                                        <p class="text-white/80">• 增加典型理赔案例分享</p>
                                                    </div>
                                                </div>

                                                <div class="p-3 bg-green-500/20 border-l-4 border-green-400 rounded">
                                                    <div class="flex justify-between items-start mb-2">
                                                        <p class="text-white font-semibold text-sm">优惠政策信息更新</p>
                                                        <span class="text-green-400 font-bold text-xs">Low</span>
                                                    </div>
                                                    <p class="text-white/70 text-xs mb-2">关键词: 优惠政策、活动时间、参与条件、申请流程</p>
                                                    <p class="text-green-300 text-xs mb-2">问题数量: 2个 | 频次: 43/周</p>
                                                    <div class="mt-2 p-2 bg-black/20 rounded text-xs">
                                                        <p class="text-green-300 font-semibold">修订建议:</p>
                                                        <p class="text-white/80 mt-1">• 建立优惠政策定期更新机制</p>
                                                        <p class="text-white/80">• 设置政策到期提醒功能</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 修订进度跟踪 -->
                                    <div class="mt-6">
                                        <h5 class="text-white font-semibold mb-3">📅 修订进度跟踪</h5>
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div class="p-4 bg-green-500/20 rounded-lg">
                                                <h6 class="text-green-300 font-semibold text-sm mb-2">已完成修订</h6>
                                                <div class="space-y-2 text-xs">
                                                    <div class="flex justify-between">
                                                        <span class="text-white/80">业务流程优化</span>
                                                        <span class="text-green-400">8/15</span>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <span class="text-white/80">制度政策补充</span>
                                                        <span class="text-green-400">9/12</span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="p-4 bg-yellow-500/20 rounded-lg">
                                                <h6 class="text-yellow-300 font-semibold text-sm mb-2">进行中</h6>
                                                <div class="space-y-2 text-xs">
                                                    <div class="flex justify-between">
                                                        <span class="text-white/80">流程图更新</span>
                                                        <span class="text-yellow-400">60%</span>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <span class="text-white/80">政策条款修订</span>
                                                        <span class="text-yellow-400">40%</span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="p-4 bg-red-500/20 rounded-lg">
                                                <h6 class="text-red-300 font-semibold text-sm mb-2">待开始</h6>
                                                <div class="space-y-2 text-xs">
                                                    <div class="flex justify-between">
                                                        <span class="text-white/80">系统功能完善</span>
                                                        <span class="text-red-400">0%</span>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <span class="text-white/80">培训资料制作</span>
                                                        <span class="text-red-400">0%</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 知识效能追踪详情 -->
                        <div id="efficiency-detail" class="hidden">
                            <div class="glass rounded-xl p-6 mb-6">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-xl font-bold text-white">知识效能追踪 - 综合效能分析与报告</h3>
                                    <div class="flex space-x-2">
                                        <select id="efficiency-period"
                                            class="bg-white/10 text-white border border-white/20 rounded px-3 py-1 text-sm">
                                            <option value="daily">日报</option>
                                            <option value="weekly">周报</option>
                                            <option value="monthly">月报</option>
                                            <option value="quarterly">季报</option>
                                        </select>
                                        <button onclick="generateEfficiencyReport()"
                                            class="omni-btn px-3 py-1 glass text-white text-sm">生成报告</button>
                                        <button onclick="exportEfficiencyReport()"
                                            class="omni-btn px-3 py-1 glass text-white text-sm">导出ROI</button>
                                        <button onclick="scheduleReport()"
                                            class="omni-btn px-3 py-1 glass text-white text-sm">定时发送</button>
                                        <button onclick="backToDashboard()"
                                            class="omni-btn px-4 py-2 glass text-white text-sm">返回工作台</button>
                                    </div>
                                </div>

                                <!-- 综合效能指标 -->
                                <div class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-6">
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">问题解决率</h4>
                                        <div class="metric-value text-green-400 text-2xl">87.3%</div>
                                        <div class="flex items-center mt-2">
                                            <div class="metric-trend trend-up text-xs">↗ +1.8%</div>
                                            <span class="text-white/50 text-xs ml-2">较上周</span>
                                        </div>
                                    </div>
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">平均解决时长</h4>
                                        <div class="metric-value text-blue-400 text-2xl">1.8s</div>
                                        <div class="flex items-center mt-2">
                                            <div class="metric-trend trend-down text-xs">↘ -0.2s</div>
                                            <span class="text-white/50 text-xs ml-2">效能提升</span>
                                        </div>
                                    </div>
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">日处理量</h4>
                                        <div class="metric-value text-purple-400 text-2xl">2,854</div>
                                        <div class="flex items-center mt-2">
                                            <div class="metric-trend trend-up text-xs">↗ +15.2%</div>
                                            <span class="text-white/50 text-xs ml-2">需求增长</span>
                                        </div>
                                    </div>
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">人工成本节省</h4>
                                        <div class="metric-value text-orange-400 text-2xl">￥12.6万</div>
                                        <div class="text-white/60 text-xs mt-1">月度节省</div>
                                    </div>
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">用户满意度</h4>
                                        <div class="metric-value text-pink-400 text-2xl">94.7%</div>
                                        <div class="flex items-center mt-2">
                                            <div class="metric-trend trend-up text-xs">↗ +2.1%</div>
                                            <span class="text-white/50 text-xs ml-2">持续改善</span>
                                        </div>
                                    </div>
                                    <div class="glass-strong rounded-lg p-4">
                                        <h4 class="text-white/90 font-semibold text-sm mb-2">ROI指数</h4>
                                        <div class="metric-value text-yellow-400 text-2xl">3.2x</div>
                                        <div class="text-white/60 text-xs mt-1">投入产出比</div>
                                    </div>
                                </div>

                                <!-- 图表分析 -->
                                <div class="flex flex-cols mb-6">
                                    <div class="chart-container mr-3 p-4">
                                        <div id="efficiency-trend-chart" style="height: 300px;"></div>
                                    </div>
                                    <div class="chart-container ml-3 p-4">
                                        <div id="resolution-time-chart" style="height: 300px;"></div>
                                    </div>
                                </div>

                                <!-- 效能分析报告 -->
                                <div class="glass-strong rounded-xl p-6">
                                    <h4 class="text-lg font-bold text-white mb-4">📊 效能分析报告输出</h4>
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <!-- AI助手使用情况 -->
                                        <div>
                                            <h5 class="text-white font-semibold mb-3">🤖 AI行员助手使用情况</h5>
                                            <div class="space-y-4">
                                                <div class="p-4 bg-white/5 rounded-lg">
                                                    <div class="flex justify-between items-center mb-3">
                                                        <h6 class="text-white font-semibold text-sm">日常使用统计</h6>
                                                        <span class="text-blue-400 text-sm font-bold">今日</span>
                                                    </div>
                                                    <div class="grid grid-cols-2 gap-3 text-xs">
                                                        <div>
                                                            <div class="text-green-400 font-bold text-lg">2,854</div>
                                                            <div class="text-white/60">总查询次数</div>
                                                        </div>
                                                        <div>
                                                            <div class="text-blue-400 font-bold text-lg">1,247</div>
                                                            <div class="text-white/60">独立用户数</div>
                                                        </div>
                                                        <div>
                                                            <div class="text-purple-400 font-bold text-lg">2,490</div>
                                                            <div class="text-white/60">成功解决数</div>
                                                        </div>
                                                        <div>
                                                            <div class="text-orange-400 font-bold text-lg">364</div>
                                                            <div class="text-white/60">转人工数</div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="p-4 bg-white/5 rounded-lg">
                                                    <div class="flex justify-between items-center mb-3">
                                                        <h6 class="text-white font-semibold text-sm">服务质量指标</h6>
                                                        <span class="text-green-400 text-sm font-bold">优秀</span>
                                                    </div>
                                                    <div class="space-y-2">
                                                        <div class="flex justify-between items-center">
                                                            <span class="text-white/80 text-sm">问题解决率</span>
                                                            <div class="flex items-center">
                                                                <div class="w-16 h-2 bg-white/20 rounded mr-2">
                                                                    <div class="w-14 h-2 bg-green-400 rounded"></div>
                                                                </div>
                                                                <span
                                                                    class="text-green-400 text-sm font-bold">87.3%</span>
                                                            </div>
                                                        </div>
                                                        <div class="flex justify-between items-center">
                                                            <span class="text-white/80 text-sm">用户满意度</span>
                                                            <div class="flex items-center">
                                                                <div class="w-16 h-2 bg-white/20 rounded mr-2">
                                                                    <div class="w-15 h-2 bg-blue-400 rounded"></div>
                                                                </div>
                                                                <span
                                                                    class="text-blue-400 text-sm font-bold">94.7%</span>
                                                            </div>
                                                        </div>
                                                        <div class="flex justify-between items-center">
                                                            <span class="text-white/80 text-sm">响应速度</span>
                                                            <div class="flex items-center">
                                                                <div class="w-16 h-2 bg-white/20 rounded mr-2">
                                                                    <div class="w-12 h-2 bg-yellow-400 rounded"></div>
                                                                </div>
                                                                <span
                                                                    class="text-yellow-400 text-sm font-bold">1.8s</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 效益分析 -->
                                        <div>
                                            <h5 class="text-white font-semibold mb-3">💰 效益分析与价值输出</h5>
                                            <div class="space-y-4">
                                                <div class="p-4 bg-white/5 rounded-lg">
                                                    <div class="flex justify-between items-center mb-3">
                                                        <h6 class="text-white font-semibold text-sm">成本效益分析</h6>
                                                        <span class="text-green-400 text-sm font-bold">月度</span>
                                                    </div>
                                                    <div class="space-y-3">
                                                        <div
                                                            class="flex justify-between items-center p-2 bg-green-500/20 rounded">
                                                            <div>
                                                                <span class="text-white text-sm">人工成本节省</span>
                                                                <div class="text-white/60 text-xs">减少人工咨询工时</div>
                                                            </div>
                                                            <span class="text-green-400 font-bold">￥126,000</span>
                                                        </div>
                                                        <div
                                                            class="flex justify-between items-center p-2 bg-blue-500/20 rounded">
                                                            <div>
                                                                <span class="text-white text-sm">服务效率提升</span>
                                                                <div class="text-white/60 text-xs">24小时在线服务</div>
                                                            </div>
                                                            <span class="text-blue-400 font-bold">￥68,000</span>
                                                        </div>
                                                        <div
                                                            class="flex justify-between items-center p-2 bg-purple-500/20 rounded">
                                                            <div>
                                                                <span class="text-white text-sm">用户体验改善</span>
                                                                <div class="text-white/60 text-xs">响应速度优化</div>
                                                            </div>
                                                            <span class="text-purple-400 font-bold">￥42,000</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="p-4 bg-white/5 rounded-lg">
                                                    <div class="flex justify-between items-center mb-3">
                                                        <h6 class="text-white font-semibold text-sm">ROI投入产出比</h6>
                                                        <span class="text-yellow-400 text-sm font-bold">3.2:1</span>
                                                    </div>
                                                    <div class="text-xs space-y-2">
                                                        <div class="flex justify-between">
                                                            <span class="text-white/70">月度投入成本:</span>
                                                            <span class="text-red-300">￥75,000</span>
                                                        </div>
                                                        <div class="flex justify-between">
                                                            <span class="text-white/70">月度产出效益:</span>
                                                            <span class="text-green-300">￥240,000</span>
                                                        </div>
                                                        <div class="border-t border-white/20 pt-2 flex justify-between">
                                                            <span class="text-white font-semibold">净效益:</span>
                                                            <span class="text-green-400 font-bold">￥165,000</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="p-4 bg-white/5 rounded-lg">
                                                    <h6 class="text-white font-semibold text-sm mb-3">效能提升建议</h6>
                                                    <div class="space-y-2 text-xs">
                                                        <div class="flex items-start space-x-2">
                                                            <span class="text-green-400">•</span>
                                                            <span class="text-white/80">继续优化知识库，提高解决率至10%</span>
                                                        </div>
                                                        <div class="flex items-start space-x-2">
                                                            <span class="text-blue-400">•</span>
                                                            <span class="text-white/80">加强人工智能培训，减少响应时间</span>
                                                        </div>
                                                        <div class="flex items-start space-x-2">
                                                            <span class="text-purple-400">•</span>
                                                            <span class="text-white/80">扩大应用范围，覆盖更多业务场景</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Global app metadata
        window.appMetadata = null;
        const tenantId = localStorage.getItem('tenantId') || 'lAseKW';

        // Get app info from URL parameters
        function getAppInfoFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const appName = urlParams.get('app') || '智能助手';
            const appId = urlParams.get('appId') || 'qa-assistant-prod-001';
            const id = urlParams.get('id'); // 应用数据库ID

            document.getElementById('app-title').textContent = `${appName} - 应用运维运营工作台`;
            document.getElementById('app-id').textContent = `App ID: ${appId}`;

            return { appName, appId, id };
        }

        // Load app metadata from server
        async function loadAppMetadata() {
            try {
                const { id, appId } = getAppInfoFromURL();

                if (!appId && !id) {
                    console.warn('No app ID provided, using default metadata');
                    return;
                }

                let url = '';

                const headers = {
                    'Content-Type': 'application/json',
                    'x-tenant-id': tenantId
                };

                // 优先使用appId作为唯一标识
                url = `/omni-api/applications/by-appid/${appId}`;

                console.log('Loading app metadata from:', url);

                const response = await fetch(url, { headers });
                const result = await response.json();

                if (result.success) {
                    const appData = result.data;

                    if (appData) {
                        // 将应用元数据存储到 window 对象
                        window.appMetadata = appData;

                        // 更新页面显示
                        updatePageWithMetadata(appData);

                        console.log('App metadata loaded successfully:', appData);
                    } else {
                        console.error('App not found');
                    }
                } else {
                    console.error('Failed to load app metadata:', result.error);
                }
            } catch (error) {
                console.error('Error loading app metadata:', error);
            }
        }

        function updatePageWithMetadata(appData) {
            // 更新页面标题和基本信息
            document.getElementById('app-title').textContent = `${appData.name} - 应用运维运营工作台`;
            document.getElementById('app-id').textContent = `App ID: ${appData.appId}`;

            // 更新页面title
            document.title = `${appData.name} - 应用工作台(运维运营侧)`;
        }

        // Background functionality
        function applyBackground(bgNumber) {
            document.body.style.backgroundImage = `linear-gradient(160deg, rgba(255, 255, 255, 0.15) 0%, rgba(0, 0, 0, 0.5) 15%, rgba(0, 0, 0, 0.8) 100%), url('https://img.infinitynewtab.com/wallpaper/${bgNumber}.jpg')`;
        }

        function initializeBackground() {
            const savedBg = localStorage.getItem('omni-background');
            if (savedBg) {
                applyBackground(parseInt(savedBg));
            } else {
                const randomBg = Math.floor(Math.random() * 2000) + 1;
                localStorage.setItem('omni-background', randomBg.toString());
                applyBackground(randomBg);
            }
        }

        // Submenu toggles
        function toggleKnowledgeSubmenu() {
            const submenu = document.getElementById('knowledge-submenu');
            const arrow = document.getElementById('knowledge-submenu-arrow');

            if (submenu.classList.contains('hidden')) {
                submenu.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                submenu.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        function toggleUserAnalysisSubmenu() {
            const submenu = document.getElementById('user-analysis-submenu');
            const arrow = document.getElementById('user-analysis-submenu-arrow');

            if (submenu.classList.contains('hidden')) {
                submenu.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                submenu.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        function toggleBusinessOpsSubmenu() {
            const submenu = document.getElementById('business-ops-submenu');
            const arrow = document.getElementById('business-ops-submenu-arrow');

            if (submenu.classList.contains('hidden')) {
                submenu.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                submenu.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        function toggleDecisionInsightsSubmenu() {
            const submenu = document.getElementById('decision-insights-submenu');
            const arrow = document.getElementById('decision-insights-submenu-arrow');

            if (submenu.classList.contains('hidden')) {
                submenu.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                submenu.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        function togglePermissionsSubmenu() {
            const submenu = document.getElementById('permissions-submenu');
            const arrow = document.getElementById('permissions-submenu-arrow');

            if (submenu.classList.contains('hidden')) {
                submenu.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                submenu.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        // Menu interaction
        function loadPage(url) {
            // Update menu active state
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });

            // Try to find and activate the corresponding menu item
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                const onclick = item.getAttribute('onclick');
                if (onclick && onclick.includes(url)) {
                    item.classList.add('active');
                }
            });

            // Show iframe container and hide dashboard
            document.getElementById('dashboard-content').style.display = 'none';
            document.getElementById('iframe-container').style.display = 'block';

            // Load content in iframe
            const iframe = document.getElementById('content-iframe');
            iframe.src = url;

            console.log('Loading page:', url);
        }

        function showDashboard() {
            // Update menu active state
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });

            // 激活工作台菜单
            const dashboardMenuItem = document.querySelector('.menu-item[onclick="showDashboard()"]');
            if (dashboardMenuItem) {
                dashboardMenuItem.classList.add('active');
            }

            // Show dashboard and hide iframe and detailed analysis
            document.getElementById('iframe-container').style.display = 'none';
            document.getElementById('dashboard-content').style.display = 'block';
            document.getElementById('detailed-analysis').classList.add('hidden');

            // Hide all detail views
            hideAllDetailViews();

            console.log('Showing dashboard');
        }

        function hideAllDetailViews() {
            document.getElementById('monitoring-detail').classList.add('hidden');
            document.getElementById('keywords-detail').classList.add('hidden');
            document.getElementById('quality-detail').classList.add('hidden');
            document.getElementById('efficiency-detail').classList.add('hidden');
        }

        function backToDashboard() {
            document.getElementById('dashboard-content').style.display='';
            hideAllDetailViews();
        }

        // 新的卡片功能函数
        function showMonitoringDashboard() {
            document.getElementById('dashboard-content').style.display = 'none';
            document.getElementById('detailed-analysis').classList.remove('hidden');
            document.getElementById('monitoring-detail').classList.remove('hidden');

            // 初始化图表
            setTimeout(() => {
                initUsageTrendChart();
                initHotspotAnalysisChart();
            }, 200)

        }

        function showHotKeywords() {
            document.getElementById('dashboard-content').style.display = 'none';
            document.getElementById('detailed-analysis').classList.remove('hidden');
            document.getElementById('keywords-detail').classList.remove('hidden');

            // 延迟初始化图表，确保 DOM 元素已显示
            setTimeout(() => {
                initKeywordsRankingChart();
                initDepartmentComparisonChart();
            }, 100);

            // 时间周期变化监听 (移除已有监听器避免重复)
            setTimeout(() => {
                const timePeriodSelect = document.getElementById('time-period');
                if (timePeriodSelect) {
                    // 克隆元素来移除所有事件监听器
                    const newTimePeriodSelect = timePeriodSelect.cloneNode(true);
                    timePeriodSelect.parentNode.replaceChild(newTimePeriodSelect, timePeriodSelect);
    
                    newTimePeriodSelect.addEventListener('change', function () {
                        initKeywordsRankingChart();
                        initDepartmentComparisonChart();
                    });
                }
            }, 150);
        }

        function showQualityAssessment() {
            document.getElementById('dashboard-content').style.display = 'none';
            document.getElementById('detailed-analysis').classList.remove('hidden');
            document.getElementById('quality-detail').classList.remove('hidden');

            // 延迟初始化图表，确保 DOM 元素已显示
            setTimeout(() => {
                initProblemCategoryChart();
                initResolutionTrendChart();
            }, 100);
        }

        function showEfficiencyTracking() {
            document.getElementById('dashboard-content').style.display = 'none';
            document.getElementById('detailed-analysis').classList.remove('hidden');
            document.getElementById('efficiency-detail').classList.remove('hidden');

            // 延迟初始化图表，确保 DOM 元素已显示
            setTimeout(() => {
                initEfficiencyTrendChart();
                initResolutionTimeChart();
            }, 100);
        }

        // Dropdown functionality
        function toggleEnvironmentDropdown() {
            const dropdown = document.getElementById('environment-dropdown');
            dropdown.classList.toggle('show');
            document.getElementById('toolbox-dropdown').classList.remove('show');
        }

        function toggleToolboxDropdown() {
            const dropdown = document.getElementById('toolbox-dropdown');
            dropdown.classList.toggle('show');
            document.getElementById('environment-dropdown').classList.remove('show');
        }

        // Environment selection
        function selectEnvironment(envName, envType) {
            document.getElementById('current-environment').textContent = envName;
            document.getElementById('environment-dropdown').classList.remove('show');
            console.log('Environment switched to:', envType);
        }

        // Tool functions
        function openHelp() {
            window.open('/docs/operations-guide.html', '_blank');
        }

        function exportData() {
            alert('开始导出运营数据...');
        }

        function generateReport() {
            alert('正在生成运营报告...');
        }

        function optimizeSettings() {
            alert('启动智能优化分析...');
        }

        function goToProductionPortal() {
            window.location.href = '/omni/production-portal.html';
        }

        // Close dropdowns when clicking outside
        // document.addEventListener('click', function(event) {
        //     if (!event.target.closest('.dropdown')) {
        //         document.getElementById('environment-dropdown').classList.remove('show');
        //         document.getElementById('toolbox-dropdown').classList.remove('show');
        //     }
        // });

        // Listen for postMessage navigation events from iframe
        window.addEventListener('message', function (event) {
            if (event.origin !== window.location.origin) {
                return;
            }

            if (event.data.type === 'navigate') {
                const url = event.data.url;
                console.log('Received navigation request:', url);

                if (url) {
                    loadPage(url);
                }
            }
        });

        // ECharts 实例统一管理
        const chartInstances = new Map();
        
        // 统一的图表初始化函数
        function initChart(containerId, option, theme = null) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.warn(`Chart container ${containerId} not found`);
                return null;
            }
            
            // 如果已存在实例，先销毁
            if (chartInstances.has(containerId)) {
                chartInstances.get(containerId).dispose();
            }
            
            // 创建新实例
            const chart = echarts.init(container, theme);
            chartInstances.set(containerId, chart);
            chart.setOption(option);
            
            return chart;
        }
        
        // 窗口大小改变时调整所有图表
        function resizeAllCharts() {
            chartInstances.forEach((chart, containerId) => {
                try {
                    if (chart && !chart.isDisposed()) {
                        chart.resize();
                    }
                } catch (error) {
                    console.warn(`Failed to resize chart ${containerId}:`, error);
                }
            });
        }
        
        // 清理所有图表实例
        function disposeAllCharts() {
            chartInstances.forEach((chart, containerId) => {
                try {
                    if (chart && !chart.isDisposed()) {
                        chart.dispose();
                    }
                } catch (error) {
                    console.warn(`Failed to dispose chart ${containerId}:`, error);
                }
            });
            chartInstances.clear();
        }
        
        // 获取图表实例
        function getChartInstance(containerId) {
            return chartInstances.get(containerId);
        }

        // ECharts 图表初始化函数
        function initUsageTrendChart() {
            const option = {
                title: {
                    text: '使用趋势分析',
                    textStyle: { color: '#fff' }
                },
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    textStyle: { color: '#fff' }
                },
                xAxis: {
                    type: 'category',
                    data: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
                    axisLine: { lineStyle: { color: '#555' } },
                    axisLabel: { color: '#ccc' }
                },
                yAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: '#555' } },
                    axisLabel: { color: '#ccc' },
                    splitLine: { lineStyle: { color: '#333' } }
                },
                series: [{
                    name: '查询次数',
                    type: 'line',
                    data: [2100, 2300, 2800, 2600, 2900, 3200, 2854],
                    smooth: true,
                    lineStyle: { color: '#60a5fa' },
                    itemStyle: { color: '#60a5fa' },
                    areaStyle: { color: 'rgba(96, 165, 250, 0.3)' }
                }]
            };
            initChart('usage-trend-chart', option);
        }

        function initHotspotAnalysisChart() {
            const option = {
                title: {
                    text: '热点应用分析',
                    textStyle: { color: '#fff' }
                },
                tooltip: {
                    trigger: 'item',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    textStyle: { color: '#fff' }
                },
                series: [{
                    name: '应用模块',
                    type: 'pie',
                    radius: '60%',
                    data: [
                        { value: 1048, name: '业务查询' },
                        { value: 735, name: '流程处理' },
                        { value: 580, name: '政策咨询' },
                        { value: 484, name: '数据查询' },
                        { value: 300, name: '其他' }
                    ],
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            };
            initChart('hotspot-analysis-chart', option);
        }

        function initKeywordsRankingChart() {
            const option = {
                title: {
                    text: 'TOP10 高频关键词',
                    textStyle: { color: '#fff' }
                },
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    textStyle: { color: '#fff' }
                },
                xAxis: {
                    type: 'category',
                    data: ['贷款', '存款', '理财', '信用卡', '转账', '流程', '利率', '保险', '投资', '申请'],
                    axisLine: { lineStyle: { color: '#555' } },
                    axisLabel: { color: '#ccc', rotate: 45 }
                },
                yAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: '#555' } },
                    axisLabel: { color: '#ccc' },
                    splitLine: { lineStyle: { color: '#333' } }
                },
                series: [{
                    name: '搜索次数',
                    type: 'bar',
                    data: [850, 720, 680, 620, 580, 540, 520, 480, 460, 420],
                    itemStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: '#ff6b35' },
                            { offset: 1, color: '#f7931e' }
                        ])
                    }
                }]
            };
            initChart('keywords-ranking-chart', option);
        }

        function initDepartmentComparisonChart() {
            const option = {
                title: {
                    text: '机构对比分析',
                    textStyle: { color: '#fff' }
                },
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    textStyle: { color: '#fff' }
                },
                legend: {
                    data: ['总行', '分行一', '分行二', '分行三'],
                    textStyle: { color: '#ccc' }
                },
                xAxis: {
                    type: 'category',
                    data: ['业务查询', '流程处理', '政策咨询', '数据查询'],
                    axisLine: { lineStyle: { color: '#555' } },
                    axisLabel: { color: '#ccc' }
                },
                yAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: '#555' } },
                    axisLabel: { color: '#ccc' },
                    splitLine: { lineStyle: { color: '#333' } }
                },
                series: [
                    {
                        name: '总行',
                        type: 'bar',
                        data: [320, 280, 260, 220],
                        itemStyle: { color: '#60a5fa' }
                    },
                    {
                        name: '分行一',
                        type: 'bar',
                        data: [280, 240, 220, 180],
                        itemStyle: { color: '#f59e0b' }
                    },
                    {
                        name: '分行二',
                        type: 'bar',
                        data: [260, 200, 180, 160],
                        itemStyle: { color: '#10b981' }
                    },
                    {
                        name: '分行三',
                        type: 'bar',
                        data: [240, 180, 160, 140],
                        itemStyle: { color: '#8b5cf6' }
                    }
                ]
            };
            initChart('department-comparison-chart', option);
        }

        function initProblemCategoryChart() {
            const option = {
                title: {
                    text: '问题类别分布',
                    textStyle: { color: '#fff' }
                },
                tooltip: {
                    trigger: 'item',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    textStyle: { color: '#fff' }
                },
                series: [{
                    name: '问题类别',
                    type: 'pie',
                    radius: ['30%', '60%'],
                    data: [
                        { value: 15, name: '业务流程相关' },
                        { value: 12, name: '制度政策解释' },
                        { value: 8, name: '技术操作问题' },
                        { value: 5, name: '系统功能问题' }
                    ],
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    },
                    label: {
                        color: '#fff'
                    }
                }]
            };
            initChart('problem-category-chart', option);
        }

        function initResolutionTrendChart() {
            const option = {
                title: {
                    text: '问题解决趋势',
                    textStyle: { color: '#fff' }
                },
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    textStyle: { color: '#fff' }
                },
                legend: {
                    data: ['新增问题', '已解决问题'],
                    textStyle: { color: '#ccc' }
                },
                xAxis: {
                    type: 'category',
                    data: ['第1周', '第2周', '第3周', '第4周'],
                    axisLine: { lineStyle: { color: '#555' } },
                    axisLabel: { color: '#ccc' }
                },
                yAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: '#555' } },
                    axisLabel: { color: '#ccc' },
                    splitLine: { lineStyle: { color: '#333' } }
                },
                series: [
                    {
                        name: '新增问题',
                        type: 'line',
                        data: [12, 8, 15, 10],
                        lineStyle: { color: '#ef4444' },
                        itemStyle: { color: '#ef4444' }
                    },
                    {
                        name: '已解决问题',
                        type: 'line',
                        data: [10, 12, 9, 13],
                        lineStyle: { color: '#22c55e' },
                        itemStyle: { color: '#22c55e' }
                    }
                ]
            };
            initChart('resolution-trend-chart', option);
        }

        function initEfficiencyTrendChart() {
            const option = {
                title: {
                    text: '效能趋势分析',
                    textStyle: { color: '#fff' }
                },
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    textStyle: { color: '#fff' }
                },
                legend: {
                    data: ['问题解决率(%)', '用户满意度(%)'],
                    textStyle: { color: '#ccc' }
                },
                xAxis: {
                    type: 'category',
                    data: ['第1周', '第2周', '第3周', '第4周'],
                    axisLine: { lineStyle: { color: '#555' } },
                    axisLabel: { color: '#ccc' }
                },
                yAxis: {
                    type: 'value',
                    max: 100,
                    axisLine: { lineStyle: { color: '#555' } },
                    axisLabel: { color: '#ccc' },
                    splitLine: { lineStyle: { color: '#333' } }
                },
                series: [
                    {
                        name: '问题解决率(%)',
                        type: 'line',
                        data: [85.2, 86.8, 87.5, 87.3],
                        smooth: true,
                        lineStyle: { color: '#10b981' },
                        itemStyle: { color: '#10b981' },
                        areaStyle: { color: 'rgba(16, 185, 129, 0.3)' }
                    },
                    {
                        name: '用户满意度(%)',
                        type: 'line',
                        data: [92.1, 93.5, 94.2, 94.7],
                        smooth: true,
                        lineStyle: { color: '#8b5cf6' },
                        itemStyle: { color: '#8b5cf6' },
                        areaStyle: { color: 'rgba(139, 92, 246, 0.3)' }
                    }
                ]
            };
            initChart('efficiency-trend-chart', option);
        }

        function initResolutionTimeChart() {
            const option = {
                title: {
                    text: '问题解决时长分布',
                    textStyle: { color: '#fff' }
                },
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    textStyle: { color: '#fff' }
                },
                xAxis: {
                    type: 'category',
                    data: ['0-1s', '1-2s', '2-3s', '3-5s', '5s+'],
                    axisLine: { lineStyle: { color: '#555' } },
                    axisLabel: { color: '#ccc' }
                },
                yAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: '#555' } },
                    axisLabel: { color: '#ccc' },
                    splitLine: { lineStyle: { color: '#333' } }
                },
                series: [{
                    name: '问题数量',
                    type: 'bar',
                    data: [1240, 980, 456, 312, 158],
                    itemStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: '#06b6d4' },
                            { offset: 1, color: '#0891b2' }
                        ])
                    }
                }]
            };
            initChart('resolution-time-chart', option);
        }

        // 数据刷新和导出功能
        function refreshMonitoringData() {
            console.log('刷新监控数据...');
            // 模拟数据刷新
            setTimeout(() => {
                initUsageTrendChart();
                initHotspotAnalysisChart();
                showNotification('监控数据已刷新', 'success');
            }, 1000);
        }

        function exportMonitoringData() {
            console.log('导出监控数据...');
            const data = {
                timestamp: new Date().toISOString(),
                totalQueries: 28547,
                successRate: '94.7%',
                avgResponseTime: '1.2s',
                activeInstitutions: 126
            };
            downloadJSON(data, 'monitoring_data.json');
            showNotification('监控数据已导出', 'success');
        }

        function generateBottleneckReport() {
            console.log('生成瓶颈报告...');
            showNotification('瓶颈分析报告正在生成...', 'info');
            setTimeout(() => {
                const report = {
                    timestamp: new Date().toISOString(),
                    bottlenecks: [
                        {
                            issue: '贷款审批流程复杂',
                            frequency: 1247,
                            priority: 'High',
                            keywords: ['贷款审批', '流程', '资料']
                        },
                        {
                            issue: '理财产品信息不全',
                            frequency: 892,
                            priority: 'Medium',
                            keywords: ['理财', '收益率', '风险']
                        }
                    ]
                };
                downloadJSON(report, 'bottleneck_report.json');
                showNotification('瓶颈报告已生成', 'success');
            }, 2000);
        }

        function exportKeywordsData() {
            const period = document.getElementById('time-period').value;
            const dept = document.getElementById('dept-filter').value;
            console.log(`导出关键词数据: ${period}, ${dept}`);

            const keywordsData = {
                period: period,
                department: dept,
                timestamp: new Date().toISOString(),
                topKeywords: [
                    { keyword: '贷款', count: 850, trend: '+12.5%' },
                    { keyword: '存款', count: 720, trend: '+8.3%' },
                    { keyword: '理财', count: 680, trend: '+15.7%' },
                    { keyword: '信用卡', count: 620, trend: '-3.2%' },
                    { keyword: '转账', count: 580, trend: '+5.1%' }
                ]
            };
            downloadJSON(keywordsData, `keywords_data_${period}_${dept}.json`);
            showNotification('关键词数据已导出', 'success');
        }

        function generateQualityReport() {
            console.log('生成质量报告...');
            showNotification('知识质量报告正在生成...', 'info');

            setTimeout(() => {
                const qualityReport = {
                    timestamp: new Date().toISOString(),
                    inaccurateProblems: 32,
                    unresolvedProblems: 18,
                    categories: 8,
                    pendingRevisions: 12,
                    completionRate: '76%',
                    detailedAnalysis: {
                        businessProcess: {
                            issues: 15,
                            examples: ['贷款审批流程不清晰', '理财产品购买流程']
                        },
                        policyGaps: {
                            issues: 12,
                            examples: ['信用卡分期政策不明', '保险产品条款解释']
                        }
                    }
                };
                downloadJSON(qualityReport, 'quality_assessment_report.json');
                showNotification('质量报告已生成', 'success');
            }, 1500);
        }

        function exportQualityData() {
            const category = document.getElementById('quality-category').value;
            const priority = document.getElementById('priority-filter').value;
            console.log(`导出质量数据: ${category}, ${priority}`);

            const qualityData = {
                filters: { category, priority },
                timestamp: new Date().toISOString(),
                problems: [
                    {
                        type: '业务流程不准确',
                        count: 15,
                        priority: 'High',
                        keywords: ['流程', '步骤', '操作'],
                        suggestions: ['更新流程图', '完善资料清单']
                    },
                    {
                        type: '制度政策解释',
                        count: 12,
                        priority: 'Medium',
                        keywords: ['政策', '条款', '规定'],
                        suggestions: ['编制通俗解读手册', '增加案例分享']
                    }
                ]
            };
            downloadJSON(qualityData, `quality_data_${category}_${priority}.json`);
            showNotification('质量数据已导出', 'success');
        }

        function generateEfficiencyReport() {
            const period = document.getElementById('efficiency-period').value;
            console.log(`生成${period}效能报告...`);
            showNotification('效能分析报告正在生成...', 'info');

            setTimeout(() => {
                const efficiencyReport = {
                    period: period,
                    timestamp: new Date().toISOString(),
                    metrics: {
                        resolutionRate: '87.3%',
                        avgResolutionTime: '1.8s',
                        dailyVolume: 2854,
                        costSavings: 126000,
                        userSatisfaction: '94.7%',
                        roiIndex: '3.2x'
                    },
                    usageStats: {
                        totalQueries: 2854,
                        uniqueUsers: 1247,
                        successfulResolutions: 2490,
                        escalatedToHuman: 364
                    },
                    costBenefit: {
                        monthlyCostSaving: 126000,
                        efficiencyImprovement: 68000,
                        userExperienceValue: 42000,
                        totalBenefit: 240000,
                        investmentCost: 75000,
                        netBenefit: 165000
                    }
                };
                downloadJSON(efficiencyReport, `efficiency_report_${period}.json`);
                showNotification(`${period}效能报告已生成`, 'success');
            }, 2500);
        }

        function exportEfficiencyReport() {
            console.log('导出ROI分析报告...');
            const roiReport = {
                timestamp: new Date().toISOString(),
                roi: {
                    investmentCost: 75000,
                    monthlyBenefit: 240000,
                    roiRatio: 3.2,
                    paybackPeriod: '2.3个月',
                    annualizedReturn: '288%'
                },
                details: {
                    costSavings: {
                        humanResourceSaving: 126000,
                        serviceEfficiencyGain: 68000,
                        userExperienceImprovement: 42000
                    },
                    futureProjections: {
                        year1: 2880000,
                        year2: 3456000,
                        year3: 4147200
                    }
                }
            };
            downloadJSON(roiReport, 'roi_analysis_report.json');
            showNotification('ROI分析报告已导出', 'success');
        }

        function scheduleReport() {
            console.log('设置定时报告...');
            showModal('定时报告设置', `
                <div class="space-y-4">
                    <div>
                        <label class="block text-white text-sm mb-2">报告类型:</label>
                        <select class="w-full bg-white/10 text-white border border-white/20 rounded px-3 py-2 text-sm">
                            <option>日报</option>
                            <option>周报</option>
                            <option>月报</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-white text-sm mb-2">发送时间:</label>
                        <input type="time" value="09:00" class="w-full bg-white/10 text-white border border-white/20 rounded px-3 py-2 text-sm">
                    </div>
                    <div>
                        <label class="block text-white text-sm mb-2">接收人:</label>
                        <input type="email" placeholder="admin@bank.com" class="w-full bg-white/10 text-white border border-white/20 rounded px-3 py-2 text-sm">
                    </div>
                </div>
            `);
        }

        // 通用工具函数
        function downloadJSON(data, filename) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const icons = {
                'success': '✅',
                'error': '❌',
                'warning': '⚠️',
                'info': 'ℹ️'
            };

            const colors = {
                'success': 'bg-green-500/80',
                'error': 'bg-red-500/80',
                'warning': 'bg-yellow-500/80',
                'info': 'bg-blue-500/80'
            };

            notification.className = `fixed top-20 right-4 ${colors[type]} text-white px-4 py-3 rounded-lg shadow-lg z-50 flex items-center space-x-2`;
            notification.innerHTML = `
                <span>${icons[type]}</span>
                <span>${message}</span>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function showModal(title, content) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="glass rounded-xl p-6 max-w-md w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">${title}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-white/60 hover:text-white">✕</button>
                    </div>
                    ${content}
                    <div class="flex justify-end space-x-2 mt-6">
                        <button onclick="this.closest('.fixed').remove()" class="omni-btn px-4 py-2 glass text-white text-sm">取消</button>
                        <button onclick="this.closest('.fixed').remove(); showNotification('设置已保存', 'success')" class="omni-btn px-4 py-2 bg-blue-600 text-white text-sm">保存</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        // 自动刷新功能
        let autoRefreshInterval;

        function startAutoRefresh() {
            autoRefreshInterval = setInterval(() => {
                console.log('自动刷新数据...');
                // 模拟数据更新
                updateDashboardMetrics();
            }, 30000); // 30秒刷新一次
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }

        function updateDashboardMetrics() {
            // 模拟数据更新
            const metrics = document.querySelectorAll('.metric-value');
            metrics.forEach(metric => {
                const currentValue = parseInt(metric.textContent.replace(/[^0-9]/g, ''));
                if (currentValue) {
                    const variation = Math.floor(Math.random() * 10) - 5; // -5 to +5
                    const newValue = Math.max(0, currentValue + variation);
                    if (metric.textContent.includes('%')) {
                        metric.textContent = newValue + '%';
                    } else if (metric.textContent.includes('s')) {
                        metric.textContent = (newValue / 10).toFixed(1) + 's';
                    } else {
                        metric.textContent = newValue.toLocaleString();
                    }
                }
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async function () {
            // Initialize background
            initializeBackground();

            // Load app metadata from server
            await loadAppMetadata();

            // Initialize with first submenu open
            toggleKnowledgeSubmenu();

            // 启动自动刷新
            startAutoRefresh();

            // 添加筛选器事件监听
            const monitoringTimeRange = document.getElementById('monitoring-time-range');
            if (monitoringTimeRange) {
                monitoringTimeRange.addEventListener('change', function () {
                    refreshMonitoringData();
                });
            }

            const timePeriod = document.getElementById('time-period');
            if (timePeriod) {
                timePeriod.addEventListener('change', function () {
                    initKeywordsRankingChart();
                    initDepartmentComparisonChart();
                });
            }

            const deptFilter = document.getElementById('dept-filter');
            if (deptFilter) {
                deptFilter.addEventListener('change', function () {
                    initKeywordsRankingChart();
                    initDepartmentComparisonChart();
                });
            }

            const qualityCategory = document.getElementById('quality-category');
            if (qualityCategory) {
                qualityCategory.addEventListener('change', function () {
                    initProblemCategoryChart();
                    initResolutionTrendChart();
                });
            }

            const priorityFilter = document.getElementById('priority-filter');
            if (priorityFilter) {
                priorityFilter.addEventListener('change', function () {
                    initProblemCategoryChart();
                    initResolutionTrendChart();
                });
            }

            const efficiencyPeriod = document.getElementById('efficiency-period');
            if (efficiencyPeriod) {
                efficiencyPeriod.addEventListener('change', function () {
                    initEfficiencyTrendChart();
                    initResolutionTimeChart();
                });
            }

            console.log('Operations workspace initialized with enhanced features');
        });
        
        // 窗口大小改变事件监听
        let resizeTimer;
        window.addEventListener('resize', function() {
            // 防抖处理，避免频繁调用resize
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                console.log('窗口大小改变，调整图表尺寸...');
                resizeAllCharts();
            }, 150); // 150ms防抖
        });
        
        // 页面卸载时清理资源
        window.addEventListener('beforeunload', function() {
            console.log('清理ECharts实例...');
            stopAutoRefresh();
            disposeAllCharts();
        });
        
        // 页面可见性改变时的处理
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // 页面隐藏时停止自动刷新
                stopAutoRefresh();
            } else {
                // 页面显示时重新启动自动刷新
                startAutoRefresh();
                // 调整图表尺寸（页面可能在隐藏期间窗口大小发生了变化）
                setTimeout(resizeAllCharts, 100);
            }
        });
    </script>
</body>

</html>